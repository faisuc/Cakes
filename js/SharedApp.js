var FO;!function(e){var t;!function(e){var t;!function(e){function t(e){var t,n,o,r=0;if(0==e.length)return r;for(t=0,o=e.length;o>t;t++)n=e.charCodeAt(t),r=(r<<5)-r+n,r|=0;return r}function n(e,t){var n=Math.random();return Math.floor(e+(t-e)*n)}function o(e){for(var t="",n=0;e>n;n++){var o=Math.floor(65536*(1+Math.random())).toString(16).substring(1);t+=o}return t.substr(0,e)}function r(){for(var e=[],t="0123456789ABCDEF",n=0;36>n;n++)e[n]=Math.floor(16*Math.random());e[14]=4,e[19]=3&e[19]|8;for(var n=0;36>n;n++)e[n]=t[e[n]];return e[8]=e[13]=e[18]=e[23]="-",e.join("")}function i(e,t){if(e==t)return!0;if("object"!=typeof e&&"object"!=typeof t)return e==t;var n=Object.getOwnPropertyNames(e),o=Object.getOwnPropertyNames(t);if(n.length!=o.length)return!1;for(var r=0;r<n.length;r++){var a=n[r];if(!i(e[a],t[a]))return!1}return!0}function a(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=arguments;return e.replace(/{(\d+)}/g,function(e,t){var n=parseInt(t)+1;if("undefined"==typeof o[n])throw Error("Failed matching format group "+e);return o[n]})}function s(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.replace(/{(\w+)}/g,function(e,n){for(var o=0;o<t.length;o++){var r=t[o];if(n in r)return r[n]}throw Error("Failed matching format group "+e)})}function u(e){var t=/function (.{1,})\(/,n=t.exec(e.constructor.toString());return n&&n.length>1?n[1]:""}function l(e,t){e.addEventListener?e.addEventListener("message",t,!1):e.attachEvent&&e.attachEvent("onmessage",t)}function c(e){var t=document.createElement("a");return t.href=e,t.hostname}e.stringHash=t,e.randomInt=n,e.generateGuid=o,e.generateUUID=r,e.isEquivalent=i,e.stringFormat=a,e.namedStringFormat=s,e.nameOf=u,e.attachPostMessageHandler=l,e.domainFromUrl=c,e.HOUR_SECONDS=3600,e.DAY_SECONDS=24*e.HOUR_SECONDS,e.WEEK_SECONDS=7*e.DAY_SECONDS,e.MONTH_SECONDS=30*e.DAY_SECONDS}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);n.prototype=t.prototype,e.prototype=new n},FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this.source=null,this.source=e}return e.of=function(t){return new e(t)},e.ofElements=function(t){for(var n=[],o=0;o<t.length;o++)n.push(t.item(o));return new e(n)},e.empty=function(){return new e([])},e.prototype.length=function(){return this.source.length},e.prototype.getItem=function(e){return this.source[e]},e.prototype.each=function(t){e.each(this.source,t)},e.prototype.select=function(t){return e.of(e.select(this.source,t))},e.prototype.slice=function(t,n){for(var o=[],r=t;n>r;r++)o.push(this.source[r]);return new e(o)},e.prototype.stableSort=function(t){function n(e,t){if(null==e)return[];if(e.length<2)return e;null==t&&(t=o);var i,a,s;return i=~~(e.length/2),a=n(e.slice(0,i),t),s=n(e.slice(i,e.length),t),r(a,s,t)}function o(e,t){return t>e?-1:e>t?1:0}function r(e,t,n){for(var o=[];e.length&&t.length;)o.push(n(e[0],t[0])<=0?e.shift():t.shift());return e.length&&o.push.apply(o,e),t.length&&o.push.apply(o,t),o}var i=n(this.source,t);return e.of(i)},e.prototype.sort=function(t){var n=this.source.slice(0);return n.sort(t),e.of(n)},e.prototype.orderBy=function(e){return this.sort(function(t,n){return e(t)-e(n)})},e.prototype.orderByDesc=function(e){return this.sort(function(t,n){return e(n)-e(t)})},e.prototype.where=function(t){return e.of(e.where(this.source,t))},e.prototype.skip=function(t){if(t>=this.source.length)return new e([]);var n=this.source.slice(t);return e.of(n)},e.prototype.take=function(t){var n=this.source.slice(0,t);return e.of(n)},e.prototype.firstOrValue=function(e){return this.source.length?this.source[0]:e},e.prototype.first=function(e,t){void 0===t&&(t=null);for(var n=0;n<this.source.length;n++)if(e(this.source[n]))return this.source[n];return t},e.prototype.count=function(t){return e.count(this.source,t)},e.prototype.any=function(t){return e.any(this.source,t)},e.prototype.mergeCol=function(t){var n=this.source.concat(t.source);return e.of(n)},e.prototype.merge=function(t){var n=this.source.concat(t);return e.of(n)},e.prototype.normalize=function(e,t,n,o){if(void 0===n&&(n=0),void 0===o&&(o=1),0!=this.length()){var r=e(this.minBy(e)),i=e(this.maxBy(e));this.each(function(a){var s=e(a),u=i>r?(s-r)/(i-r):o-n/2;t(a,u)})}},e.prototype.distinct=function(t){return e.of(e.distinct(this.source,t))},e.prototype.sum=function(t){return e.aggregate(this.source,0,function(e,n){return n+t(e)})},e.prototype.maxBy=function(t){return e.maxBy(this.source,t)},e.prototype.minBy=function(t){return e.maxBy(this.source,function(e){return-t(e)})},e.prototype.stringJoin=function(e){return this.source.join(e)},e.prototype.groupBy=function(t){var n=e.orderedGroupByString(this.source,t);return n},e.prototype.selectMany=function(t){var n=[];return this.each(function(e){return n=n.concat(t(e))}),e.of(n)},e.prototype.selectFirst=function(e,t){void 0===t&&(t=function(e){return!!e});for(var n=0;n<this.source.length;n++){var o=e(this.source[n]);if(t(o))return o}return null},e.prototype.toMap=function(e,t){var n=this.select(function(n){return{key:e(n),value:t(n)}});return new o(n.toArray())},e.prototype.toHashmap=function(t){return e.toHashmap(this.source,t)},e.prototype.toHashmap2=function(t,n){return e.toHashmap2(this.source,t,n)},e.prototype.toArray=function(){return this.source},e.count=function(e,t){for(var n=0,o=0;o<e.length;o++)t(e[o])&&n++;return n},e.any=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return!0;return!1},e.each=function(e,t){for(var n=0;n<e.length;n++)t(e[n],n)},e.hashEach=function(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])},e.select=function(e,t){for(var n=[],o=0;o<e.length;o++){var r=t(e[o],o);n.push(r)}return n},e.where=function(e,t){for(var n=[],o=0;o<e.length;o++){var r=t(e[o]);r&&n.push(e[o])}return n},e.filterSelect=function(e,t){for(var n=[],o=0;o<e.length;o++){var r=t(e[o]);null!=r&&n.push(r)}return n},e.flatMap=function(e){for(var t=[],n=0;n<e.length;n++)t=t.concat(e[n]);return t},e.distinct=function(e,t){for(var n={},o=[],r=0;r<e.length;r++){var i=e[r],a=t(i);a in n||(n[t(i)]=!0,o.push(i))}return o},e.exclude=function(e,t){for(var n=[],o=0;o<e.length;o++){for(var r=!1,i=0;i<t.length;o++)if(e[o].toLowerCase()==t[i].toLowerCase()){r=!0;break}r||n.push(e[o])}return n},e.contains=function(e,t){for(var n=0;n<e.length;n++)if(e[n].toLowerCase()==t.toLowerCase())return!0;return!1},e.groupByString=function(e,t){for(var n={},o=0;o<e.length;o++){var r=e[o],i=t(r);i in n||(n[i]=[]),n[i].push(r)}return n},e.orderedGroupByString=function(e,t){for(var n={},r=[],i=0;i<e.length;i++){var a=e[i],s=t(a);s in n||(r.push({key:s,value:[]}),n[s]=r.length-1);var u=n[s];r[u].value.push(a)}return new o(r)},e.hashSelect=function(e,t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=t(e[o]));return n},e.aggregate=function(e,t,n){for(var o=t,r=0;r<e.length;r++)o=n(e[r],o);return o},e.hashAggregate=function(e,t,n){var o=t;for(var r in e){var i=e[r];o=n(r,i,o)}return o},e.sum=function(t,n){return e.aggregate(t,0,function(e,t){return t+n(e)})},e.hashSum=function(t,n){return e.hashAggregate(t,0,function(e,t,o){return o+n(e,t)})},e.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},e.numValues=function(e){var t=[];for(var n in e)t.push(e[n]);return t},e.maxBy=function(e,t){for(var n=null,o=null,r=0;r<e.length;r++){var i=t(e[r]);(null==n||i>n)&&(n=i,o=e[r])}return o},e.intersect=function(e,t){for(var n=[],o=0;o<e.length;o++)for(var r=0;r<t.length;r++)if(e[o]==t[r]){n.push(e[o]);break}return n},e.getKeys=function(e){var t=[];for(var n in e)t.push(n);return t},e.toArray=function(e,t){var n=[];for(var o in e){var r=e[o],i=t(o,r);n.push(i)}return n},e.valuesCol=function(t){var n=[];for(var o in t)t.hasOwnProperty(o)&&n.push(t[o]);return e.of(n)},e.toHashmap=function(t,n){return e.toHashmap2(t,n,function(e){return e})},e.toHashmap2=function(e,t,n){for(var o={},r=0;r<e.length;r++){var i=e[r],a=n(i),s=t(i);o[s]=a}return o},e.join=function(e,t,n){for(var o=[],r=0;r<e.length;r++)for(var i=e[r],a=0;a<t.length;a++){var s=t[a],u=n(i,s);null!=u&&o.push(u)}return o},e.hashMerge=function(t,n,o){void 0===o&&(o=e.hashMergeDefaultConflictFn);var r={};return e.hashEach(t,function(e,t){return r[e]=t}),e.hashEach(n,function(e,t){e in r?r[e]=o(e,r[e],t):r[e]=t}),r},e.hashMergeDefaultConflictFn=function(e,t,n){throw new Error("Conflict on hash merge. Key: "+e+". First: "+t+". Second: "+n)},e.recurseElements=function(t,n,o){void 0===o&&(o=null);var r=n(t,o);if(1==r||2==r)return r;for(var i=0;i<t.children.length;i++){var a=t.children.item(i),s=e.recurseElements(a,n);if(2==s)return 2}return r},e.recurseNodes=function(t,n,o){void 0===o&&(o=null);var r=n(t,o);if(1==r||2==r)return r;for(var i=0;i<t.childNodes.length;i++){var a=t.childNodes.item(i),s=e.recurseNodes(a,n);if(2==s)return 2}return r},e.repeatString=function(e,t){for(var n=[],o=0;t>o;o++)n.push(e);return n},e.recurseSelectElements=function(t,n,o){var r=n(t),i=r[0],a=r[1];if(0==i)for(var s=0;s<t.children.length;s++){var u=t.children.item(s),l=e.recurseSelectElements(u,n,o),c=l[0],d=l[1];if(a=o(t,a,d),2==c){i=2;break}}return[i,a]},e.recurseSelectElements2=function(t,n,o){var r=n(t),i=r[0],a=r[1],s=[];if(0==i)for(var u=0;u<t.children.length;u++){var l=t.children.item(u),c=e.recurseSelectElements2(l,n,o),d=c[0];if(s.push(c[1]),2==d){i=2;break}}var f=o(a,s);return[i,f]},e}();e.Col=t;var n=function(){function e(){}return e}();e.Pair=n,function(e){e[e.CONTINUE=0]="CONTINUE",e[e.BREAK_NODE=1]="BREAK_NODE",e[e.BREAK_ALL=2]="BREAK_ALL"}(e.RecursionFlow||(e.RecursionFlow={}));var o=(e.RecursionFlow,function(e){function n(t){e.call(this,t)}return __extends(n,e),n.ofHash=function(e){var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push({key:o,value:e[o]});return new n(t)},n.ofUrlString=function(e){return n.ofHashString(e,"&","=",function(e){return decodeURIComponent(e)})},n.ofHashString=function(e,o,r,i){var a=t.of(e.split(o)),s=a.select(function(e){var t=e.split(r),n=t[0],o=t[1],a=i(o);return{key:n,value:a}}).toArray();return new n(s)},n.emptyMap=function(){return n.ofHash({})},n.prototype.get=function(e){var t=this.first(function(t){return t.key==e});return t?t.value:null},n.prototype.keys=function(){return this.select(function(e){return e.key})},n.prototype.values=function(){return this.select(function(e){return e.value})},n.prototype.selectValues=function(e){var t=this.select(function(t){return{key:t.key,value:e(t)}});return new n(t.toArray())},n}(t));e.Map=o}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(e){this.userSettings=e}return t.prototype.isSuspended=function(n){var o=this.userSettings.retrive(t.SUSPENDED_KEY),r=(new Date).getTime();if(o&&n in o&&"timestamp"in o[n]){var i=o[n].timestamp;return-1==i||i>r}if(o)if(n in o&&"timestamp"in o[n]){var i=o[n].timestamp;e.Logger.log("Suspension found, but expired on "+new Date(i).toUTCString())}else e.Logger.log("Suspension id "+n+" not in suspension map");else e.Logger.log("No suspension map found");return!1},t.prototype.shouldAutoAppear=function(e){var n=this.userSettings.retrive(t.SUSPENDED_KEY);return n&&e in n&&"autoAppear"in n[e]&&0==n[e].autoAppear?!1:!0},t.prototype.suspend=function(n,o){var r=this.userSettings.retrive(t.SUSPENDED_KEY);null==r&&(r={});var i=(new Date).getTime(),a=i+o;r[n]||(r[n]={}),r[n].timestamp=a,e.Logger.log("Suspended "+n+" until "+new Date(a).toUTCString()),this.userSettings.store(t.SUSPENDED_KEY,r)},t.millisecondsToStr=function(e){function t(e){return e>1?"s":""}var n=Math.floor(e/1e3),o=Math.floor(n/31536e3);if(o)return o+" year"+t(o);var r=Math.floor((n%=31536e3)/86400);if(r)return r+" day"+t(r);var i=Math.floor((n%=86400)/3600);if(i)return i+" hour"+t(i);var a=Math.floor((n%=3600)/60);if(a)return a+" minute"+t(a);var s=n%60;return s?s+" second"+t(s):"less than a second"},t.SUSPENDED_KEY="suspend",t}();t.DefaultSuspender=n}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this.resolvedOverrides={},e.params()&&e.params().flags&&(e.params().flags.base.value&&this.resolveAndApplyOverrides(e,e.params().flags.base.value,"base"),e.params().flags.specific.value&&this.resolveAndApplyOverrides(e,e.params().flags.specific.value,"specific"))}return e.prototype.resolveAndApplyOverrides=function(e,t,n){for(var o=0;o<t.length;o++)for(var r=t[o],i=n+"."+r.name,a=Math.random(),s=0,u=0;u<r.variants.length;u++){var l=r.variants[u],c=i+"."+l.name;if(s+=l.odds,s>a){for(var d=0;d<l.values.length;d++)this.resolvedOverrides[l.values[d].name]={value:l.values[d].val,origin:c},r.flag&&l.flagValue&&e.pushNotificationParam(r.flag,l.flagValue);break}}},e.prototype.value=function(e,t){return void 0===t&&(t=null),e in this.resolvedOverrides?this.resolvedOverrides[e].value:t},e.prototype.floatValue=function(e,t){return void 0===t&&(t=null),e in this.resolvedOverrides?parseFloat(this.resolvedOverrides[e].value):t},e.prototype.intValue=function(e,t){return void 0===t&&(t=null),e in this.resolvedOverrides?parseInt(this.resolvedOverrides[e].value):t},e.prototype.boolValue=function(e,t){return void 0===t&&(t=null),!!this.intValue(e,t?1:0)},e.prototype.describe=function(){var e=[];for(var t in this.resolvedOverrides){var n=this.resolvedOverrides[t];e.push(t+": "+n.value+" ("+n.origin+")")}return e.join("\n")},e}();e.Overrides=t}(t=e.Context||(e.Context={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.resolveReportingProduct=function(e,t){return"pp"==e&&"rs-dual"==t?"rs":"pp"==e&&"rsif"==t?"rs":"pp"==e&&"rsinc"==t?"rs":"pp"==e&&"rsinc2"==t?"rs":"pp"==e&&"rsinc3"==t?"rs":"pp"==e&&"rsinc4"==t?"rs":"pp"==e&&"rsalt"==t?"rs":"pp"==e&&"rsx"==t?"rs":"pp"==e&&"rsy"==t?"rs":"pp"==e&&"bs-dual"==t?"bs":"pp"==e&&"bsif"==t?"rs":"pp"==e&&"bsx"==t?"bs":"pp"==e&&"bsy"==t?"bs":"pp"==e&&"tsx"==t?"ts":"pp"==e&&"tsy"==t?"ts":"pp"==e&&"tb-dual"==t?"tb":"pp"==e&&"tbx"==t?"tb":"pp"==e&&"tby"==t?"tb":"sk"==e&&"sbx"==t?"sb":"sk"==e&&"sby"==t?"sb":"imgdeals"==e&&"gbx"==t?"gb":"imgdeals"==e&&"gby"==t?"gb":"universal-banner"==e?"ub":"rb"==e?"rb":"gb"==e?"gb":"cpn"==e?"cpn":"ppm"==e?"rs":e+"_"+t},e}();e.Reporting=t}(t=e.Logger||(e.Logger={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(){}return t.notify=function(e,n,o,r,i){void 0===o&&(o={}),void 0===r&&(r=1),void 0===i&&(i=!0);var a=n.key;return t.notifyX(e,a,o,r,i)},t.notifyX=function(e,n,o,r,i){void 0===o&&(o={}),void 0===r&&(r=1),void 0===i&&(i=!0);try{var a="notifyrate."+n,s=e.overrides().floatValue(a,r),u=Math.random()<s;if(!u)return!1;var l=t.resolveUrl(e,n,o,i),c=document.body.appendChild(document.createElement("img"));return c.style.zIndex="-100",c.style.position="absolute",c.style.left="0",c.style.top="0",c.src=l,!0}catch(d){return!1}},t.resolveUrl=function(e,n,o,r){void 0===o&&(o={}),void 0===r&&(r=!0);var i=t.resolveParamaters(e,o,r),a="";for(var s in i)a.length>0&&(a+="&"),a+=s+"="+encodeURIComponent(i[s]);var u=e.paths().notifyRoot()+"/a/"+n+"/logo.png?"+a;return u},t.resolveParamaters=function(t,n,o){void 0===n&&(n={}),void 0===o&&(o=!0);var r=t.notificationParams(),i={};if(o)for(var a in r)i[a]=r[a];for(var a in n)i[a]=n[a];if("t"in i||(i.t=(new Date).getTime()+""),i.pr&&i.w){var s=e.Reporting.resolveReportingProduct(i.pr,i.w);s&&(i.rp=s)}return i},t.notifyGenericUrl=function(e,n,o,r){void 0===n&&(n={}),void 0===o&&(o=null),void 0===r&&(r=!1);try{if(n){e+="?";for(var i in n){var a=n[i]+"";e=e+"&"+i+"="+encodeURIComponent(a)}}var s=document.body.appendChild(document.createElement("img")),u="rid"+Math.floor(9999999999*Math.random());return s.id=u,s.style.zIndex="-100",s.style.position="absolute",s.style.left="0",s.style.top="0",s.src=e,r&&o&&setTimeout(function(){var n=!!document.getElementById(u);n||t.notify(o,t.GENERIC,{subtype:"notifyfailue",originalurl:e})},500),u}catch(l){return null}},t.GENERIC={key:"generic"},t.INJECTION={key:"inj"},t.INIT={key:"init"},t.USER={key:"usr"},t.NO_SHOW={key:"noshow"},t.IMPRESSION={key:"wo"},t.HOVER={key:"ho"},t.CLICK={key:"c"},t.EXCEPTION={key:"exception"},t}();e.Analytics=t}(t=e.Logger||(e.Logger={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(t,n,o,r){void 0===r&&(r=null),this._isDebugMode=!1,this.extraParams={},this.extraParams={},this._paths=t,this._params=n,this._host=window.location.host,this._isDebugMode=this.determineIsDebugMode(),this._overrides=r?r:new e.Overrides(this);for(var i in o)this.extraParams[i]=o[i]}return t.prototype.paths=function(){return this._paths},t.prototype.params=function(){return this._params},t.prototype.host=function(){return this._host},t.prototype.isDebugMode=function(){return this._isDebugMode},t.prototype.overrides=function(){return this._overrides},t.prototype.determineIsDebugMode=function(){return!!window.FO_DEBUG},t.prototype.pushNotificationParam=function(e,t){this.extraParams[e]=t},t.prototype.notificationParams=function(){var e={hn:this.host(),partid:this.params()?this.params().partnerCode:"",subid:this.params()?this.params().subId:"",v:"0_0_516",fam:"nwp",dmn:this.paths().domain(),safepassage:"1"};for(var t in this.extraParams)e[t]=this.extraParams[t];return e},t}();e.BootstrapContext=t}(t=e.Context||(e.Context={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this._domain=null,this._domain=e}return e.prototype.domain=function(){return this._domain},e.prototype.innerResourcesRoot=function(){return this.rootUrl()+"/Extras"},e.prototype.outerResourcesRoot=function(){return"//pstatic"+this.domain()+"/nwp/External"},e.prototype.iframeStoreSrc=function(){return this.rootUrl()+"/Store.html"},e.prototype.notifyRoot=function(){return this.apiRoot()},e.prototype.rootUrl=function(){return"//pstatic"+this.domain()+"/nwp/v0_0_516/release"},e.prototype.apiRoot=function(){return"//app"+this.domain()},e.prototype.dynamicContentRoot=function(){return"//jsgnr"+this.domain()},e.prototype.cachedApiRoot=function(){return"//capp"+this.domain()},e.prototype.blackWhiteListRoot=function(){return"//cwbl"+this.domain()},e.prototype.shortCacheRoot=function(){return"//istatic"+this.domain()},e.prototype.longCacheRoot=function(){return"//pstatic"+this.domain()},e}();e.Paths=t}(t=e.Context||(e.Context={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){function t(e){e=e||{guess:!0};var t=e.e||null,o=!!e.guess,r=e.mode||null,i=new n,a=i.run(t,r);return o?i.guessAnonymousFunctions(a):a}e.printStackTrace=t;var n=function(){function e(){this.sourceCache={}}return e.prototype.run=function(e,t){return e=e||this.createException(),t=t||this.mode(e),"other"===t?this.other(arguments.callee):this[t](e)},e.prototype.createException=function(){try{this.undef()}catch(e){return e}},e.prototype.mode=function(e){return e.arguments&&e.stack?"chrome":e.stack&&e.sourceURL?"safari":e.stack&&e.number?"ie":e.stack&&e.fileName?"firefox":e.message&&e["opera#sourceloc"]?e.stacktrace?e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?"opera9":"opera10a":"opera9":e.message&&e.stack&&e.stacktrace?e.stacktrace.indexOf("called from line")<0?"opera10b":"opera11":e.stack&&!e.fileName?"chrome":"other"},e.prototype.instrumentFunction=function(e,n,o){e=e||window;var r=e[n];e[n]=function(){return o.call(this,t().slice(4)),e[n]._instrumented.apply(this,arguments)},e[n]._instrumented=r},e.prototype.deinstrumentFunction=function(e,t){e[t].constructor===Function&&e[t]._instrumented&&e[t]._instrumented.constructor===Function&&(e[t]=e[t]._instrumented)},e.prototype.chrome=function(e){return(e.stack+"\n").replace(/^[\s\S]+?\s+at\s+/," at ").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}() ($1)$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}() ($1)").replace(/^(.+) \((.+)\)$/gm,"$1@$2").split("\n").slice(0,-1)},e.prototype.safari=function(e){return e.stack.replace(/\[native code\]\n/m,"").replace(/^(?=\w+Error\:).*$\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},e.prototype.ie=function(e){return e.stack.replace(/^\s*at\s+(.*)$/gm,"$1").replace(/^Anonymous function\s+/gm,"{anonymous}() ").replace(/^(.+)\s+\((.+)\)$/gm,"$1@$2").split("\n").slice(1)},e.prototype.firefox=function(e){return e.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^(?:\((\S*)\))?@/gm,"{anonymous}($1)@").split("\n")},e.prototype.opera11=function(e){for(var t="{anonymous}",n=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,o=e.stacktrace.split("\n"),r=[],i=0,a=o.length;a>i;i+=2){var s=n.exec(o[i]);if(s){var u=s[4]+":"+s[1]+":"+s[2],l=s[3]||"global code";l=l.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,t),r.push(l+"@"+u+" -- "+o[i+1].replace(/^\s+/,""))}}return r},e.prototype.opera10b=function(e){for(var t=/^(.*)@(.+):(\d+)$/,n=e.stacktrace.split("\n"),o=[],r=0,i=n.length;i>r;r++){var a=t.exec(n[r]);if(a){var s=a[1]?a[1]+"()":"global code";o.push(s+"@"+a[2]+":"+a[3])}}return o},e.prototype.opera10a=function(e){for(var t="{anonymous}",n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,o=e.stacktrace.split("\n"),r=[],i=0,a=o.length;a>i;i+=2){var s=n.exec(o[i]);if(s){var u=s[3]||t;r.push(u+"()@"+s[2]+":"+s[1]+" -- "+o[i+1].replace(/^\s+/,""))}}return r},e.prototype.opera9=function(e){for(var t="{anonymous}",n=/Line (\d+).*script (?:in )?(\S+)/i,o=e.message.split("\n"),r=[],i=2,a=o.length;a>i;i+=2){var s=n.exec(o[i]);s&&r.push(t+"()@"+s[2]+":"+s[1]+" -- "+o[i+1].replace(/^\s+/,""))}return r},e.prototype.other=function(e){for(var t,n,o="{anonymous}",r=/function(?:\s+([\w$]+))?\s*\(/,i=[],a=10,s=Array.prototype.slice;e&&i.length<a;){t=r.test(e.toString())?RegExp.$1||o:o;try{n=s.call(e.arguments||[])}catch(u){n=["Cannot access arguments: "+u]}i[i.length]=t+"("+this.stringifyArguments(n)+")";try{e=e.caller}catch(u){i[i.length]="Cannot access caller: "+u;break}}return i},e.prototype.stringifyArguments=function(e){for(var t=[],n=Array.prototype.slice,o=0;o<e.length;++o){var r=e[o];void 0===r?t[o]="undefined":null===r?t[o]="null":r.constructor&&(r.constructor===Array?r.length<3?t[o]="["+this.stringifyArguments(r)+"]":t[o]="["+this.stringifyArguments(n.call(r,0,1))+"..."+this.stringifyArguments(n.call(r,-1))+"]":r.constructor===Object?t[o]="#object":r.constructor===Function?t[o]="#function":r.constructor===String?t[o]='"'+r+'"':r.constructor===Number?t[o]=r:t[o]="?")}return t.join(",")},e.prototype.ajax=function(e){var t=this.createXMLHTTPObject();if(t)try{return t.open("GET",e,!1),t.send(null),t.responseText}catch(n){}return""},e.prototype.createXMLHTTPObject=function(){for(var e,t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],n=0;n<t.length;n++)try{return e=t[n](),this.createXMLHTTPObject=t[n],e}catch(o){}},e.prototype.isSameDomain=function(e){return"undefined"!=typeof location&&-1!==e.indexOf(location.hostname)},e.prototype.getSource=function(e){return e in this.sourceCache||(this.sourceCache[e]=this.ajax(e).split("\n")),this.sourceCache[e]},e.prototype.guessAnonymousFunctions=function(e){for(var t=0;t<e.length;++t){var n=/\{anonymous\}\(.*\)@(.*)/,o=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,r=e[t],i=n.exec(r);if(i){var a=o.exec(i[1]);if(a){var s=a[1],u=a[2],l=a[3]||0;if(s&&this.isSameDomain(s)&&u){var c=this.guessAnonymousFunction(s,u,l);e[t]=r.replace("{anonymous}",c)}}}}return e},e.prototype.guessAnonymousFunction=function(e,t,n){var o;try{o=this.findFunctionName(this.getSource(e),t)}catch(r){o="getSource failed with url: "+e+", exception: "+r.toString()}return o},e.prototype.findFunctionName=function(e,t){for(var n,o,r,i=/function\s+([^(]*?)\s*\(([^)]*)\)/,a=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,s=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,u="",l=Math.min(t,20),c=0;l>c;++c)if(n=e[t-c-1],r=n.indexOf("//"),r>=0&&(n=n.substr(0,r)),n){if(u=n+u,o=a.exec(u),o&&o[1])return o[1];if(o=i.exec(u),o&&o[1])return o[1];if(o=s.exec(u),o&&o[1])return o[1]}return"(?)"},e}()}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){function n(e){t.logContext=e,t.logToConsole=e.isDebugMode(),window.FO_NATIVE_DEBUG&&console.log&&(t.log=console.log.bind(console),t.info=console.info?console.info.bind(console):console.log.bind(console),t.warn=console.warn?console.warn.bind(console):console.log.bind(console),t.error=console.error?console.error.bind(console):console.log.bind(console),t.time=console.time?console.time.bind(console):console.log.bind(console),t.timeEnd=console.timeEnd?console.timeEnd.bind(console):console.log.bind(console))}function o(e){t.logToConsole&&console.time&&console.time(e),i("TIMER_START: "+e)}function r(e){if(t.logToConsole&&console.timeEnd&&console.timeEnd(e),t.logstack)for(var n=0;n<t.logstack.length;n++){var o=t.logstack[n];if(o.msg=="TIMER_START: "+e){var r=Date.now()-o.time;return i("TIMER END: "+e+"("+r+"ms elapsed)"),r}}}function i(e){l(15e3,e)}function a(e){l(2e4,e)}function s(e){l(3e4,e)}function u(e,n){void 0===n&&(n=t.logContext),l(4e4,e,n)}function l(e,n,o){void 0===o&&(o=t.logContext);try{var r=c();if(t.logToConsole){var i=g[e];i||(i=function(e){return console.log(e)});var a="FO - "+(r?n+" @ "+r:n);i(a)}t.logstack||(t.logstack=[]);var s={time:Date.now(),level:e,msg:n,source:r};t.logstack.push(s),s.level>=t.callHomeLevel&&d(t.logstack,n,o)}catch(u){}}function c(){try{var t=e.Common.printStackTrace(),n=t[6],o=n.match(/^[^@]*/)[0];return"{anonymous}()"==o?null:o}catch(r){return null}}function d(e,n,o){try{for(var r="",i=0;i<e.length;i++){var a=e[i];a.level>=3e4&&"string"==typeof a.msg&&(r.length>0&&(r+=" --- "),r+=h[a.level]+" "+a.msg)}r.length>1024&&(r=r.substr(r.length-1024)),r||(r=n);var s={ex:r};t.Analytics.notify(o,t.Analytics.EXCEPTION,s,0)}catch(u){}}function f(){p(t.logstack)}function p(e){if(e)for(var t=0;t<e.length;t++){var n=e[t];1e4==n.level&&console.debug(n.msg),15e3==n.level&&console.log(n.msg),2e4==n.level&&console.info(n.msg),3e4==n.level&&console.warn(n.msg),4e4==n.level&&console.error(n.msg)}}function m(e,n,o){window.setTimeout(function(){for(var o=0;o<t.logstack.length;o++){var r=t.logstack[o],i=n(r,t.logstack);if(i)return}u("Failure on EXPECT "+e)},o)}!function(e){e[e.FATAL=5e4]="FATAL",e[e.ERROR=4e4]="ERROR",e[e.WARN=3e4]="WARN",e[e.INFO=2e4]="INFO",e[e.LOG=15e3]="LOG",e[e.DEBUG=1e4]="DEBUG",e[e.TRACE=5e3]="TRACE"}(t.LogLevel||(t.LogLevel={}));var h=t.LogLevel,g={1e4:function(e){return console.debug(e)},15e3:function(e){return console.log(e)},2e4:function(e){return console.info(e)},3e4:function(e){return console.warn(e)},4e4:function(e){return console.error(e)}};t.logToConsole,t.logstack,t.callHomeLevel=4e4,t.logContext,t.intialize=n,t.time=o,t.timeEnd=r,t.log=i,t.info=a,t.warn=s,t.error=u,t.flushToConsole=f,t.expect=m}(t=e.Logger||(e.Logger={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){function o(e,t){return{name:e,value:t}}function r(e,t){return t.then(function(t){return o(e,t)})}function i(e,t){void 0===t&&(t=!1);var n=[];for(var o in e){var r=u(o,e[o]);n.push(r)}return s(n,t)}function a(e,t){void 0===t&&(t=!1);var n=[];for(var o in e){var r=u(o,e[o]);n.push(r)}return s(n,t)}function s(e,o){void 0===o&&(o=!1);var r=n.defer(),i=e.length,a={};if(0==i)return r.resolve({}),r.promise();for(var s=0;s<e.length;s++){var u=e[s];u.done(function(e){a[e.name]=e.value,n.Col.getKeys(a).length==i&&r.resolve(a)}).fail(function(e){if(o){t.Logger.warn("Continuing ofter inner error: "+e.message);var n=""+Math.random();a[n]=null}else 1!==r.getStatus()&&r.reject(e)})}return r.promise()}function u(e,t){return t.then(function(t){return{name:e,value:t}})}function l(o){var r=n.defer();return e.$.ajax(o,{dataType:"text"}).done(function(e){r.resolve(e)}).fail(function(e,n,i){var a=i&&i.message||"error"!=n&&n||e.status||e.responseText||"generic error";t.Logger.warn("First level error on jqGet '"+o+"': "+a),r.reject({message:a})}),r.promise()}n.toNamed=o,n.toNamedPromise=r,n.namedWhen3=i,n.namedWhen2=a,n.namedWhen=s,n.namePromise=u,n.jqGetPromise=l}(n=t.Common||(t.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){function n(){return new F}function o(e){return n().resolve(e).promise()}function r(e){return n().reject(e).promise()}function i(e,t){var o=n(),r=new Array;return a(r,o,e,t),o.promise()}function a(e,t,n,o){var r=n(o);if(!r)return void t.resolve(e);for(;r.next&&2==r.promise.getStatus();)if(e.push(r.promise.getResult()),r=n(r.next),!r)return void t.resolve(e);r.promise.done(function(o){e.push(o),r.next?a(e,t,n,r.next):t.resolve(e)}).fail(function(e){t.reject(e)})}function s(e){return l(function(){return!0},Number.MAX_VALUE,e,!1)}function u(e,t){void 0===t&&(t=Number.MAX_VALUE);var o=n(),r=!1;return window.setTimeout(function(){r||(r=!0,o.reject({message:"Timed out after "+t}))}),e(function(e){r||(r=!0,o.resolve(e))}),o.promise()}function l(e,t,o,r){void 0===t&&(t=0),void 0===o&&(o=500),void 0===r&&(r=!0);var i=n(),a=Date.now(),s=function(){var n=Date.now()-a;if(n>=t)clearInterval(u),i.reject(Error("Timed out after "+n));else{var o=e();"undefined"!=typeof o&&null!=o&&(clearInterval(u),i.resolve(o))}},u=setInterval(s,o);return r&&s(),i.promise()}function c(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var o=n();if(!e.length)return o.resolve([]),o.promise();for(var r=0,i=[],a=0;a<e.length;a++){var s=e[a];s.done(function(t){i.push(t),++r,r===e.length&&1!==o.getStatus()&&o.resolve(i)}).fail(function(e){1!==o.getStatus()&&o.reject(e)})}return o.promise()}function d(t,o){void 0===o&&(o=!1);var r=n();if(!t.length)return r.resolve([]),r.promise();for(var i=0,a=[],s=0;s<t.length;s++){var u=t[s];u.done(function(e){a.push(e),++i,i===t.length&&1!==r.getStatus()&&r.resolve(a)}).fail(function(t){o?(e.Logger.warn("Continuing after inner error: "+t.message),++i):1!==r.getStatus()&&r.reject(t)})}return r.promise()}function f(e,t,o,r,i,a){void 0===a&&(a=6e4);var s=n(),u=(new Date).getTime(),l=null,c=0,d=setInterval(function(){var n=(new Date).getTime();if(n-u>=a)clearInterval(d),s.reject({message:"Timed out after "+(n-u)});else try{var r=e();r==l?n-u>=i&&(clearInterval(d),s.resolve(r)):t(r)&&(o(r),l=r,c=n)}catch(f){s.reject(f)}},r);return s.promise()}function p(e,t){void 0===t&&(t=0);var o=n(),r=null,i=!1;t>0&&(r=setTimeout(function(){i||(i=!0,o.reject({message:"Timedout after "+t}))}));var a=function(e){i||(i=!0,clearTimeout(r),o.resolve(e))};try{e(a)}catch(s){i||(i=!0,clearTimeout(r),o.reject(s))}return o.promise()}function m(e,t){void 0===t&&(t=function(e){return!0});for(var n=o(null),r=0;r<e.length;r++){var i=h(e[r],t,r+1);n=n.alwaysThen(i)}return n}function h(e,t,n){var r=function(n,r,i){return!i&&null!=r&&t(r.value)?o(r):e.value(n).then(function(t){return{name:e.name,value:t}})};return y(r,n)}function g(e,t){return function(){return e(t)}}function v(e,t){return function(n){return e(t,n)}}function y(e,t){return function(n,o){return e(t,n,o)}}function C(e,t){return function(n,o,r){return e(t,n,o,r)}}function b(e,t){void 0===t&&(t=1);for(var n=r({message:"initial state"}),i=0;t>i;i++)n=n.alwaysThen(function(t,n){return n?e():o(t)});return n}function w(e){return function(){
return _(e())}}function _(e){return new k(e)}function S(e,t){var o=n();return E(o,e(),t),o.promise()}function E(e,t,n){t.advance().done(function(o){return o?(n(t.current),void E(e,t,n)):void e.resolve({})}).fail(function(t){return e.reject(t)})}function R(e){return"undefined"==typeof e}t.defer=n,t.resolve=o,t.reject=r,t.unfold=i,function(e){e[e.Unfulfilled=0]="Unfulfilled",e[e.Rejected=1]="Rejected",e[e.Resolved=2]="Resolved"}(t.Status||(t.Status={}));t.Status;t.wait=s,t.waitForEvent=u,t.waitFor=l,t.when=c,t.typedWhen=d,t.waitForStable=f,t.promiseFromCallback=p,t.namedWaterfall=m,t.lambda1=g,t.lambda2=v,t.lambda3=y,t.lambda4=C,t.retryPromise=b;var O=function(){function t(e){this.deferred=e}return t.prototype.getStatus=function(){return this.deferred.getStatus()},t.prototype.getResult=function(){return this.deferred.getResult()},t.prototype.getError=function(){return this.deferred.getError()},t.prototype.done=function(e){return this.deferred.done(e),this},t.prototype.fail=function(e){return this.deferred.fail(e),this},t.prototype.always=function(e){return this.deferred.always(e),this},t.prototype.alwaysThen=function(e){return this.deferred.alwaysThen(e)},t.prototype.then=function(e){return this.deferred.then(e)},t.prototype.logPassthrough=function(t){return this.then(function(n){return e.Logger.log("string"==typeof n||n instanceof String?t+": "+n:t+": "+JSON3.stringify(n)),n})},t}(),F=function(){function t(){this._resolved=function(e){},this._rejected=function(e){},this._status=0,this._error={message:""},this._promise=new O(this)}return t.prototype.promise=function(){return this._promise},t.prototype.getStatus=function(){return this._status},t.prototype.getResult=function(){if(2!=this._status)throw new Error("Promise: result not available");return this._result},t.prototype.getError=function(){if(1!=this._status)throw new Error("Promise: rejection reason not available");return this._error},t.prototype.thenOld=function(e){var t=n();return this.done(function(n){var o=e(n);if(o&&"function"==typeof o.done&&o.deferred){var r=o;return r.done(function(e){return t.resolve(e)}).fail(function(e){return t.reject(e)}),r}t.resolve(o)}).fail(function(e){return t.reject(e)}),t.promise()},t.prototype.then=function(t){var o=n();return this.done(function(n){var r=null;try{r=t(n)}catch(i){return e.Logger.warn("First level error: "+i.message+" @ "+t),void o.reject(i)}if(r&&"function"==typeof r.done&&r.deferred){var a=r;return a.done(function(e){return o.resolve(e)}).fail(function(e){return o.reject(e)}),a}o.resolve(r)}).fail(function(e){return o.reject(e)}),o.promise()},t.prototype.alwaysThen=function(t){var o=n(),r=function(n,r){var i=null;try{i=t(n,r)}catch(a){return e.Logger.warn("First level error: "+a.message+" @ "+t),void o.reject(a)}if(i&&"function"==typeof i.done&&i.deferred){var s=i;return s.done(function(e){return o.resolve(e)}).fail(function(e){return o.reject(e)}),s}o.resolve(i)};return this.done(function(e){return r(e,null)}).fail(function(e){return r(null,e)}),o.promise()},t.prototype.done=function(e){if(2===this.getStatus())return e(this._result),this;if(0!==this.getStatus())return this;var t=this._resolved;return this._resolved=function(n){t(n),e(n)},this},t.prototype.fail=function(e){if(1===this.getStatus())return e(this._error),this;if(0!==this.getStatus())return this;var t=this._rejected;return this._rejected=function(n){t(n),e(n)},this},t.prototype.always=function(e){return this.done(function(t){return e(t)}).fail(function(t){return e(null,t)}),this},t.prototype.resolve=function(e){if(0!==this._status)throw new Error("tried to resolve a fulfilled promise");return this._result=e,this._status=2,this._resolved(e),this.detach(),this},t.prototype.reject=function(e){if(0!==this._status)throw new Error("tried to reject a fulfilled promise");return this._error=e,this._status=1,this._rejected(e),this.detach(),this},t.prototype.detach=function(){this._resolved=function(e){},this._rejected=function(e){}},t}();t.generator=w,t.iterator=_;var k=function(){function e(e){this.f=e,this.current=void 0}return e.prototype.advance=function(){var e=this,t=this.f();return t.then(function(t){return R(t)?!1:(e.current=t,!0)})},e}();t.each=S,t.isUndefined=R}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function n(){}return n.getCountryPromise=function(n){var o=window.FO_COUNTRY;if(o)return e.Logger.log("Impersonaating country "+o),t.resolve(o);var r=n.paths().apiRoot()+"/fo/country.js";return t.jqGetPromise(r).then(function(e){var t=JSON3.parse(e);return t.country}).alwaysThen(function(t,n){return n&&!t?(e.Logger.warn("Failed getting Country.js for context.Defaulting to 'US': "+n.message),t="US"):e.Logger.log("Country resolved as "+t),t})},n}();t.CountryHelper=n}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.encode=function(t){var n,o,r,i,a,s,u,l="",c=0;for(t=e._utf8_encode(t);c<t.length;)n=t.charCodeAt(c++),o=t.charCodeAt(c++),r=t.charCodeAt(c++),i=n>>2,a=(3&n)<<4|o>>4,s=(15&o)<<2|r>>6,u=63&r,isNaN(o)?s=u=64:isNaN(r)&&(u=64),l=l+e._keyStr.charAt(i)+e._keyStr.charAt(a)+e._keyStr.charAt(s)+e._keyStr.charAt(u);return l},e.decode=function(t){var n,o,r,i,a,s,u,l="",c=0;for(t=t.replace(/[^A-Za-z0-9\-\_\=]/g,"");c<t.length;)i=e._keyStr.indexOf(t.charAt(c++)),a=e._keyStr.indexOf(t.charAt(c++)),s=e._keyStr.indexOf(t.charAt(c++)),u=e._keyStr.indexOf(t.charAt(c++)),n=i<<2|a>>4,o=(15&a)<<4|s>>2,r=(3&s)<<6|u,l+=String.fromCharCode(n),64!=s&&(l+=String.fromCharCode(o)),64!=u&&(l+=String.fromCharCode(r));return l=e._utf8_decode(l)},e._utf8_encode=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);128>o?t+=String.fromCharCode(o):o>127&&2048>o?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t},e._utf8_decode=function(e){for(var t="",n=0,o=0,r=0,i=0;n<e.length;)o=e.charCodeAt(n),128>o?(t+=String.fromCharCode(o),n++):o>191&&224>o?(r=e.charCodeAt(n+1),t+=String.fromCharCode((31&o)<<6|63&r),n+=2):(r=e.charCodeAt(n+1),i=e.charCodeAt(n+2),t+=String.fromCharCode((15&o)<<12|(63&r)<<6|63&i),n+=3);return t},e._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",e}();e.Base64=t}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(){}return t.countWords=function(t){var n=e.Col.of(t).groupBy(function(e){return e}),o=n.selectValues(function(e){return e.value.length});return o},t.countWords_old=function(t){var n=e.Col.groupByString(t,function(e){return e}),o=e.Col.hashSelect(n,function(e){return e.length});return o},t.getNonTrivialWords=function(e){var n=new RegExp("^"+window.location.hostname.replace(/\./g,"|")+"$","i"),o=new RegExp(t.trivialWordPattern,"i"),r=[];return e&&(e=t.cleanString(e).toLowerCase(),r=t.splitToDistinctWords(e,function(e){return!o.test(e)&&!n.test(e)&&"|"!=e})),r},t.splitToDistinctWords=function(t,n){var o=t.match(/\S+/g);return o?e.Col.of(o).distinct(function(e){return e}).where(n).toArray():[]},t.cleanString=function(e){return e=e.replace(/(<([^>]+)>)/gi,""),e=e.replace(/\$\d(?:\d|,|&|\.)*/g," "),e=e.replace(/\(.*\)/g," "),e=e.replace(/[\|,\-\/#!$%\^&\*;:{}=\-_`~()@\+\?><\[\]\+]/g," "),e=e.replace(/\./g,function(e,t,n){var o=0!=t&&n[t-1].match(/\d/),r=t!=n.length-1&&n[t+1].match(/\d/);return o&&r?".":" "}),e=e.replace(/\s{2,}/g," "),e=e.replace(/('|\s$)/g,""),/[\u00C0-\u017F]/.test(e)&&(e=t.removeDiacritics(e)),e},t.removeDiacritics=function(e){for(var t=[{base:"A",letters:/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{base:"AA",letters:/[\uA732]/g},{base:"AE",letters:/[\u00C6\u01FC\u01E2]/g},{base:"AO",letters:/[\uA734]/g},{base:"AU",letters:/[\uA736]/g},{base:"AV",letters:/[\uA738\uA73A]/g},{base:"AY",letters:/[\uA73C]/g},{base:"B",letters:/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{base:"C",letters:/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{base:"D",letters:/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{base:"DZ",letters:/[\u01F1\u01C4]/g},{base:"Dz",letters:/[\u01F2\u01C5]/g},{base:"E",letters:/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},{base:"F",letters:/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{base:"G",letters:/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{base:"H",letters:/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{base:"I",letters:/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{base:"J",letters:/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{base:"K",letters:/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},{base:"L",letters:/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{base:"LJ",letters:/[\u01C7]/g},{base:"Lj",letters:/[\u01C8]/g},{base:"M",letters:/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{base:"N",letters:/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{base:"NJ",letters:/[\u01CA]/g},{base:"Nj",letters:/[\u01CB]/g},{base:"O",letters:/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},{base:"OI",letters:/[\u01A2]/g},{base:"OO",letters:/[\uA74E]/g},{base:"OU",letters:/[\u0222]/g},{base:"P",letters:/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{base:"Q",letters:/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{base:"R",letters:/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{base:"S",letters:/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{base:"T",letters:/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{base:"TZ",letters:/[\uA728]/g},{base:"U",letters:/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{base:"V",letters:/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{base:"VY",letters:/[\uA760]/g},{base:"W",letters:/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},{base:"X",letters:/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{base:"Y",letters:/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{base:"Z",letters:/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{base:"a",letters:/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},{base:"aa",letters:/[\uA733]/g},{base:"ae",letters:/[\u00E6\u01FD\u01E3]/g},{base:"ao",letters:/[\uA735]/g},{base:"au",letters:/[\uA737]/g},{base:"av",letters:/[\uA739\uA73B]/g},{base:"ay",letters:/[\uA73D]/g},{base:"b",letters:/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{base:"c",letters:/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{base:"d",letters:/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},{base:"dz",letters:/[\u01F3\u01C6]/g},{base:"e",letters:/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{base:"f",letters:/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{base:"g",letters:/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{base:"h",letters:/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},{base:"hv",letters:/[\u0195]/g},{base:"i",letters:/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{base:"j",letters:/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{base:"k",letters:/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{base:"l",letters:/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{base:"lj",letters:/[\u01C9]/g},{base:"m",letters:/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{base:"n",letters:/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{base:"nj",letters:/[\u01CC]/g},{base:"o",letters:/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},{base:"oi",letters:/[\u01A3]/g},{base:"ou",letters:/[\u0223]/g},{base:"oo",letters:/[\uA74F]/g},{base:"p",letters:/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{base:"q",letters:/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{base:"r",letters:/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{base:"s",letters:/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},{base:"t",letters:/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{base:"tz",letters:/[\uA729]/g},{base:"u",letters:/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{base:"v",letters:/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{base:"vy",letters:/[\uA761]/g},{base:"w",letters:/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},{base:"x",letters:/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{base:"y",letters:/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{base:"z",letters:/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}],n=0;n<t.length;n++)e=e.replace(t[n].letters,t[n].base);return e},t.encodedTrivialWordPattern="XihzZWFyY2h8cmVzdWx0fHJlc3VsdHN8Y29tfGluZm98bmV0fGl0ZW18a2V5d29yZHxrZXl3b3Jkc3xjYXJ0fGZvcnxhY2NvdW50c3xhY2NvdW50fGN1c3RvbWVyfHNlcnZpY2V8c3VwcG9ydHxjb250YWN0fHdlfGRlc2NyaXB0aW9ufHhtbHxwcm94eXxzdHlsZXNoZWV0fHNob3BzfHNob3B8c2hvcHBpbmd8cHJpY2V8bWlufG1heHxvbmxpbmV8aWR8ZW1haWx8c2hpcHxzaGlwcGluZ3x0b3xwZXJzb25hbGl6ZWR8c3VjaGVufGxpZWJsaW5nc3Byb2R1a3R8cHJvZHVrdHxkZXxzdWNoZXxlcmdlYm5pc3xlcmdlYm5pc3NlfGFydGlrZWx8c3RpY2h3b3J0fGpvYnRpdGVsfHdhcmVua29yYnxrdW5kZW5kaWVuc3R8a3VuZGVuc3VwcG9ydHxrb250YWt0aWVyZW58dW50ZXJzdMO8dHp1bmd8d2lyfGJlc2NocmVpYnVuZ3xlaW5rYXVmZW58Z2VzY2jDpGZ0ZXxwcmVpc3xzY2hpZmZzfHZlcnNhbmR8dW50ZXJzdMO8dHp1bmd8c2NodWhlfHphbGFuZG98YWNjb3VudHxwcm9kdWt0ZXxvbmxpbmVzaG9wfHN1Y2hlcmdlYm5pc3NlfHF1ZXJ5fGxhbmdpZHxtYXJrdHxtZWRpYXxtdWx0aWNoYW5uZWxzZWFyY2h8YWNoYXRzfGFjaGF0c3xjb21tZXJjZXxkaXNjb3VudHxyZWNoZXJjaMOpfHJlY2hlcmNoZXxyZWNoZXJjaGVyfHJlY2hlcmNoZXN8Y2hlcmNoZXJ8cHJvZHVpdHxwcm9kdWl0c3xhcnRpY2xlfHLDqXN1bHRhdHxyw6lzdWx0YXRzfHN1aXRlfGNvbnNlcXVlbmNlfHJhaXNvbnxwcml4fHBhZ2V8YXNwfGFzcHh8cGhwfGNob2l4fHByaXh8w6lsZWN0cm9tw6luYWdlcnxhY2N1ZWlsfGhvbWVwYWdlfG1hcmNoYW5kfG1lcmNoYW50fGjDpG5kbGVyfHVybHxodG1sfHByb2RvdHRpfHByb2dyYW1taXxndWFyZGFyZXxwcmV6eml8dHJvdmF8YWNxdWlzdGl8cmljZXJjYXxjb25mcm9udGF8b2ZmZXJ0ZXxjZXJjYXxJc2NyaXZpdGl8QWNjZWRpfGxvZ2lufGVtYWlsfGUtbWFpbHxzY29udGl8bGF2b3JldHRpfG1lbnV8Y29yc298YmVuZXNzZXJlfHBhcmNoZWdnaXxyaWNhcmljYWJpbGV8Y29tcGFyYXxsaXN0c2FsZXN8cmV0dXJudXJsfHNhbGVzfHRhZ3x0YWduYW1lfG9mZmVydGEpJA==",t.trivialWordPattern=e.Base64.decode(t.encodedTrivialWordPattern),t}();e.WordUtils=t}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){t.emptyDedicatedResult={hasDedicated:!1,wordCounts:t.Map.emptyMap(),clientPrice:-1,isHomepage:!1};var n=function(){function n(){}return n.tryScrpaePageByDedicated=function(o,r){var i=r.paths().dynamicContentRoot()+"/site-classification/site/"+o;return t.jqGetPromise(i).then(function(o){if("{}"==o.trim())return e.Logger.log("Empty dedicated definition"),t.emptyDedicatedResult;try{var i=JSON3.parse(o),a=n.parsePageSchema(r,i,r.scraper());return a}catch(s){throw e.Logger.error("Dedicated failed: "+(s&&s.message)),s}})},n.parsePageSchema=function(e,o,r){var i=o.jqxgridHomepage&&o.jqxgridHomepage.some(function(e){return e.text==window.location.href}),a=t.WordUtils.getNonTrivialWords(document.title);i&&(a=[]);var s=r.queryParams(),u=[];if(o.jqxgridUrlParams)for(var l=0;l<o.jqxgridUrlParams.length;l++){var c=o.jqxgridUrlParams[l];if(c.text in s){var d=t.WordUtils.getNonTrivialWords(s[c.text]);u=u.concat(d)}}var f=r.getElementTextByReference(o.jqxgridDescription,!0),p=t.WordUtils.getNonTrivialWords(f),m=p,h=r.getElementTextByReference(o.jqxgridPrice,!1),g=h?Number(h.replace(/[^0-9\.]+/g,"")):n.MAX_PRICE,v=Math.min(g,n.MAX_PRICE),y=n.getMetaTags(),C=o.chkMetaKeywords?t.WordUtils.getNonTrivialWords(y.keywords):[],b=o.chkMetaDescription?t.WordUtils.getNonTrivialWords(y.description):[],w=m.concat(a).concat(b).concat(C).concat(u),_=t.Col.where(w,function(e){return!e.match(/^[\W_]*$/)}),S=t.WordUtils.countWords(_),E={hasDedicated:!0,wordCounts:S,clientPrice:v,isHomepage:i};return E},n.getMetaTags=function(){for(var e=[],t=document.getElementsByTagName("meta"),n=0;n<t.length;n++)"keywords"==t[n].name.toLowerCase()?e.keywords=t[n].content:"description"==t[n].name.toLowerCase()&&(e.description=t[n].content);return e},n.MAX_PRICE=4294967295,n}();t.DedicatedHelper=n}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e,t){this.virgin=!0,this.keyFunc=e,this.valueFunc=t}return e.prototype.value=function(){var e=this.keyFunc();return(this.virgin||e!=this.key)&&(this._value=this.valueFunc(),this.key=e,this.virgin=!1),this._value},e}();e.DependentSingletone=t}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function o(){var t=this;this._queryParams=new n.DependentSingletone(function(){return window.location.href},function(){return t.parseQueryString(window.location)}),this._documentHTML=new n.DependentSingletone(function(){return window.location.href},function(){return e.$(document.documentElement).html()})}return o.prototype.documentHTML=function(){return this._documentHTML.value()},o.prototype.queryParams=function(){return this._queryParams.value()},o.prototype.parseQueryString=function(e){for(var t=e.search.substring(1).split("&"),n=e.hash.substring(1).split("&"),r=n.concat(t),i={},a=0;a<r.length;a++){var s=decodeURIComponent(r[a]);if(-1==s.indexOf("="))i[s]=o.VALUELESS_PARAM;else{var u=s.split("=");i[u[0]]=u[1]}}return i},o.prototype.testPatternsAgainstHTML=function(e){for(var t=0;t<e.length;t++){var n=new RegExp("(^|[^a-z|A-Z])("+e[t]+")($|[^a-z|A-Z])","ig"),o=this.documentHTML().match(n),r=o?o.length:0;if(r)return 1}return 0},o.prototype.getElementTextByReference=function(e,n){var r=[function(e){return e.xpath&&o.getElementByXpath(e.xpath.trim())},function(e){return e.id&&document.querySelector("#"+e.id.trim())},function(e){return e.name&&document.getElementsByName(e.name.trim())[0]},function(e){return e["class"]&&document.querySelector("."+e["class"].trim())}],i="";try{for(var a=0;a<e.length;a++)for(var s=e[a],u=0;u<r.length;u++){var l=r[u],c=l(s);if(c){if(!n)return o.getInnerText(c);i=i+o.getInnerText(c)+" "}}}catch(a){t.Logger.warn("Failure in dedicated field parsing. Skipping field")}return i},o.getInnerText=function(e){return e.innerText},o.getElementByXpath=function(e){return document.evaluate&&document.evaluate(e,document,null,9,null).singleNodeValue},o.prototype.getFirstMatchText=function(e,t){void 0===t&&(t="");for(var n=0;n<e.length;n++){var r=e[n],i=document.querySelector(r);if(i){var a=o.getInnerText(i);if(a)return a}}return t},o.prototype.scrapeGenericPageWordCounts=function(){var e=document.querySelectorAll("input[type='search']"),t=n.Col.select(n.Col.numValues(e),function(e){return e.value}).join(" "),o=n.WordUtils.getNonTrivialWords(t),r=[].concat(o).concat(o),i=this.getFirstMatchText(["h1"]),a=n.WordUtils.getNonTrivialWords(i),s=n.WordUtils.getNonTrivialWords(document.title),u=document.querySelectorAll("input[type='text']"),l=n.Col.select(n.Col.numValues(u),function(e){return e.value}).join(" "),c=n.WordUtils.getNonTrivialWords(l),d=n.Col.where(n.Col.values(this.queryParams()),function(e){return e.length>0}).join(" "),f=n.WordUtils.getNonTrivialWords(d),p=[].concat(r).concat(a).concat(s).concat(c).concat(f),m=n.WordUtils.countWords(p);return m},o.prototype.getElementPosWithOffsets=function(e){return n.VisualHelper.getElementPosWithOffsets(e)},o.VALUELESS_PARAM="",o}();n.DefaultPageScraper=o}(n=t.Common||(t.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(n,o,r,i,a,s){t.call(this,n.paths(),n.params(),n.extraParams,n.overrides()),this._countryCode=o,this._userSettings=r,this._suspender=i,this._iframe=a,this._scraper=new e.Common.DefaultPageScraper,this._fnWindow=window}return __extends(n,t),n.prototype.countryCode=function(){return this._countryCode},n.prototype.userSettings=function(){return this._userSettings},n.prototype.suspender=function(){return this._suspender},n.prototype.scraper=function(){return this._scraper},n.prototype.iframe=function(){return this._iframe},n.prototype.fnWindow=function(){return this._fnWindow},n.prototype.notificationParams=function(){var e=t.prototype.notificationParams.call(this);return e.hid=this.userSettings().uuid(),e},n.initializePromise=function(t,o,r,i,a){var s=e.Common.CountryHelper.getCountryPromise(t);return e.Common.namedWhen2({CC:s,US:o,SU:r}).then(function(e){var o=e.CC,r=e.US,s=e.SU;return new n(t,o,r,s,i,a)})},n}(t.BootstrapContext);t.ApplicationContext=n}(t=e.Context||(e.Context={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(e){function t(t,n,o){e.call(this,t,t.countryCode(),t.userSettings(),t.suspender(),t.iframe(),t.fnWindow()),this.productName=n,this.visual=o}return __extends(t,e),t.prototype.notificationParams=function(){var t=e.prototype.notificationParams.call(this);return t.pname=this.productName,t.w=this.visual.flag(),t},t}(e.ApplicationContext);e.VisualContext=t}(t=e.Context||(e.Context={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(e){function t(t,n,o,r){e.call(this,t,n,r),this._logic=o}return __extends(t,e),t.prototype.logic=function(){return this._logic},t.prototype.notificationParams=function(){var t=e.prototype.notificationParams.call(this);return t.pr=this.logic().flag(),t},t}(e.VisualContext);e.LVContext=t}(t=e.Context||(e.Context={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e,t){this.primaryCount=e,this.secondaryCount=t}return e.prototype.totalCount=function(){return this.primaryCount+this.secondaryCount},e}();e.ItemCounts=t}(t=e.Products||(e.Products={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e,t,n,o){void 0===o&&(o={}),this.source=e,this.context=t,this.data=n,this.extras=o}return e.prototype.hasData=function(){return this.data&&this.data.length>0},e}();e.PlainDataResult=t;var n=function(){function e(e,t){this.source=e,this.context=t}return e.prototype.hasData=function(){return!0},e}();e.StubDataResult=n;var o=function(e){function t(t,n,o){e.call(this,t,n),this.generator=o}return __extends(t,e),t.prototype.generateData=function(e,t,n){return this.generator(e,t,n)},t}(n);e.DataGeneratorResult=o}(t=e.Data||(e.Data={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){!function(e){e[e.LEFT_PANEL=0]="LEFT_PANEL",e[e.RIGHT_PANEL=1]="RIGHT_PANEL",e[e.TOP_PANEL=2]="TOP_PANEL",e[e.BOTTOM_PANEL=3]="BOTTOM_PANEL",e[e.MAIN_TABLE=4]="MAIN_TABLE",e[e.MAIN_IMAGE=5]="MAIN_IMAGE",e[e.IMAGE_RIGHT=6]="IMAGE_RIGHT",e[e.IMAGE_INNER=7]="IMAGE_INNER",e[e.APPNEXUS_SPECIAL=8]="APPNEXUS_SPECIAL",e[e.BANNER_SQUERE=9]="BANNER_SQUERE",e[e.SEARCH_BAR=10]="SEARCH_BAR"}(e.VisualRealEstate||(e.VisualRealEstate={}));e.VisualRealEstate}(t=e.Products||(e.Products={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this.datastore=null,window.FO.GlobalStore||(window.FO.GlobalStore={}),this.datastore=window.FO.GlobalStore,e&&(e in this.datastore||(this.datastore[e]={}),this.datastore=this.datastore[e])}return e.prototype.retrive=function(e){return this.datastore[e]},e.prototype.store=function(e,t){this.datastore[e]=t},e.prototype.remove=function(e){delete this.datastore[e]},e.prototype.retriveAndRemove=function(e){var t=this.retrive(e);return this.remove(e),t},e}();e.GlobalSpace=t}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(){this.dataSyncStore=new e.GlobalSpace("DataSync")}return t.prototype.getAll=function(){var e=this.dataSyncStore.retrive("DataItems");return e||(e={}),e},t.prototype.setAll=function(e){this.dataSyncStore.store("DataItems",e)},t.prototype.claim=function(e,t,n){void 0===n&&(n=!1);var o=this.getAll(),r=e in o;return(!r||n)&&(o[e]=t),this.setAll(o),r},t.prototype.cliamWithoutMarking=function(t,n,o,r){void 0===r&&(r=[]);for(var i=[],a=e.Col.select(r,n),s=0;s<t.length&&!(i.length>=o);s++){var u=t[s],l=n(u),c=e.Col.contains(a,l);c||i.push(u)}return i},t.prototype.claimUniques=function(t,n,o,r,i,a){void 0===i&&(i=!0),void 0===a&&(a=[]);for(var s=[],u=[],l=[],c=this.getAll(),d=e.Col.select(a,n),f=0;f<t.length;f++){var p=t[f],m=n(p),h=e.Col.contains(d,m);if(!h)if(m in c)u.push(p);else if(s.push(p),c[m]=o,s.length>=r)break}if(this.setAll(c),i){var g=this.cliamWithoutMarking(u,n,r-s.length,s);l=s.concat(g)}else l=s;return l},t}();e.DataSynchronizer=t}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(e,t,n){this.logic=null,this.name=e,this.logics=t,this.visual=n}return t.prototype.shouldReload=function(){return this.visual.shouldReload&&this.visual.shouldReload(this)?(e.Logger.info("Visual requested product reload for product: ["+this.name+"]"),!0):!1},t.prototype.classify=function(e){return this.logic.classify(e)},t}();t.Product=n}(t=e.Products||(e.Products={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.disable=function(){return window.FO_FORGET},e.getHistoricalClassification=function(t){if(e.disable())return 0;var n="FO.Classification."+t.flag(),o=localStorage.getItem(n),r=(new Date).getTime();return o&&parseInt(o)>r?1:0},e.setHistoricalClassification=function(t,n){if(void 0===n&&(n=3600),!e.disable()){var o="FO.Classification."+t.flag(),r=(new Date).getTime(),i=r+1e3*n;localStorage.setItem(o,i+"")}},e}();e.ElephantClassifier=t}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.treatForCollisions=function(t){t.addClass(e.antiCollisionClass),t.find("*").addClass(e.antiCollisionClass)},e.antiCollisionClass="fo-close-xyz sgsefvhuedc",e}();e.CollisionHelper=t}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(t){var n;!function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL",e[e.BOTH=2]="BOTH"}(n||(n={}));var o=function(){function n(){}return n.createAndBindDisplay=function(o,r,i,a,s){if(null==s)throw new Error("Parent elmenet missing");var u=e.$(o).addClass(r);t.CollisionHelper.treatForCollisions(u),n.safeAppend(s,u,!0);var l=u[0];i.postRenderHandler=function(){t.Col.of(a).each(function(e){return e.afterRender(u,l)})};try{e.ko.applyBindings(i,l)}catch(c){throw t.Col.of(a).each(function(e){return e.remove&&e.remove()}),u.remove(),c}return l},n.appendHtmlWithRootClass=function(t,o,r){void 0===r&&(r=document);var i=e.$(t).addClass(o);return n.appendToBody(i,r),i},n.parseAndAppendHtmlToElement=function(t,n){var o=e.$.parseHTML(t);return e.$(n).append(o)},n.appendToDivById=function(e,t,o){void 0===o&&(o=document);var r=o.getElementById(e);n.safeAppend(r,t,!1)},n.appendToBody=function(e,t){void 0===t&&(t=document);var o=t.documentElement.getElementsByTagName("body")[0];n.safeAppend(o,e,!1)},n.appendToHead=function(e,t){void 0===t&&(t=document);var o=t.documentElement.getElementsByTagName("head")[0];n.safeAppend(o,e,!1)},n.safeAppend=function(t,n,o){var r="ver"+(1e7*Math.random()).toFixed();if(n.addClass(r),o?e.$(t).prepend(n):e.$(t).append(n),0==e.$("."+r).length){var i=n[0],a=t.childElementCount>0?t.children.item(0):null;if(t.insertBefore(i,a),0==e.$("."+r).length)throw new Error("Root element cannot be found after supposadly appended")}},n.elementBelowTheFold=function(t,n){var o=e.$(window).height()+e.$(window).scrollTop();return o<=e.$(t).offset().top+e.$(t).height()*n},n.elementAboveTheTop=function(t,n){var o=e.$(window).scrollTop(),r=e.$(t).height();return o>=e.$(t).offset().top+r-r*n},n.elementRightOfScreen=function(t,n){var o=e.$(window).width()+e.$(window).scrollLeft();return o<=e.$(t).offset().left-e.$(t).width()*n},n.positionNextTo=function(t,o,r,i){void 0===r&&(r=0),void 0===i&&(i=window);var a,s=n.getElementPosWithOffsets(t[0]),u=t.width(),l=o.width(),c=s.left+u+r+l<i.innerWidth,d=s.left-r>l;a=c?s.left+u+r:d?s.left-r-l:(i.innerWidth-l)/2;var f=Math.min(s.top,e.$(i).scrollTop()+e.$(i).height()-o.height());return{x:a,y:f}},n.getElementPosWithOffsets=function(e){if(e&&e.getBoundingClientRect){var t={top:0,left:0,width:0,height:0,bottom:0,right:0},n=e&&e.ownerDocument;if(t=e.getBoundingClientRect(),!n)return t;var o=n.defaultView||n.parentWindow,r=n.documentElement,i=t.top+(o.pageYOffset||r.scrollTop||0)-(r.clientTop||0),a=t.left+(o.pageXOffset||r.scrollLeft||0)-(r.clientLeft||0),s=e.offsetWidth||0,u=e.offsetHeight||0,l=i+u,c=a+s;return{top:i,left:a,width:s,height:u,bottom:l,right:c}}},n.isContained=function(e,t,n){return e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom},n.elementLeftOfScreen=function(t,n){var o=e.$(window).scrollLeft(),r=e.$(t).width();return o>=e.$(t).offset().left+r-r*n},n.isElementInViewport=function(e,t){
return t=t||0,!(n.elementRightOfScreen(e,t)||n.elementLeftOfScreen(e,t)||n.elementBelowTheFold(e,t)||n.elementAboveTheTop(e,t))},n}();t.VisualHelper=o}(n=t.Common||(t.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function o(e,t){this.paths=null,this.paths=e;var o=n.generateGuid(16);this.iframePromise=this.createIFrame(o,e.iframeStoreSrc(),t)}return o.prototype.createIFrame=function(o,r,i){var a=this,s=n.defer(),u=document.createElement("iframe");return u.id=o,u.src=i?r+"#debug":r,u.style.position="absolute",u.style.width="1px",u.style.height="1px",u.style.left="-100px",u.style.top="-100px",u.style.visibility="hidden",n.VisualHelper.appendToBody(e.$(u)),n.attachPostMessageHandler(window,this.createHandleCallback(this.paths.rootUrl())),t.Logger.log("IFrameStore setup"),u.onload=function(){t.Logger.info("IFrame trying echo on onload"),a.verifyIFramePromise(u).fail(function(e){t.Logger.warn("IFrame echo failed");var n=e.message?e.message:e+"";s.reject({message:"Store IFrame echo after load failure: "+n})}).done(function(){t.Logger.info("Store IFrame alive and well.Loaded and echoes"),s.resolve(u)})},u.onerror=function(e){t.Logger.info("IFrame trying echo on onerror"),a.verifyIFramePromise(u).fail(function(n){t.Logger.warn("IFrame echo failed");var o=n.message?e.message:n+"";s.reject({message:"Store IFrame echo after error failure: "+o})}).done(function(){t.Logger.warn("Store IFrame alive and well even though error reported. WTF."),s.resolve(u)})},s.promise()},o.prototype.verifyIFramePromise=function(e){return this.postRequestPromise(e,"retrieveOrSet",!0,"echo","echo")},o.prototype.postRequest=function(e,t,n,o){var r=this;return this.iframePromise.then(function(i){return r.postRequestPromise(i,e,t,n,o)})},o.prototype.postRequestPromise=function(e,t,r,i,a){var s=n.defer(),u=!1,l=n.generateGuid(9);window.setTimeout(function(){if(!u){u=!0;var e={message:"IFrameStore request of type: "+t+". key: "+i+". Has timed out after "+o.REQUEST_TIMEOUT_MS};s.reject(e)}},o.REQUEST_TIMEOUT_MS),r&&o.getGlobalCallMap().store(l,function(e){u||(u=!0,s.resolve(e))});var c={id:l,type:t,key:i,value:a},d=JSON3.stringify(c);return e.contentWindow.postMessage(d,e.src),s.promise()},o.getGlobalCallMap=function(){return new n.GlobalSpace("postMessageCallbacks")},o.prototype.createHandleCallback=function(e){return function(t){var n=!1,r=o.getMainDomain(e),i=o.getMainDomain(t.origin);if(n||i==r)try{var a=JSON3.parse(t.data),s=o.getGlobalCallMap().retriveAndRemove(a.id);s&&s(a.value)}catch(u){}}},o.getMainDomain=function(e){if(-1!=e.indexOf("//localhost"))return"localhost";var t=/\/\/[^\.]+\.((?:[^\.\/]*\.+)?[^\.\/]*)/gi,n=t.exec(e)[1];return n},o.prototype.retrieveAll=function(){return this.postRequest("retrieveAll",!0)},o.prototype.retrieveOrSet=function(e,t){return this.postRequest("retrieveOrSet",!0,e,t)},o.prototype.retrieve=function(e){return this.postRequest("retrieve",!0,e)},o.prototype.store=function(e,t){this.postRequest("store",!1,e,t)},o.prototype.storeAll=function(e){this.postRequest("storeAll",!1,null,e)},o.REQUEST_TIMEOUT_MS=300,o}();n.IFrameStore=o}(n=t.Common||(t.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this.randomNumberSelector=e}return e.prototype.itemByOdds2=function(e,t,n){for(var o=0,r=this.randomNumberSelector(),i=0;i<e.length;i++){var a=e[i],s=n(a);if(o+=s,o>r)return t(a)}},e.prototype.itemByOdds1=function(e,t){return this.itemByOdds2(e,function(e){return e},t)},e.prototype.itemByWeights2=function(e,t,n){for(var o=0,r=0;r<e.length;r++)o+=n(e[r]);return this.itemByOdds2(e,t,function(e){return n(e)/o})},e.prototype.itemByWeights1=function(e,t){return this.itemByWeights2(e,function(e){return e},t)},e}();e.RandomProviderDelegate=t}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(e,t){this.asyncStore=e,this.data=t}return t.prototype.uuid=function(){return this.data.uuid},t.prototype.retrive=function(e){return this.data[e]},t.prototype.store=function(e,t){this.data[e]=t,this.commitChanges()},t.prototype.remove=function(e){delete this.data[e],this.commitChanges()},t.prototype.retriveAndRemove=function(e){var t=this.data[e];return delete this.data[e],this.commitChanges(),t},t.prototype.reload=function(){var n=this;return this.asyncStore.retrieve(t.USER_SETTINGS_KEY).alwaysThen(function(t,o){o?o&&e.Logger.warn("Failed reloading userSetting."):n.data=t})},t.prototype.commitChanges=function(){this.asyncStore.store(t.USER_SETTINGS_KEY,this.data),localStorage.setItem(t.USER_SETTINGS_KEY,JSON3.stringify(this.data))},t.fromAsyncStorePromise=function(n,o){var r={uuid:o,suspend:{}};return n.retrieveOrSet(t.USER_SETTINGS_KEY,r).alwaysThen(function(o,i){var a=null;if(i){e.Logger.warn("Failed getting real userSetting using default: "+(i&&i.message));var s=localStorage.getItem(t.USER_SETTINGS_KEY),u=null;try{u=JSON3.parse(s)}catch(l){}u&&u.uuid?(e.Logger.warn("Using localStorage info in place of iframe settings:"),e.Logger.info(s),a=u):(e.Logger.info("localStorage info missing or misshaped will use default values for user settings"),a=r)}else e.Logger.info("Using true iframe data for user settings"),a=o,localStorage.setItem(t.USER_SETTINGS_KEY,JSON3.stringify(o));return new t(n,a)}).fail(function(t){e.Logger.error("Failed loading async store for userSettings: "+t.message)})},t.USER_SETTINGS_KEY="userSettings",t}();t.LooseUserSettings=n}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function n(){}return n.resolveProductsByRealEstate=function(o,r){var i=[],a=t.Col.groupByString(r,function(t){return e.Products.VisualRealEstate[t.product.visual.realEstate()]});for(var s in a){var u=a[s],l=t.Col.maxBy(u,function(e){return e.score});i.push(l.product)}for(var c=new t.GlobalSpace("RealEstate"),d=[],f=0;f<i.length;f++){var p=i[f],m=e.Products.VisualRealEstate[p.visual.realEstate()],h=n.isTaken(c,m);h?(e.Logger.info("Product "+p.name+" skipped. Its realestate "+m+" is occupied"),e.Logger.Analytics.notify(o,e.Logger.Analytics.NO_SHOW,{reason:"realestate_taken",w:p.visual.flag()},0)):(n.claimRealestate(c,m,p.name),c.store(m,p.name),d.push(p))}return d},n.isTaken=function(e,t){var o=!!e.retrive(t);if(o)return!0;var r=n.realEstateToOldMarker(t);if(r){var i=!!window[r];if(i)return!0}return!1},n.claimRealestate=function(e,t,o){e.store(t,o);var r=n.realEstateToOldMarker(t);r&&(window[r]=!0)},n.releaseRealestate=function(o){var r=new t.GlobalSpace("RealEstate");r.remove(o);var i=n.realEstateToOldMarker(o);i&&(window[i]=!1),e.Logger.log("Released realestate "+o)},n.realEstateToOldMarker=function(e){var t={RIGHT_PANEL:"__rsor",BOTTOM_PANEL:"__bsor"};return t[e]},n}();t.RealEstateHelper=n}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(){}return t.perform=function(e,n){var o=t.singletoneStore.retrive(e);if(o)return o.promise;var r=n();return o={initTime:(new Date).getTime(),promise:r},t.singletoneStore.store(e,o),r},t.singletoneStore=new e.GlobalSpace("Singletones"),t}();e.GlobalSingletone=t}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var Injector=function(){function e(){}return e.getAltDocument=function(){if(null==e.altDocument){var t=document.createElement("iframe");t.height=t.width="0",document.body.appendChild(t),e.altDocument=t.contentWindow.document}return e.altDocument},e.injectScript=function(t,n,o){var r=null,i=!0,a=!1,s=document.createElement;s.toString().indexOf("[native code]")>0?r=document.createElement("script"):(r=e.getAltDocument().createElement.call(document,"script"),i=!1),r.onload=r.onreadystatechange=function(e){a||r.readyState&&"loaded"!==r.readyState&&"complete"!==r.readyState||(a=!0,r.parentNode&&r.parentNode.removeChild(r),n&&window.setTimeout(function(){n()},1))},r.onerror=function(e){a||(a=!0,o&&window.setTimeout(function(){o(e)},1))};var u=document.getElementsByTagName("head")[0],l=u.appendChild;return l.toString().indexOf("[native code]")>0?u.appendChild(r):(e.getAltDocument().appendChild.call(u,r),i=!1),r.src=t,i},e.altDocument=null,e}(),FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(){}return t.injectScriptRetryPromise=function(n,o){void 0===o&&(o=0);var r=function(){return t.injectScriptPromise(n)};return e.retryPromise(r,o+1)},t.injectScriptPromise=function(t){var n=e.defer();return Injector.injectScript(t,function(){return n.resolve(null)},function(e){return n.reject({message:"Failed script load "+t+": "+(e&&e.message)})}),n.promise()},t.promiseFromLoader=function(t,n){var o=e.defer(),r=!1;return t.onload=t.onreadystatechange=function(e){r||t.readyState&&4!=t.readyState&&"loaded"!==t.readyState&&"complete"!==t.readyState||(r=!0,o.resolve(t))},t.onerror=function(e){r=!0,o.reject({message:"unknown load error"})},t.ontimeout=function(e){r=!0,o.reject({message:"timeout error"})},o.promise()},t.nativeAjax=function(e){var n=null;if("XDomainRequest"in window){var o=new XDomainRequest;o.open("get",e),n=t.promiseFromLoader(o,e),o.send()}else{var r=new XMLHttpRequest;r.open("get",e,!0),n=t.promiseFromLoader(r,e),r.send()}return n.then(function(e){if(200==e.status)return e.responseText;throw Error(e.statusText)})},t}();e.NativeJSHelper=t}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function o(){}return o.bring=function(e){return n.jqGetPromise(e)},o.injectCss2=function(t,o){if(void 0===o&&(o=document),o.createStyleSheet)o.createStyleSheet(t);else{var r=e.$('<link rel="stylesheet" type="text/css" href="'+t+'" />');n.VisualHelper.appendToHead(r,o)}return n.resolve(null)},o.injectScript=function(e){return n.NativeJSHelper.injectScriptRetryPromise(e,2)},o.loadProduct=function(e,r,i,a){var s=o.instantiateVisual(a),u=n.Col.select(i,function(e){return o.instantiateLogic(e)}),l=new t.Products.Product(r,u,s);return n.resolve(l)},o.instantiateLogic=function(e){var t=["FO.Shared_0_0_516.Products.Logic."+e,"FO.Shared_0_0_516.ExternalProducts."+e],r=n.Col.of(t).selectFirst(function(e){return o.instantiateFromQualifiedName(e,!1)});if(!r)throw new Error("Failed to instantiate logic "+e);return r},o.instantiateVisual=function(e){var t=["FO.Shared_0_0_516.Products.Visual."+e,"FO.Shared_0_0_516.ExternalProducts."+e],r=n.Col.of(t).selectFirst(function(e){return o.instantiateFromQualifiedName(e,!1)});if(!r)throw new Error("Failed to instantiate visual "+e);return r},o.instantiateFromQualifiedName=function(e,t){void 0===t&&(t=!0);for(var n=e.split("."),o=window,r=0;r<n.length;r++){if(!(n[r]in o)){if(t)throw Error("Cannot instantiate from qualified name. "+n[r]+" not found for path "+e);return null}o=o[n[r]]}return new o},o}();n.Res=o}(n=t.Common||(t.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(FO){var Shared;!function(Shared){var Common;!function(Common){var ExternalResources=function(){function ExternalResources(){}return ExternalResources.getJQuery=function(e){return ExternalResources.patchExternalOrFallback("//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js",-2041667497,ExternalResources.patchJQuery,e+"jquery-1.11.1.js",ExternalResources.verifyJQuery).then(function(){return window.FO.$=window.$.noConflict(!0)})},ExternalResources.patchJQuery=function(e){var t=',"function"==typeof define&&define.amd&&define("jquery",[],function(){return m})',n=e.replace(t,"");if(n.length!=e.length-t.length)throw new Error("Replace didnt take effect");return n},ExternalResources.verifyJQuery=function(){return"1.11.1"===window.$.fn.jquery},ExternalResources.getKnockout=function(e){return ExternalResources.patchExternalOrFallback("//cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-min.js",-1013341204,ExternalResources.patchKnockout,e+"knockout-3.3.0.js",ExternalResources.verifyKnockout)},ExternalResources.patchKnockout=function(e){var t='"function"===typeof define&&define.amd?define(["exports","require"],p):"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?p(module.exports||exports):p(y',n='p(window["FO"]',o=e.replace(t,n);if(o.length!=e.length-t.length+n.length)throw new Error("Replace didnt take effect");return o},ExternalResources.verifyKnockout=function(){return"3.3.0"==FO.ko.version},ExternalResources.patchExternalOrFallback=function(e,t,n,o,r){return void 0===r&&(r=function(){return!0}),ExternalResources.loadAndPatchExternal(e,t,n).then(function(){if(!r())throw new Error("External patch failed verification on "+e)}).alwaysThen(function(t,n){return n?(Shared.Logger.warn("Failed external patching on "+e+": "+n.message),ExternalResources.loadFallback(o).then(function(){if(!r())throw new Error("External fallback failed on "+o)})):Common.resolve(null)})},ExternalResources.loadAndPatchExternal=function(externalUrl,verificationHash,patch){return Common.NativeJSHelper.nativeAjax(externalUrl).then(function(original){var originalHash=Common.stringHash(original);if(originalHash!=verificationHash)throw new Error("Original didnt match verification hash");var patched=patch(original);eval(patched)})},ExternalResources.loadFallback=function(e){return Common.NativeJSHelper.injectScriptRetryPromise(e,3)},ExternalResources}();Common.ExternalResources=ExternalResources}(Common=Shared.Common||(Shared.Common={}))}(Shared=FO.Shared_0_0_516||(FO.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(e){function t(t,n,o,r){e.call(this,t,t.countryCode(),t.userSettings(),t.suspender(),t.iframe(),t.fnWindow()),this.productName=n,this.logic=o,this.visual=r}return __extends(t,e),t.prototype.notificationParams=function(){var t=e.prototype.notificationParams.call(this);return t.pname=this.productName,t.pr=this.logic.flag(),t.w=this.visual.flag(),t},t}(e.ApplicationContext);e.ProductContext=t}(t=e.Context||(e.Context={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){!function(e){e[e.Large=300]="Large",e[e.Medium=189]="Medium",e[e.Small=99]="Small"}(n.ImageMinHeight||(n.ImageMinHeight={}));var o=(n.ImageMinHeight,function(){function o(){}return o.getProductImage=function(){var t=new e.NWPLegacy;return t.ImageUtils.getLargestImage()},o.getFirstEcommerceImage=function(e,t){var n=o.getAllEcommerceImages(!0,!0,!1);return n.length>0?n[0]:null},o.getAllEcommerceImages=function(t,o,r){var i=n.Col.ofElements(document.images).where(function(r){var i=e.$(r);return t&&!i.is(":visible")?!1:o&&!n.VisualHelper.isElementInViewport(i,.9)?!1:i.hasClass("fo-offer-img")||!n.ImageUtils.isImageValid(i[0])?!1:!0});return r&&(i=i.stableSort(function(e,t){return t.height-e.height})),i.toArray()},o.findValidImagesBySize=function(t,o,r){var i=n.Col.ofElements(document.images).where(function(t){var o=e.$(t);return o.is(":visible")&&!o.hasClass("fo-offer-img")&&n.ImageUtils.isImageValid(o[0])?r?n.VisualHelper.isElementInViewport(o,.9):!0:!1});return i=i.stableSort(function(e,t){return t.height-e.height}),i.length()>0?(2==this.imageSizeToRibbonSize(i.getItem(0).height)&&(t=0),i.skip(t).take(o).toArray()):[]},o.imageSizeToRibbonSize=function(e){return e>=300?2:e>=189?1:0},o.getLargestImageText=function(){var t=new e.NWPLegacy,n=t.ImageUtils.getLargestImage(),r=n?t.utils.getImgText(n,5):null;return r&&(r=o.removeStopWords(r)),r},o.getImageText=function(n){var r=new e.NWPLegacy;try{var i=n?r.utils.getImgText(n,5):null;return i&&(i=o.removeStopWords(i)),i}catch(a){return t.Logger.error("Failure in getImageText: "+a.message),""}},o.isImageValid=function(e){return o.imageHasStandardEcommerceDimensions(e)&&o.isImageExtensionValid(e)&&!o.imageHasClickableAreas(e)},o.imageHasStandardEcommerceDimensions=function(e){var t=4200,n=.45,o=2.1,r=e.width,i=e.height;if(t>r*i)return!1;var a=r/i;return r*i>3*t&&(n>a||a>o)?!1:!0},o.isImageExtensionValid=function(e){var t="";try{t=e.src.toLowerCase()}catch(n){return!1}var o=t.indexOf("?");if(-1!=o&&(t=t.substring(0,o)),t.length<4)return!1;var r=t.substring(t.length-4,t.length);return".gif"==r||".png"==r?!1:!0},o.imageHasClickableAreas=function(e){return e.getAttribute("usemap")?!0:!1},o.removeStopWords=function(e){for(var t=["by","-","of","for","in","a","the","at","is","with","to","this","and","usd","eur","br","product","details"],n=0;n<t.length;n++){var o="\\s+("+t[n]+")\\s+",r=new RegExp(o,"g");e=(" "+e+" ").replace(r," ")}return e=e.trim()},o}());n.ImageUtils=o}(n=t.Common||(t.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(){}return t.imageScrapeLogic=function(n,o){var r=e.ImageUtils.findValidImagesBySize(0,4,!1);return t.imageScrapeLogicWithSupporting(n,o,r)},t.imageScrapeLogicWithSupporting=function(t,n,o){var r=t.scraper(),i=["search","here","keyword","keywords","product","products","username","email","password","enter"],a=["q","Search","search","searchterm","searchTerm","search_query","query","Keywords","keywords","field-keywords","w","kw","origkw","SearchString","searchString","keys","text","Ntt","qu","Keyword","keyword","SearchTerms","searchTerms"],s=10,u=t.overrides().intValue("deal-scrape-weights.search",8),l=t.overrides().intValue("deal-scrape-weights.text",1),c=t.overrides().intValue("deal-scrape-weights.title",6),d=t.overrides().intValue("deal-scrape-weights.importantqs",20),f=t.overrides().intValue("deal-scrape-weights.otherqs",1),p=new e.WordCounter,m=e.ImageUtils.getImageText(n);if(m){var h=e.WordUtils.getNonTrivialWords(m);p.push(h,"Product Image",s);var g=e.WordUtils.getNonTrivialWords(document.title),v=e.Col.intersect(h,g);if(p.push(v,"Product Image And Title Intersect",c),o){for(var y=0;y<o.length;y++)if(n!=o[y]){var C=e.ImageUtils.getImageText(o[y]);if(C){var b=e.WordUtils.getNonTrivialWords(C),w=e.Col.intersect(h,b);p.push(w,"Extra image word intersection",s)}}var _=document.querySelectorAll("input[type='search']"),S=e.Col.select(e.Col.numValues(_),function(e){return e.value}).join(" "),E=e.WordUtils.getNonTrivialWords(S);if(0==e.Col.intersect(E,i).length){var R=e.Col.intersect(h,E);p.push(R,"Search inputs",u)}var O=document.querySelectorAll("input[type='text']"),F=e.Col.select(e.Col.numValues(O),function(e){return e.value}).join(" "),k=e.WordUtils.getNonTrivialWords(F);if(0==e.Col.intersect(k,i).length){var x=e.Col.intersect(h,k);p.push(x,"Text inputs",l)}var D=[],T=[];for(var A in r.queryParams())if(e.Col.contains(a,A)){var P=r.queryParams()[A];D=D.concat(P.replace(/\+/g," ").trim().split(" "))}else{var P=r.queryParams()[A];T=T.concat(P.replace(/\+/g," ").trim().split(" "))}var I=e.Col.intersect(h,D);p.push(I,"Recognized query string",d);var H=e.Col.intersect(h,T);p.push(H,"Unknown query string",f)}var M=t.overrides().boolValue("deals-logic.filter-empty-words",!0),B=e.Col.where(p.getWords(),function(e){return M?!e.match(/^[\s]*$/):!e.match(/^[\W_]*$/)}),N=e.WordUtils.countWords(B);return N}return e.Map.emptyMap()},t}();e.ScrapingLogics=t}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function n(){this.words=[]}return n.prototype.push=function(e,t,n){void 0===n&&(n=1);for(var o=0;o<e.length;o++)this.words.push({word:e[o],origin:t,count:n})},n.prototype.contains=function(e){for(var t=0;t<this.words.length;t++)if(this.words[t].word==e)return!0;return!1},n.prototype.pushAndAmplify=function(e,n,o){var r=this;void 0===o&&(o=1),t.Col.of(e).each(function(e){var t=o>0||r.contains(e);t&&r.words.push({word:e,origin:n,count:Math.abs(o)})})},n.prototype.getWords=function(){e.Logger.log(this.describe());for(var t=[],n=0;n<this.words.length;n++)for(var o=this.words[n],r=0;r<o.count;r++)t.push(o.word);return t},n.prototype.describe=function(){for(var e="Words: ",t=0;t<this.words.length;t++)e+="\n"+this.words[t].word+" ("+this.words[t].origin+" x "+this.words[t].count+")";return e},n}();t.WordCounter=n}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function o(){}return o.breakdownHost=function(){for(var e=document.location.host,t="weird_get_top_level_domain=cookie",n=e.split("."),o=n.length-1;o>=0;o--){var r=n.slice(o).join(".");if(document.cookie=t+";domain=."+r+";",document.cookie.indexOf(t)>-1){document.cookie=t.split("=")[0]+"=;domain=."+r+";expires=Thu, 01 Jan 1970 00:00:01 GMT;";{var i=n.slice(0,o).join("."),a=n[o],s=n.slice(o+1).join(".");document.location.protocol+"//"}return[i+"."+a+"."+s,a+"."+s,a]}}return[e]},o.blackWhiteMatch=function(e,t,r,i){var a={};return null!=t&&(a.white=n.jqGetPromise(t)),null!=r&&(a.black=n.jqGetPromise(r)),n.namedWhen2(a).then(function(t){for(var r=("white"in t?o.parseBloomFromResponse(t.white):null),a=("black"in t?o.parseBloomFromResponse(t.black):null),s=n.resolve({match:null,score:0}),u=0;u<e.length;u++){var l=e[u].toLowerCase(),c=o.createTestMatchClosure(r,a,i,l);s=s.then(c)}return s.logPassthrough("bw result")})},o.parseBloomFromResponse=function(t){var n=t.match(/\[.*\]/)[0],o=JSON3.parse(n);return new e.BloomFilter(o,10)},o.createTestMatchClosure=function(e,t,r,i){return function(a){return 0==a.score?o.testMatch(e,t,r,i):n.resolve(a)}},o.testMatch=function(e,o,r,i){var a=e&&e.test(i),s=o&&o.test(i);if(r&&(a||s)){var u=r+encodeURIComponent(i);return n.jqGetPromise(u).then(function(e){var n=JSON3.parse(e),o="found"in n?n.found?2:-1:0;return o&&t.Logger.log("WBL for "+i+": "+o),{match:i,score:o}})}return n.resolve(a?{match:i,score:1}:s?{match:i,score:-1}:{match:i,score:0})},o}();n.BlackWhiteListHelper=o}(n=t.Common||(t.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(){}return t.getLanguagesForCountry=function(n,o){void 0===o&&(o="en");var r=t.countryLanguages[n];return e.Col.contains(r,o)||r.push(o),r},t.getStringMapForCountry=function(n,o,r){void 0===r&&(r="en");var i=t.getLanguagesForCountry(n,r),a=e.Col.toHashmap(o,function(e){return e.key});return e.Col.hashSelect(a,function(t){return e.Col.of(i).selectFirst(function(e){return t[e]},function(e){return e&&e.length>0})})},t.countryLanguages={AF:["ps","uz","tk"],AX:["sv"],AL:["sq"],DZ:["ar"],AS:["en","sm"],AD:["ca"],AO:["pt"],AI:["en"],AQ:[],AG:["en"],AR:["es","gn"],AM:["hy","ru"],AW:["nl","pa"],AU:["en"],AT:["de"],AZ:["az","hy"],BS:["en"],BH:["ar"],BD:["bn"],BB:["en"],BY:["be","ru"],BE:["nl","fr","de"],BZ:["en","es"],BJ:["fr"],BM:["en"],BT:["dz"],BO:["es","ay","qu"],BQ:["nl"],BA:["bs","hr","sr"],BW:["en","tn"],BV:[],BR:["pt"],IO:["en"],VG:["en"],BN:["ms"],BG:["bg"],BF:["fr","ff"],BI:["fr","rn"],KH:["km"],CM:["en","fr"],CA:["en","fr"],CV:["pt"],KY:["en"],CF:["fr","sg"],TD:["fr","ar"],CL:["es"],CN:["zh"],CX:["en"],CC:["en"],CO:["es"],KM:["ar","fr"],CG:["fr","ln"],CD:["fr","ln","kg","sw","lu"],CK:["en"],CR:["es"],HR:["hr"],CU:["es"],CW:["nl","pa","en"],CY:["el","tr","hy"],CZ:["cs","sk"],DK:["da"],DJ:["fr","ar"],DM:["en"],DO:["es"],EC:["es"],EG:["ar"],SV:["es"],GQ:["es","fr"],ER:["ti","ar","en"],EE:["et"],ET:["am"],FK:["en"],FO:["fo"],FJ:["en","fj","hi","ur"],FI:["fi","sv"],FR:["fr"],GF:["fr"],PF:["fr"],TF:["fr"],GA:["fr"],GM:["en"],GE:["ka"],DE:["de"],GH:["en"],GI:["en"],GR:["el"],GL:["kl"],GD:["en"],GP:["fr"],GU:["en","ch","es"],GT:["es"],GG:["en","fr"],GN:["fr","ff"],GW:["pt"],GY:["en"],HT:["fr","ht"],HM:["en"],VA:["it","la"],HN:["es"],HK:["zh","en"],HU:["hu"],IS:["is"],IN:["hi","en"],ID:["id"],CI:["fr"],IR:["fa"],IQ:["ar","ku"],IE:["ga","en"],IM:["en","gv"],IL:["en","he","ar"],IT:["it"],JM:["en"],JP:["ja"],JE:["en","fr"],JO:["ar"],KZ:["kk","ru"],KE:["en","sw"],KI:["en"],KW:["ar"],KG:["ky","ru"],LA:["lo"],LV:["lv"],LB:["ar","fr"],LS:["en","st"],LR:["en"],LY:["ar"],LI:["de"],LT:["lt"],LU:["fr","de","lb"],MO:["zh","pt"],MK:["mk"],MG:["fr","mg"],MW:["en","ny"],MY:[],MV:["dv"],ML:["fr"],MT:["mt","en"],MH:["en","mh"],MQ:["fr"],MR:["ar"],MU:["en"],YT:["fr"],MX:["es"],FM:["en"],MD:["ro"],MC:["fr"],MN:["mn"],ME:["sr","bs","sq","hr"],MS:["en"],MA:["ar"],MZ:["pt"],MM:["my"],NA:["en","af"],NR:["en","na"],NP:["ne"],NL:["nl"],NC:["fr"],NZ:["en","mi"],NI:["es"],NE:["fr"],NG:["en"],NU:["en"],NF:["en"],KP:["ko"],MP:["en","ch"],NO:["no","nb","nn"],OM:["ar"],PK:["en","ur"],PW:["en"],PS:["ar"],PA:["es"],PG:["en"],PY:["es","gn"],PE:["es"],PH:["en"],PN:["en"],PL:["pl"],PT:["pt"],PR:["es","en"],QA:["ar"],XK:["sq","sr"],RE:["fr"],RO:["ro"],RU:["ru"],RW:["rw","en","fr"],BL:["fr"],SH:["en"],KN:["en"],LC:["en"],MF:["fr"],PM:["fr"],VC:["en"],WS:["sm","en"],SM:["it"],ST:["pt"],SA:["ar"],SN:["fr"],RS:["sr"],SC:["fr","en"],SL:["en"],SG:["en","ms","ta","zh"],SX:["nl","en","fr"],SK:["sk"],SI:["sl"],SB:["en"],SO:["so","ar"],ZA:["af","en","nr","st","ss","tn","ts","ve","xh","zu"],GS:["en"],KR:["ko"],SS:["en"],ES:["es","eu","ca","gl","oc"],LK:["si","ta"],SD:["ar","en"],SR:["nl"],SJ:["no"],SZ:["en","ss"],SE:["sv"],CH:["de","fr","it"],SY:["ar"],TW:["zh"],TJ:["tg","ru"],TZ:["sw","en"],TH:["th"],TL:["pt"],TG:["fr"],TK:["en"],TO:["en","to"],TT:["en"],TN:["ar"],TR:["tr"],TM:["tk","ru"],TC:["en"],TV:["en"],UG:["en","sw"],UA:["uk"],AE:["ar"],GB:["en"],US:["en"],UM:["en"],VI:["en"],UY:["es"],UZ:["uz","ru"],VU:["bi","en","fr"],VE:["es"],VN:["vi"],WF:["fr"],EH:["es"],YE:["ar"],ZM:["en"],ZW:["en","sn","nd"]},t}();e.LocaleHelper=t}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){!function(e){e[e.None=0]="None",e[e.Commerce=1]="Commerce",e[e.Travel=2]="Travel"}(e.VerticalType||(e.VerticalType={}));e.VerticalType}(t=e.Vertical||(e.Vertical={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.LanguageCommercePhrases={da:["kurven|returnering|kategorier|butik|mine produkter|bedste pris|kb|kurv|tilbud|indkbskurv|kbsguide til"],de:["alle marken|stbern in kategorien|wunschliste|heiesten angebote|deinwarenkorb|geschenkefinder|beliebte produkte|kaufberatung|preisvergleich|einkaufswagen|warenkorb|auf lager|versandkosten|wunsch zettel|gratisversand|gratis rcksendung|sofort(-s)kaufen","einkauf(en|sliste|s-wagen|s-tasche)|express-(zustellung|lieferung)|(meine|kostenfreie|standard) lieferung|24-stunden-lieferung|speditionslieferung|lieferstatus|lieferzeit|versand|mwst|bestellen|bestellung|wunschzettel|merkzettel|gutschein|geschenkkarte|widerruf|zur kasse gehen"],en:["(add\\s?(item)?\\s?to\\s?(my)?\\s?(shopping|digital)?\\s?(cart\b|bag\b|basket|order))","(my|your|view|show) (\bcart\b|shopping) (\bcart\b|\btrolley\b|\bbag\b|\bbasket\b|categories)","view all brands|shop by (brand|department(s)?|categor(y|ies))","(shop|buy) now|in stock","shipping (time|info|cost(s)?|charges|policy|options)","(free|no anxiety) shipping|(refund|return) policy","(my|your) order(s)?","order(s)? status|(shopping|buying) guide|(fast|ontime) delivery","store locat(ion(s)?|or)","(continue|start|safe|secure|no minimum) shopping","gift voucher|bulk orders|cash purchase|cash on delivery|replacement (guarantee|options)|money back guaranty|my shopping alert","wish list"],es:["mis pedidos|compra online|cesta de la compra|lista dedeseos|tarifas y polticas de envoi|envo libre|mi compra(s)?|iniciar compra(s)?|cambio gratis|gastos de envio|gastos de envoi|ideas para regalar|ofertas destacadas|panier|envo gratis|tu bolsa|bolsa de compras|plazos de entrega|a carrito|(mi|al) carrito|listas de regalos|comprar ya en 1-clic|(tu|mi|ir|la|a) cesta|ver carrito|lista de (favoritos|deseos|productos)|mi boisa|cheques regalo|seguir mi pedido|entrega gratuita|entrega y devoluciones"],fr:["panier|(mon|votre) sac|liste d'envies|livraison (gratuite|offerte)|livraison  domicile sur rendez-vous|je retourne par la poste|disponible sous|(retours ou |reprise ou a)change gratuit|expdition (gratuite|libre)|la livraison gratuite|les dlais de livraison|carte cadeau|bons de reduction|commandez maintenant|acheter moins cher|en soldes|joutez au comparateur","(continue|continuerz) (vos|mes) (achats|continuer) le shopping"],it:["idee regalo|lista (desideri|dei desideri)|consegna gratuita|spedizione e reso gratuity|offerte del giorno|vai al negozio|prenota ora|spedizioni|spese di (consegna|spedizione|trasporto)|spedizione gratuita|servizio  di spedizione|modalit di spedizione|pagamento per contrassegno|\bacquista\b|articoli selezionati|\bordina\b|continua shopping|stato ordini|storico ordini|buono acquisto|diritto di recesso|carrello|pagamenti rateali|buoni (sconto|regalo)"],jp:["|||||||||"],no:["mine lister|sammenlign (priser|produkter)|nettbutik(ker|ke)?|til(bud| kassen)|handle(lister|vognen|kurven|vogn)|kjp|p lager|nskeliste(r)?|priskrigen|salg|gavekort|butikk(er)?"],pl:["koszyk|upominki|do koszyka|z zamwienie|listy zakupowe|okazje|lista ycze|karty podarunkowe|darmowa dostawa"],pt:["minha cesta|como comprar|frete grtis|ofertas exclusivas para voc|entrega a domicilio gratis|para cambio gratis|formas de pago|carrinho|bolsa|nossas lojas|meu caminhovazio|caixa expressotodo shopping|Lista de Desejos|Ofertas e Descontos|Ver todos os Departamentos|Poltica de compra|Lista de Casamento|[ms]eus pedidos|comprar (este|produto|agora|com garantia)|Quem viu este produto acabou comprandosua entrega|acompanhe seus pedidos|trocas|lista de presentes|super descontos|envio imediato|em estoque|meu caminho|minha sacola|seu cadastro|meu cadastro"],ru:["( )?( )?( )?|, |( )? | | | | | |  | |  | | | | |  ?|(|) |  |  | (   | )|add to the bag|   14 |  | |\n | | |  |  ||  | |  |-| | | |\n   | | | | "],sv:["erbjudanden|dagens deal|varukorg|fraktfria|frakt|orderstatus|s hr handlar du|presentkort|skickar vanligtvis bestllda varor inom 24 timmar|butiker|kundvagnen|returinformation|leveransinformation|fraktinformation|shop by brand|kp|i lager|jmfr priser|direkt frn lagerhyllan|kundvagn|varukorgen|kassan|prissnkta produkter"]},e}();e.CommerceDictionary=t}(t=e.Vertical||(e.Vertical={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function o(){}return o.classifyBySpecialCasesAndJunk=function(e){if(0==document.location.pathname.indexOf("/shop"))return t.Common.resolve(1);var n=t.Common.BlackWhiteListHelper.breakdownHost(),o=t.Common.Col.contains(n,"google");return o&&-1!=document.location.href.indexOf("tbm=shop")?t.Common.resolve(1):e.host().toLowerCase().match(this.blackRegex)?(t.Logger.log("Host matched black REGEX - Classifying as non-commerce"),t.Common.resolve(-1)):t.Common.resolve(0)},o.classifyBySchemaOrg=function(n){var o=e.$("[itemtype='http://schema.org/Offer']").length>0||e.$("[itemtype='http://schema.org/Offer/']").length>0,r=e.$("[itemtype='http://schema.org/Product']").length>0||e.$("[itemtype='http://schema.org/Product/']").length>0;return t.Common.resolve(o||r?1:0)},o.classifyByBlackWhiteList=function(e){
var n=e.paths().blackWhiteListRoot()+"/search/",o=t.Common.BlackWhiteListHelper.breakdownHost();return t.Common.BlackWhiteListHelper.blackWhiteMatch(o,e.paths().dynamicContentRoot()+"/bwl/wl",e.paths().dynamicContentRoot()+"/bwl/bl",n).then(function(e){return e.score})},o.classifyByDictionaries=function(e){for(var o=t.Common.LocaleHelper.getLanguagesForCountry(e.countryCode()),r=0,i=0;i<o.length;i++){var a=o[i];if(a in n.CommerceDictionary.LanguageCommercePhrases){var s=n.CommerceDictionary.LanguageCommercePhrases[a],u=e.scraper().testPatternsAgainstHTML(s);t.Logger.log("Language score for "+a+": "+u),u>r&&(r=u)}}return t.Logger.log("Commerce vertical lang result: "+r),t.Common.resolve(r)},o.classifyByProductImage=function(){var e=t.Common.ImageUtils.getProductImage(),n=e?1:0;return t.Logger.log("Product image (ribbon logic): "+n),t.Common.resolve(n)},o.blackRegex=/tube|lazada|shopzilla.|beso.|kelkoo.|orange.|clickjogos|gameforge|pole-emploi|infojobs|snap.do|(stockinvestingbasics|allmyvideos|laposte|megafilmeshd|vidspot).net|(collectivites|sweet|jeux|voila|bilansgratuits|habbol|vente).fr|(abril|terra|ig|blogspot|hotelurbano|uol).com.br|www.easymobility.co.uk|gov.br|wikipedia.org|(pricegrabber|spardeingeld|snapdo|speedbit|loopnet|stackoverflow|stackexchange|hulu|bloomberg|blogger|dartybox|alexa|baidu|cj|cnn|facebook|flickr|history|hotmail|imdb|imvu|linkedin|microsoft|msn|myspace|netflix|nytimes|politico|picasa|pinterest|rue89|salon|searchenginewatch|delta-search|sfgate|shutterfly|techcrunch|verizon|venturebeat|wired|yankodesign|yahoo|youtube|bing|vk|live|tumblr|ask|apple|roblox|411answers|tagged|nickjr|opposingviews|truste|adobe|breakfastdailynews|.avg|espn.go|.aol|pogo|pornhub|youporn|pron|youjizz|xnxx|marca|elpais|juegos|surveysresearchgroup|dofus|adopteunmec|unique|22find|nationzoom|sncf|privee|awesomehp|updateflashplayer|stocktradingcenters|empowernetwork|regionalhealthreview|diyfood|websurveycentral|\.att|news788|411source|pandora|hsselite|verizonwireless|internetautoguide|symantec|\.pch|mobile|nortonpro|pchealthboost|voipo|contenko|seaworldparks|entrepreneur|ratezip|game321|boostmobile|cabelas|specialk|globo|yepi|jogatina|4shared|globo|ojogos|tudogostoso|netcartas|disney|voeazul|cartoonnetwork|\.tam|viajanet|vagalume|jogosdemeninas|^as|\.as|atrapalo|elconfidencial|lavanguardia|forocoches|peliculasyonkis|logitravel|freakshare|elperiodico|iberia|filmaffinity|chaturbate|expansion|todotest|antena3|cincodias).com|(elmundo|rtve|lavozdegalicia|sport|publico|game|online|eldiariomontanes|elcomercio|\.hoy|\.abc|telepizza|europapress).es|paypal|cam4|888poker|filmesonlinegratis|google|.gov|qvo6|cam4|surveyservers|ask.fm|games.la|jeu.info/i,o}();n.CommerceHelper=o}(n=t.Vertical||(t.Vertical={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e}();e.ModelBase=t}(t=e.Model||(e.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(t,n,o,r,i){this.context=null,this.suspendIdentifier=null,this.legacySuspendIdentifier=null,this.suspendPeriods=null,this.suspendPeriods=r,this.selectedPeriodMS=e.ko.observable(this.suspendPeriods[0].ms),this.context=t,this.suspendIdentifier=n,this.legacySuspendIdentifier=o,this.closeFn=i}return n.prototype.shouldAutoAppear=function(){return this.context.suspender().shouldAutoAppear(this.suspendIdentifier)},n.prototype.applySelectedSuspension=function(){this.suspend(this.selectedPeriodMS())},n.prototype.suspend=function(e){this.context.suspender().suspend(this.suspendIdentifier,e),this.closeFn()},n.prototype.openSuspendWindow=function(){var e=t.Common.stringFormat("http://removemyapp.info/suspend.html?hid={0}_{1}&contact={2}",this.context.userSettings().uuid(),this.legacySuspendIdentifier,encodeURIComponent(this.context.params().providerLink)),o="toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=730, height=400",r=window.open(e,"",o),i=this,a=window.setInterval(function(){var e=n.checkSuspendWindowClosed(i,r,i.closeFn);e&&window.clearInterval(a)},500)},n.checkSuspendWindowClosed=function(e,n,o){return n&&n.closed?(e.context.userSettings().reload().then(function(){var n=e.context.suspender().isSuspended(e.suspendIdentifier),r=e.context.suspender().shouldAutoAppear(e.suspendIdentifier);t.Logger.log("Suspend advanced window closed. Suspended: "+n+". AutoAppear: "+r),n&&o()}),!0):!1},n.prototype.openSuspendWindow_new=function(){var e=this,n=t.Common.stringFormat("http://removemyapp.info/suspend.html?hid={0}_{1}&contact={2}",this.context.userSettings().uuid(),this.legacySuspendIdentifier,encodeURIComponent(this.context.params().providerLink)),o="toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=730, height=400",r=window.open(n,"",o),i=window.setInterval(function(){r&&r.closed&&(e.context.userSettings().reload().then(function(){var n=e.context.suspender().isSuspended(e.suspendIdentifier),o=e.context.suspender().shouldAutoAppear(e.suspendIdentifier);t.Logger.log("Suspend advanced window closed. Suspended: "+n+". AutoAppear: "+o),n&&e.closeFn()}),window.clearInterval(i))},500)},n.defaultSuspendPeriods=[{text:"1 Hour",ms:36e5},{text:"1 Day",ms:864e5},{text:"1 Week",ms:6048e5}],n.strictSuspendPeriods=[{text:"1 Day",ms:864e5},{text:"1 Week",ms:6048e6},{text:"Forever",ms:3155692597470}],n.allSuspendPeriods=[{text:"1 Hour",ms:36e5},{text:"1 Day",ms:864e5},{text:"1 Week",ms:6048e5},{text:"Forever",ms:3155692597470}],n}();n.SuspendTarget=o}(n=t.Model||(t.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(o){function r(r,i,a,s){var u=this;void 0===s&&(s=function(){}),o.call(this),this.collapsed=e.ko.observable(!1),this.hidden=e.ko.observable(!1),this.suspendTarget=null,this.winSize=e.ko.observable({x:0,y:0}),this.docSize=e.ko.observable({x:0,y:0}),this.postRenderHandler=function(){};var l=this;this.context=r,this.suspendIdentifier=i,this.providerLink=r.params().providerLink,this.providerName=r.params().providerName,this.providerFooter=r.params().providerFooter,this.extraAttribution=window.__rvzfrrstfr&&window.__rvzfrrstfr.product_name;var c=this.extraAttribution?n.SuspendTarget.strictSuspendPeriods:n.SuspendTarget.defaultSuspendPeriods;this.suspendTarget=new n.SuspendTarget(r,i,a,c,function(){return u.hide()}),this.collapsed(!this.suspendTarget.shouldAutoAppear()),this.onClose=s,this.afterRender=function(n,o){if(0==n.length)t.Logger.warn("No nodes sent to after render. wtf?");else{var r=n[0].parentNode,i=e.$(r);u.postRenderHandler(i,r)}};var d=function(){l.winSize({x:e.$(window).width(),y:e.$(window).height()}),l.docSize({x:e.$(document).width(),y:e.$(document).height()})};d(),e.$(window).resize(d)}return __extends(r,o),r.prototype.hide=function(){this.hidden(!0),t.Common.RealEstateHelper.releaseRealestate(this.suspendIdentifier),this.onClose()},r.prototype.toggleCollapsed=function(){this.collapsed(!this.collapsed())},r.prototype.blockPropagation=function(e,t){return t&&(t.stopPropagation(),t.cancelBubble=!0),!0},r}(n.ModelBase);n.ProductModelBase=o}(n=t.Model||(t.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(t){var n=function(){function t(e,t,n){this.minHoverMS=e,this.maxHoverMS=t,this.onHoverDone=n}return t.prototype.hoverStart=function(e,t,n){null==e.hoverStartTime&&(e.hoverStartTime=(new Date).getTime())},t.prototype.hoverEnd=function(t,n,o){if(!(e.$(o.toElement).closest(o.currentTarget).length>0)){if(null!=t.hoverStartTime){var r=(new Date).getTime()-t.hoverStartTime;r>t.minHoverMS&&r<t.maxHoverMS&&t.onHoverDone(r)}t.hoverStartTime=null}},t}();t.HoverTarget=n}(n=t.Model||(t.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(e){function n(n,o){e.call(this),this.offers=[];var i=t.Common.Col.select(o,function(e){return new r(n,e)});this.offers=i,this.context=n}return __extends(n,e),n}(n.ModelBase);n.GenericOffersModel=o;var r=function(o){function r(e,r){var i=this;o.call(this),this.offer=null,this.url=null,this.clickNotified=!1,this.hoverTarget=new n.HoverTarget(4e3,6e4,function(e){return t.Logger.Analytics.notify(i.context,t.Logger.Analytics.HOVER,{time:e+""})}),this.context=e,this.offer=r,this.url=r.url}return __extends(r,o),r.prototype.windowOpen=function(t,n){var o=e.$('<iframe width="0" height="0" style="display: none"></iframe>')[0];document.body.appendChild(o);var r=o.contentWindow.open.apply(window,[t,n]);return document.body.removeChild(o),r},r.prototype.hoverStart=function(e,t){this.hoverTarget.hoverStart(this.hoverTarget,e,t)},r.prototype.hoverEnd=function(e,t){this.hoverTarget.hoverEnd(this.hoverTarget,e,t)},r}(n.ModelBase);n.GenericOfferModel=r}(n=t.Model||(t.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(n,r){t.call(this),this.offers=[];var i=e.Common.Col.select(r,function(e){return new o(n,e)});this.offers=i,this.context=n}return __extends(n,t),n}(t.ModelBase);t.DealsModel=n;var o=function(t){function n(e,n){t.call(this,e,n),this.offer=null,this.offer=n}return __extends(n,t),n.prototype.onClick=function(t,n){n&&n.preventDefault();var o;if(o=window.FO_OPENONCURRENTPAGE&&this.context.overrides().boolValue("open-on-current-window",!1)?t.windowOpen(t.offer.url,"_top"):t.windowOpen(t.offer.url,"_blank"),!t.clickNotified){t.clickNotified=!0;var r={};if(r.p=t.offer.part,r.kwds=t.offer.keywords,t.offer.url.indexOf("af_placement_id=")>-1)try{var i=t.offer.url;r.plid=i.match(/af_placement_id=([^&]+)/)[1]}catch(a){e.Logger.info("Bad parse of placmentID"),r.plid="0"}t.offer.title&&(r.title=t.offer.title.substring(0,40)),t.offer.price&&(r.prc=t.offer.price),t.offer.begrp&&(r.begrp=t.offer.begrp),e.Logger.Analytics.notify(t.context,e.Logger.Analytics.CLICK,r),t.offer.onClick&&t.offer.onClick()}},n}(t.GenericOfferModel);t.DealModel=o}(t=e.Model||(e.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(e){function n(n,o,i){e.call(this,n,o),this.offers=[],this.displayWindowOffers=[],this.offers=t.Common.Col.select(o,function(e){return new r(n,e)}),this.displayWindowOffers=t.Common.Col.select(i,function(e){return new r(n,e)}),this.context=n}return __extends(n,e),n}(n.GenericOffersModel);n.RibbonOffersModel=o;var r=function(t){function n(n,o){t.call(this,n,o),this.zoomVisible=e.ko.observable(!1)}return __extends(n,t),n.prototype.hideZoom=function(e,t){t.stopPropagation(),e.zoomVisible(!1)},n.prototype.zoomIntoOffer=function(e,n){n.stopPropagation(),t.prototype.hoverStart.call(this,e,n),e.zoomVisible(!0)},n.prototype.zoomOutOfOffer=function(e,n){n.stopPropagation(),t.prototype.hoverEnd.call(this,e,n),e.zoomVisible(!1)},n}(n.DealModel);n.RibbonOfferModel=r}(n=t.Model||(t.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){e.sliderStrings=[{key:"deals_header",en:"Hot Deals",fr:"Super offres",de:"Top-Schnppchen",it:"Offerte speciali",es:"Grandes ofertas",ru:" ",pt:"Ofertas Incrveis",pl:"Gorce oferty",ja:"",nl:"Populaire deals",sv:"Heta erbjudanden",da:"Fantastiske tilbud",he:" ",ar:" "},{key:"coupons_header",en:"Best Coupons",fr:"Meilleurs coupons",de:"Beste Gutscheine",it:"Coupon migliori",es:"Mejores cupones",ru:" ",pt:"Melhores Cupons",pl:"Najlepsze kupony",ja:"",nl:"Beste coupons",sv:"Bsta kuponger",da:"Bedste kuponer",he:"",ar:" "},{key:"campaigns_header",en:"Special Offers",fr:"Special Offers",de:"Special Offers",it:"Special Offers",es:"Special Offers",ru:"Special Offers",pt:"Special Offers",pl:"Special Offers",ja:"Special Offers",nl:"Special Offers",sv:"Special Offers",da:"Special Offers",he:"Special Offers",ar:"Special Offers"},{key:"coupons_tab",en:"Coupons",fr:"Coupons",de:"Gutscheine",it:"Coupon",es:"Cupones",ru:"",pt:"Cupons",pl:"Kupony",ja:"",nl:"Coupons",sv:"Kuponger",da:"Kuponer",he:"",ar:""},{key:"campaigns_tab",en:"Offers",fr:"Offers",de:"Offers",it:"Offers",es:"Offers",ru:"Offers",pt:"Offers",pl:"Offers",ja:"Offers",nl:"Offers",sv:"Offers",da:"Offers",he:"Offers",ar:"Offers"},{key:"deals_tab",en:"Deals",fr:"Offres",de:"Angebote",it:"Offerte",es:"Ofertas",ru:"",pt:"Ofertas",pl:"Oferty",ja:"",nl:"Deals",sv:"erbjudanden",da:"Tilbud",he:"",ar:""},{key:"deals_header2",en:"Best Deal",fr:"Meilleur offre",de:"Beste",it:"Offerta migliore",es:"Mejor oferta",ru:"",pt:"Melhor oferta",pl:"Najlepsze oferty",ja:"",nl:"Beste deal",sv:"Bsta erbjudanden",da:"Bedste tilbud",he:" ",ar:" "},{key:"free_shipping",en:"Free Shipping",fr:"Port gratuit",de:"Gratisversand",it:"Spedizione gratuita",es:"Envo gratis",ru:" ",pt:"Frete grtis",pl:"Darmowa dostawa",ja:"",nl:"Gratis verzending",sv:"Gratis frakt",da:"Gratis forsendelse",he:" ",ar:" "},{key:"click_here",en:"Click Here",fr:"Cliquez ici",de:"Hier klicken",it:"Clicca qui",es:"Haz clic aqu",ru:" ",pt:"Clique aqui",pl:"Kliknij tutaj",ja:"",nl:"Klik hier",sv:"Klicka hr",da:"Klike her",he:" ",ar:" "},{key:"get_code",en:"Get Code",fr:"Recevoir le code",de:"Code erhalten",it:"Ricevi codice",es:"Obtener cdigo",ru:" ",pt:"Obter cdigo",pl:"Otrzymaj kod",ja:"",nl:"Krijg code",sv:"Hmta kod",da:"Hent kode",he:" ",ar:"  "},{key:"see_more",en:"See more",fr:"Voir plus",de:"Mehr erfahren",it:"Vedi altro",es:"Ver ms",ru:". ",pt:"Ver mais",pl:"Zobacz wicej",ja:"",nl:"Meer info",sv:"Visa mer",da:"Se mere",he:" ",ar:" "},{key:"more_deals",en:"Get more deals",fr:"Recevoir plus d'offres",de:"Mehr Schnppchen erhalten",it:"Ricevi altre offerte",es:"Obtener ms ofertas",ru:"  ",pt:"Receba mais ofertas",pl:"Otrzymaj wicej ofert",ja:"",nl:"Krijg meer deals",sv:"Hmta fler erbjudanden",da:"F flere tilbud",he:" ",ar:"    "},{key:"more_deals2",en:"See more deals",fr:"Recevoir plus d'offres",de:"Mehr Schnppchen erhalten",it:"Ricevi altre offerte",es:"Obtener ms ofertas",ru:"  ",pt:"Receba mais ofertas",pl:"Otrzymaj wicej ofert",ja:"",nl:"Krijg meer deals",sv:"Hmta fler erbjudanden",da:"F flere tilbud",he:" ",ar:"    "},{key:"buy",en:"Buy Now",fr:"Acheter maintenant",de:"Jetzt kaufen",it:"Compra ora",es:"Comprar ahora",ru:" ",pt:"Compre j",pl:"Kup teraz",ja:"",nl:"Koop nu",sv:"Kp nu",da:"Kb nu",he:" ",ar:" "},{key:"attribution1",en:"Powered by",fr:"Optimis par",de:"Untersttzt von",it:"Powered by",es:"Tecnologa de",ru:"  ",pt:"Desenvolvido por",pl:"Wspierane przez",ja:"",nl:"Geleverd door",sv:"Drivs av",da:"Drevet af",he:"powered by",ar:" "},{key:"attribution2",en:"Brought by",fr:"Fourni par",de:"Prsentiert von",it:"Offerto da",es:"Ofrecido por",ru:"",pt:"Trazido por",pl:"Przedstawia",ja:"",nl:"Gebracht door",sv:"Levererat av",da:"Udviklet af",he:"Brought by",ar:"  "},{key:"click_to_use",en:"Get Coupon",fr:"Recevoir le coupon",de:"Gutschein erhalten",it:"Ottieni coupon",es:"Obtener cupn",ru:" ",pt:"Obter cupom",pl:"Otrzymaj kupon",ja:"",nl:"Krijg coupon",sv:"Hmta kupong",da:"Hent kupon",he:" ",ar:"  "},{key:"black_friday_deals",en:"Black friday <b>deals</b>",fr:"Spcial",de:"Heie Angebote",it:"Speciale",es:"Ofertas calientes",ru:" ",pt:"Ofertas quentes",pl:"Gorce oferty",ja:"",nl:"",sv:"",da:"",he:"",ar:""},{key:"copy_paste",en:"Copy/Paste code to use at Checkout",fr:"Copier/Coller le code  utiliser lors du paiement",de:"Code kopieren und bei Abschluss der Bestellung einfgen",it:"Copia/incolla codice da usare alla cassa",es:"Copiar/pegar cdigo y usar al pagar",ru:"/     ",pt:"Copie/Cole cdigo e use no Checkout",pl:"Kopiuj/Wklej kod do wykorzystania przy kasie",ja:"",nl:"Kopieer/plak code bij het afrekenen",sv:"Kopiera/klistra in kod att anvnda i kassan",da:"Kopier/st ind koden, der skal bruges ved betaling",he:"     ",ar:" /   "},{key:"click_coupon",en:"Click to get the Coupon",fr:"Cliquer pour recevoir le coupon",de:"Klicken, um Gutschein zu erhalten",it:"Clicca per ricevere il coupon",es:"Haz clic para obtener cupn",ru:"   ",pt:"Clique para obter o cupom",pl:"Kliknij, by otrzyma kupon",ja:"",nl:"Klik om de coupon te krijgen",sv:"Klicka fr att hmta kupong",da:"Klik for at hente kuponen",he:"  ",ar:"   "},{key:"more_deals_short",en:"Get more deals",fr:"Voir plus d'offres",de:"Mehr Angebote",it:"Trova offerte",es:"Ver ms",ru:". ",pt:"Veja mais ofertas",pl:"Zobacz wicej",ja:"",nl:"Krijg meer deals",sv:"Hmta fler erbjudanden",da:"",he:"",ar:""},{key:"cyber_monday_deals",en:"Cyber Monday <b>deals</b>",fr:"Spcial",de:"Heie Angebote",it:"Speciale",es:"Ofertas calientes",ru:" ",pt:"Ofertas quentes",pl:"Gorce oferty",ja:"",nl:"",sv:"",da:"",he:"",ar:""},{key:"mature_deals_header",en:"Sexy Deals",fr:"",de:"",it:"",es:"",ru:"",pt:"",pl:"",ja:"",nl:"",sv:"",da:"",he:"",ar:""},{key:"visit_store",en:"Visit Store",fr:"Acheter maintenant",de:"Jetzt kaufen",it:"Compra ora",es:"Comprar ahora",ru:" ",pt:"Compre j",pl:"Kup teraz",ja:"",nl:"Koop nu",sv:"Kp nu",da:"Kb nu",he:" ",ar:" "},{key:"more",en:"More",fr:"More",de:"More",it:"More",es:"More",ru:"More",pt:"More",pl:"More",ja:"More",nl:"More",sv:"More",da:"More",he:"",ar:"More"}]}(t=e.Locale||(e.Locale={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){!function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large"}(n.RibbonSize||(n.RibbonSize={}));var o=(n.RibbonSize,function(){function e(){}return e.getDimensions=function(e){switch(e){case 0:return{width:61,height:71};case 1:return{width:71,height:81};case 2:return{width:104,height:114}}},e.ribbonSizeToString=function(e){switch(e){case 0:return"Small";case 1:return"Medium";case 2:return"Large"}},e}()),r=function(){function r(r,i,a,s){this.imageToDrawOn=a,this.ribbonVisible=e.ko.observable(!0),this.imageRect=r.scraper().getElementPosWithOffsets(a);var u=o.getDimensions(s);this.numOfPresentedOffers=this.calculateNumOfPresentedDeals(u,this.imageRect,i),t.Logger.info("Displaying:  "+this.numOfPresentedOffers+" offers in ribbon out of available: "+i.length),this.offers=e.ko.computed(function(){return i.slice(0,this.numOfPresentedOffers)},this),this.displayWindowOffers=e.ko.observableArray(i),this.offersModel=this.offers()?new n.RibbonOffersModel(null,this.offers(),this.displayWindowOffers()):new n.RibbonOffersModel(null,[],[]),this.ribbonPosition={top:40,left:20},this.ribbonFramePosition={top:this.imageRect.top-50,left:this.imageRect.right-10},this.ribbonDimensions=this.calculateRibbonDimensions(this.numOfPresentedOffers,u),this.ribbonFrameDimensions=this.calculateRibbonFrameDimensions(this.ribbonDimensions),t.Logger.info("Ribbon Position: "+JSON.stringify(this.ribbonPosition)),t.Logger.info("Ribbon Dimesions: "+JSON.stringify(this.ribbonDimensions)),this.strings=t.Common.LocaleHelper.getStringMapForCountry(r.countryCode(),t.Locale.sliderStrings),this.ribbonSize=o.ribbonSizeToString(s)}return r.prototype.calculateRibbonFrameDimensions=function(e){return{width:e.width+40,height:e.height+80}},r.prototype.calculateNumOfPresentedDeals=function(e,t,n){var o=Math.max(1,Math.floor(t.height/e.height)),r=3,i=Math.max(o,r),a=Math.min(i,n.length);return a},r.prototype.calculateRibbonDimensions=function(e,t){return{width:t.width,height:e*t.height}},r}();n.IFrameRibbonCommerceOffersModel=r}(n=t.Model||(t.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function e(){}return e.getDimensions=function(e){switch(e){case 0:return{width:61,height:71};case 1:return{width:71,height:81};case 2:return{width:104,height:114}}},e.ribbonSizeToString=function(e){switch(e){case 0:return"Small";case 1:return"Medium";case 2:return"Large"}},e}(),r=function(){function r(r,i,a,s){var u=this;this.context=r,this.imageToDrawOn=a,this.ribbonVisible=e.ko.observable(!1),this.ribbonValid=e.ko.observable(!0),this.imageRect=e.ko.observable(r.scraper().getElementPosWithOffsets(a));var l=o.getDimensions(s);this.numOfPresentedOffers=this.calculateNumOfPresentedDeals(l,this.imageRect,i),t.Logger.info("Displaying:  "+this.numOfPresentedOffers+" offers in ribbon out of available: "+i.length),this.offers=e.ko.computed(function(){return i.slice(0,this.numOfPresentedOffers)},this),this.displayWindowOffers=e.ko.observableArray(i),this.offersModel=this.offers()?new n.RibbonOffersModel(r,this.offers(),this.displayWindowOffers()):new n.RibbonOffersModel(null,[],[]),this.ribbonDimensions=this.calculateRibbonDimensions(this.numOfPresentedOffers,l),this.strings=t.Common.LocaleHelper.getStringMapForCountry(r.countryCode(),t.Locale.sliderStrings),this.ribbonSize=o.ribbonSizeToString(s),this.displayWindowVisible=e.ko.observable(!1),this.ribbonPosition=e.ko.computed(function(){return u.calculatePositionsByImage()}),this.displayWindowPosition=e.ko.computed(function(){return u.chooseBestPosition()}),t.Logger.info("Ribbon Position: "+JSON.stringify(this.ribbonPosition())),t.Logger.info("Ribbon Dimensions: "+JSON.stringify(this.ribbonDimensions))}return r.prototype.updateImageRect=function(){this.imageRect(this.context.scraper().getElementPosWithOffsets(this.imageToDrawOn))},r.prototype.calculatePositionsByImage=function(){return this.imageRect()&&this.imageRect().top&&this.imageRect().right||this.ribbonValid(!1),{top:this.imageRect().top,left:this.imageRect().right}},r.prototype.hideDisplayWindow=function(){this.displayWindowVisible(!1)},r.prototype.showDisplayWindow=function(){this.displayWindowVisible(!0)},r.prototype.calculateNumOfPresentedDeals=function(e,t,n){var o=Math.max(1,Math.floor(t().height/e.height)),r=3,i=Math.max(o,r),a=Math.min(i,n.length);return a},r.prototype.calculateRibbonDimensions=function(e,t){return{width:t.width,height:e*t.height}},r.prototype.chooseBestPosition=function(){var e=80,n=515,o=205,r=2,i={left:this.ribbonPosition().left+this.ribbonDimensions.width+10,top:this.imageRect().top,width:n,height:e+o*r};return t.Logger.info("Image rect:"+this.imageRect()),t.Logger.info("Display Window rect:"+i),i.left+i.width>window.innerWidth?this.imageRect().top+this.imageRect().height+i.height+10>window.innerHeight+window.pageYOffset&&this.imageRect().top-i.height-10-window.pageYOffset<0?this.imageRect().left-i.width-10<0?i.left>window.innerWidth-n-10&&(i.left=window.innerWidth-n-10):i.left=this.imageRect().left-i.width-10:(this.imageRect().left+this.imageRect().width/2-i.width/2+i.width<window.innerWidth?i.left=this.imageRect().left+this.imageRect().width/2-i.width/2:i.left=window.innerWidth-(10+i.width),this.imageRect().top+this.imageRect().height+i.height+10>window.innerHeight+window.pageYOffset?i.top=this.imageRect().top-i.height-10:i.top=this.imageRect().top+this.imageRect().height+10):this.imageRect().top+i.height+10>window.innerHeight+window.pageYOffset&&(i.top=window.pageYOffset+window.innerHeight-(10+i.height)),i},r}();n.RibbonCommerceOffersModel=r}(n=t.Model||(t.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(){this.ribbonImageElement=null,this.imagesForWordIntersection=null}return n.prototype.flag=function(){return"rb"},n.prototype.dataKey=function(){return"CommerceRibbon"},n.prototype.supportsStickyClassification=function(){return!0},n.prototype.classify=function(e){return t.Common.namedWaterfall([{name:"specialcase",value:function(){return t.Vertical.CommerceHelper.classifyBySpecialCasesAndJunk(e)}},{name:"bwl",value:function(){return t.Vertical.CommerceHelper.classifyByBlackWhiteList(e)}},{name:"dict",value:function(){return t.Vertical.CommerceHelper.classifyByDictionaries(e)}},{name:"ribbon",value:function(){return t.Vertical.CommerceHelper.classifyByProductImage()}}],function(e){return 0!=e}).alwaysThen(function(e,t){return t?{name:t.message,value:0}:e})},n.prototype.scrapeAndObtainData=function(e,n,o){var r=this;return this.imagesForWordIntersection=t.Common.ImageUtils.findValidImagesBySize(0,4,!1),window.setInterval(function(){return r.scrapeAndSetDataIfNeeded(e,n.totalCount())},1e3),this.scrapeAndSetDataIfNeeded(e,n.totalCount()).then(function(){var n=new t.Data.StubDataResult("rb",e);return n})},n.prototype.scrapeAndSetDataIfNeeded=function(e,t){var n=this.findCandidateImages();return this.searchByImagesText(e,n,t)},n.prototype.findCandidateImages=function(){var e=n.DEFAULT_IMG_INDEX_TO_SHOW_ON;"undefined"!=typeof window.FO_RB_IMG&&(e=window.FO_RB_IMG);var o=2,r=t.Common.ImageUtils.findValidImagesBySize(e,o,!0),i=this.createImagesAndSize(r);return i},n.prototype.createImagesAndSize=function(n){var o=[];if(n)for(var r=0;r<n.length;r++){var i={image:e.$(n[r]),size:t.Common.ImageUtils.imageSizeToRibbonSize(n[r].height)};o.push(i)}return o},n.prototype.searchByImagesText=function(e,n,o,r){var i=this;if(n&&n.length>0&&(r=r||0,r<n.length)){var a=n[r].image,s=a.data("fo-ribbon-state");if(s){var u=(new Date).getTime();return a.data("fo-ribbon-primary",u),void(this.ribbonImageElement=a)}a.data("fo-ribbon-state","loading");var l=this.requestDataFromImage(e,a[0]),c=t.Data.OffersApi.queryFromData(e,l);return t.Data.OffersApi.queryApi(e,o,null,c).then(function(s){if(a.data("fo-ribbon-state","loaded"),s&&s.length>0){var u=(new Date).getTime();a.data("fo-ribbon-primary",u),i.ribbonImageElement=a,a.data("fo-ribbon-data",t.Data.OffersApi.dealsFromOffers(e,s)),a.data("fo-ribbon-size",n[r].size),i.storeRetargetingData(s,e);var l=t.Data.OffersApi.dealsFromOffers(e,s),c=new t.Data.PlainDataResult("rb",e,l);return c}return r++,i.searchByImagesText(e,n,o,r),null})}return t.Common.resolve(null)},n.prototype.storeRetargetingData=function(e,n){var o=e[0].keywords;t.Common.Retargeting.storeImpressionKeywords(n,o),t.Common.Retargeting.storeImpressionKeywordsToCookie(n,o,n.paths().domain()),t.Common.Col.each(e,function(e){e.onClick=function(){t.Common.Retargeting.storeClickKeywords(n,e.keywords),t.Common.Retargeting.storeClickKeywordsToCookie(n,e.keywords,n.paths().domain())}})},n.prototype.requestDataFromImage=function(t,n){var o=new e.NWPLegacy,r={wordCounts:this.imageScrape(t,n),price:o.PriceUtils.getPrice(n),source:"ribbon-image"};return r},n.prototype.imageScrape=function(e,n){return t.Common.ScrapingLogics.imageScrapeLogicWithSupporting(e,n,this.imagesForWordIntersection)},n.DEFAULT_IMG_INDEX_TO_SHOW_ON=0,n}();n.CommerceRibbonLogic=o}(n=t.ExternalProducts||(t.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){function o(e,n){n.subscribe(function(n){return t.Logger.log("Observable "+e+": "+n)})}n.watchObservable=o,n.defaultAdjustScaleOptions={active:!1,top:0,bottom:0,pos:.5,minScale:.65},n.defaultHorizontalPos={active:!1,right:0,left:0,minScale:1};var r=function(){function o(){}return o.setAlternativeTemplateEngine=function(){var t=new e.ko.nativeTemplateEngine;t.renderTemplate=function(n,o,r,i){var a=e.ko.templateEngine.prototype.makeTemplateSource(n,null);return t.renderTemplateSource(a,o,r)},e.ko.setTemplateEngine(t)},o.registerCustomBindings=function(t){e.ko.bindingHandlers.containedTemplate=o.containedTemplate(),e.ko.bindingHandlers.containedTemplate2=o.containedTemplate2(),e.ko.bindingHandlers.containedTemplate3=o.containedTemplate3(),e.ko.bindingHandlers.containerOf=o.containerOf(),e.ko.bindingHandlers.containerCss=o.containerCss(),e.ko.bindingHandlers.slideVisible=o.slideVisible(),e.ko.bindingHandlers.fadeVisible=o.fadeVisible(),e.ko.bindingHandlers.fadeVisibleInvisibleRemove=o.fadeVisibleInvisibleRemove(),e.ko.bindingHandlers.hoverToggle=o.hoverToggle(),e.ko.bindingHandlers.className=o.className(),e.ko.bindingHandlers.stopBubble=o.stopBubble(),e.ko.bindingHandlers.positionNextTo=o.positionNextTo(),o.setAlternativeTemplateEngine()},o.stopBubble=function(){return{init:function(t,n,o,r,i){for(var a=e.ko.utils.unwrapObservable(n()),s=a.split(","),u=0;u<s.length;u++)e.ko.utils.registerEventHandler(t,s[u].trim(),function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()})}}},o.className=function(){return{update:function(t,n,o,r,i){var a=n();a&&e.$(t).toggleClass(a,!0)}}},o.positionNextTo=function(){return{update:function(t,o,r,i,a){var s=e.$(t),u=e.ko.utils.unwrapObservable(o()),l=n.VisualHelper.positionNextTo(u,s);s.css({top:l.y,left:l.x,position:"absolute"})}}},o.getBrowser=function(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"MSIE "+(e[1]||"")):"Chrome"===n[1]&&(e=t.match(/\bOPR\/(\d+)/),null!=e)?"Opera "+e[1]:(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))},o.hoverToggle=function(){return{init:function(t,n,o,r,i){var a=n();e.ko.utils.registerEventHandler(t,"mouseenter",function(){return a(!0)}),e.ko.utils.registerEventHandler(t,"mouseout",function(){return a(!1)})}}},o.containedTemplate3=function(){return{update:function(t,r,i,a,s){n.wait(100).then(function(){var i=e.ko.utils.unwrapObservable(r()),a=!0,s="object"==typeof i&&i.adjustHeightInterval?i.adjustHeightInterval:0,u="object"==typeof i&&i.adjustScale&&"MSIE 9"!=o.getBrowser()?i.adjustScale:{},l=e.$.extend(n.defaultAdjustScaleOptions,u),c="object"==typeof i&&i.css?i.css:null,d="object"==typeof i&&i.contentId?i.contentId:null,f=e.$("#"+d);if(f.remove(),a&&o.ctTreatForCollisions(t,f),s&&o.ctAdjustHeight(t,f,s),l.active&&o.ctAdjustScale(t,f,l),c){var p=e.$("<link rel='stylesheet' href='"+c+"'></link>");e.$(t.contentDocument.head).append(p)}e.$(t.contentDocument.body).append(f)})}}},o.containedTemplate2=function(){return{update:function(t,r,i,a,s){var u=e.$("<div></div>");e.ko.bindingHandlers.template.update(u[0],r,i,a,s);var l=e.ko.utils.unwrapObservable(r()),c=o.getBrowser(),d=!0,f="object"==typeof l&&l.adjustHeightInterval?l.adjustHeightInterval:0,p="object"==typeof l&&l.adjustScale&&"MSIE 9"!=c?l.adjustScale:{},m=e.$.extend({},n.defaultAdjustScaleOptions,p),h="object"==typeof l&&l.css?l.css:null,g="object"==typeof l&&l.adjustHorizontal?l.adjustHorizontal:{},v=e.$.extend({},n.defaultHorizontalPos,g);d&&o.ctTreatForCollisions(t,u),f&&o.ctAdjustHeight(t,u,f),m&&m.active&&o.ctAdjustScale(t,u,m),v&&v.active&&o.ctAdjustHorizontalPosition(t,u,v);var y=function(){h&&e.$(t.contentDocument.head).append(e.$("<link rel='stylesheet' href='"+h+"'></link>")),e.$(t.contentDocument.body).append(u)};c.indexOf("Firefox")>=0?setInterval(function(){t.contentDocument&&t.contentDocument.body&&!t.contentDocument.body.hasChildNodes()&&y()},100):n.wait(100).then(y)}}},o.ctTreatForCollisions=function(e,t){n.CollisionHelper.treatForCollisions(t)},o.ctAdjustHeight=function(t,n,o){setInterval(function(){try{var o=n&&n.children().length&&n.children()[0];if(o){var r=e.$(o).height();e.$(t).height(r)}}catch(i){}},o)},o.ctAdjustScale=function(t,r,i){n.waitFor(function(){return"true"===e.$(t.contentDocument.body).css("ready")},1e4,50).then(function(){return n.waitForStable(function(){
return o.getFirstHeight(r)},function(e){return e>0},function(e){return o.scaleOnResize(t,i,e)},100,500)}),window.addEventListener("resize",function(){var e=o.getFirstHeight(r);o.scaleOnResize(t,i,e)})},o.ctAdjustHorizontalPosition=function(t,r,i){n.waitFor(function(){return"true"===e.$(t.contentDocument.body).css("ready")},1e4,50).then(function(){return n.waitForStable(function(){return o.getFirstWidth(r)},function(e){return e>0},function(e){return o.adjustHorizontalPosition(t,i,e)},100,500)}),window.addEventListener("resize",function(){var e=o.getFirstWidth(r);o.adjustHorizontalPosition(t,i,e)})},o.getFirstHeight=function(t){for(;;){var n=t.height();if(n)return n;var o=t.children();if(!(o&&o.length>0))return 0;t=e.$(o[0])}},o.getFirstWidth=function(t){for(;;){var n=t.width();if(n)return n;var o=t.children();if(!(o&&o.length>0))return 0;t=e.$(o[0])}},o.containedTemplate=function(){return{update:function(r,i,a,s,u){var l=e.$("<div></div>");l.data("fo-append-count",0),e.ko.bindingHandlers.template.update(l[0],i,a,s,u),n.CollisionHelper.treatForCollisions(l);var c=e.ko.utils.unwrapObservable(i()),d="object"==typeof c&&c.adjustScale&&"MSIE 9"!=o.getBrowser()?c.adjustScale:{},f=e.$.extend(n.defaultAdjustScaleOptions,d);if("object"==typeof c&&(c.adjustHeightInterval&&setInterval(function(){var t=l&&l.children().length&&l.children()[0];if(t){var n=e.$(t).height();e.$(r).height(n)}},c.adjustHeightInterval),c.adjustWidthInterval&&setInterval(function(){var t=e.$(l.children()[0]).width();e.$(r).width(t)},c.adjustWidthInterval),f&&"MSIE 9"!=o.getBrowser()&&f.active)){var p=0,m=setInterval(function(){try{var t=l&&l.children().length&&l.children()[0],n=e.$(t).height();n>0&&(o.scaleOnResize(r,f,p),clearInterval(m))}catch(i){}},100);window.addEventListener("resize",function(){p=Math.max(e.$(r).height(),p),o.scaleOnResize(r,f,p)})}var h=setInterval(function(){if(!r.contentDocument)return void clearInterval(h);var n=e.$(r.contentDocument.body);if(0==n.children().length){n.append(l);var o=l.data("fo-append-count");o++,l.data("fo-append-count",o),o>1&&t.Logger.log("Appending template "+o),o>5&&(window.clearInterval(h),t.Logger.error("Appended over 5 times!"))}},100)}}},o.scaleOnResize=function(n,o,r){var i=window.innerHeight-o.top-o.bottom,a=(window.innerHeight-o.top-o.bottom)/r;a>1&&(a=1),a<o.minScale&&(a=o.minScale);var s=r*a,u=(i-s)*o.pos+o.top;0>u&&(u=0),e.$(n).css("transform","scale("+a+")"),e.$(n).css("right",(a-1)*e.$(n).width()+"px"),e.$(n).css("top",u+"px"),t.Logger.log("scale:"+a)},o.adjustHorizontalPosition=function(t,n,o){var r=window.innerWidth-n.left-n.right,i=r/o;i>1&&(i=1),i<n.minScale&&(i=n.minScale);var a=e.$(t).height()*(i-1);e.$(t).css("transform","scale("+i+")"),e.$(t).css("right",n.right+"px"),e.$(t).css("bottom",a+"px")},o.containerOf=function(){return{init:function(e,t,n,o,r){if("iframe"!=e.tagName.toLowerCase())throw new Error("ContainerOf binding is only applicable to IFRAME elements. You are trying to use it on "+e.tagName);if(e.src)throw new Error("ContainerOd binding is meant for src-less iframes. This one has an src")},update:function(t,n,o,r,i){var a=e.ko.utils.unwrapObservable(n()),s=e.$(a);if(1!=s.length)throw new Error("ContainerOf target selector '"+a+"' matched "+s.length+" elements. Expected to match exactly 1 element");setTimeout(function(){s.remove(),t.contentDocument.body.appendChild(s[0])},100)}}},o.containerCss=function(){return{update:function(o,r,i,a,s){var u=e.$(o),l=setInterval(function(){if(!o.contentDocument)return void clearInterval(l);var i=e.$(o.contentDocument.head);n.Col.of(r()).each(function(n){for(var r=!1,a=0;a<o.contentDocument.head.children.length;a++){var s=o.contentDocument.head.children[a];if(s.tagName&&"link"==s.tagName.toLowerCase()&&s.getAttribute("href")==n){r=!0;break}}if(!r){var c=e.$("<link rel='stylesheet' href='"+n+"'></link>");i.append(c);var d="fo-css-"+n,f=u.data(d)?u.data(d):0;f++,u.data(d,f),f>1&&t.Logger.log("Setting css "+f),f>5&&(window.clearInterval(l),t.Logger.error("Appended over 5 times!"))}})},100)}}},o.slideVisible=function(){return{init:function(t,n){var o=e.ko.unwrap(n());e.$(t).toggle(o)},update:function(t,n,o){var r=n(),i=e.ko.unwrap(r),a=o.get("slideInDuration")||300,s=o.get("slideOutDuration")||300;1==i?e.$(t).slideDown(a):e.$(t).slideUp(s)}}},o.fadeVisible=function(){return{update:function(t,n){var o=n();e.ko.unwrap(o)?e.$(t).show(600):e.$(t).hide(600)}}},o.fadeVisibleInvisibleRemove=function(){return{update:function(t,n){var o=n();e.ko.unwrap(o)?e.$(t).fadeIn():e.$(t).fadeOut(600,function(){e.$(t).remove()})}}},o}();n.KoBindings=r}(n=t.Common||(t.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(n){function o(t,o,r){n.call(this,t,o,r),this.currentBodyRect=null,this.context=t,this.ribbonModels=e.ko.observableArray(),this.ribbonsVisible=e.ko.observable(!0)}return __extends(o,n),o.prototype.addRibbon=function(e){this.ribbonModels.push(e)},o.prototype.updatePrimaryRibbon=function(e){var n=this;t.Common.Col.of(this.ribbonModels()).each(function(t){t.ribbonVisible(t.imageToDrawOn==e),t.imageToDrawOn==e&&(n.primaryRibbon=t)})},o.prototype.updateRibbonPositionIfNeeded=function(){if(this.primaryRibbon){var n=this.context.scraper().getElementPosWithOffsets(e.$("body")[0]);this.currentBodyRect?t.Common.isEquivalent(n,this.currentBodyRect)||(this.primaryRibbon.updateImageRect(),this.currentBodyRect=n):(this.currentBodyRect=n,this.primaryRibbon.updateImageRect())}},o}(n.ProductModelBase);n.MultiRibbonModel=o}(n=t.Model||(t.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(){this.multiRibbonModel=null,this.lastViewportPosition=-999999,this.currentPrimaryImage=null}return n.prototype.realEstate=function(){return 6},n.prototype.flag=function(){return"rrb"},n.prototype.determineNeededItemCount=function(e){return new t.Products.ItemCounts(4,8)},n.prototype.declareResourcesPromise=function(e){return{reset2_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/reset.css"),icons_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/foicons.css"),ribbon_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/dealsRightRibbon.css"),displayWindowcss:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/displayWindow.css"),displayWindowBgcss:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/cssImages.css"),fa_css:t.Common.Res.injectCss2("//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"),ribbonHtml:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Visual/dealsRightRibbon.html"),displayWindowHtml:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Visual/displayWindow.html")}},n.prototype.draw=function(e,n,o){var r=this,i=n.CommerceRibbon.context;return this.prepareMultiRibbonBinding(i,o),window.setInterval(function(){return r.drawRibbonsWhereNeeded(e,i,o)},1e3),this.drawRibbonsWhereNeeded(e,i,o),window.setInterval(function(){return r.updateRibbonPositionIfNeeded()},1e3),t.Common.resolve(null)},n.prototype.drawRibbonsWhereNeeded=function(e,n,o){var r=this.findImagesWithRibbonData();if(0==r.length)return void t.Logger.info("No images found with ribbon data. Doing nothing");var i=t.Common.Col.of(r).orderByDesc(function(e){return e.data("fo-ribbon-primary")?e.data("fo-ribbon-primary"):-1}),a=i.getItem(0);if(null==this.currentPrimaryImage||this.currentPrimaryImage!==a[0])if(this.currentPrimaryImage=a[0],this.imageHasRibbonVisual(a)){t.Logger.info("Primary Image has a ribbon visual, updating primary ribbon");var s=this.currentPrimaryImage;this.multiRibbonModel.updatePrimaryRibbon(s)}else{t.Logger.info("Primary Image DOESN'T have ribbon visual, drawing new one");var u=a.data("fo-ribbon-data"),l=a.data("fo-ribbon-size");this.drawNewRibbon(e,n,u,l,a,o)}},n.prototype.updateRibbonPositionIfNeeded=function(){this.multiRibbonModel.updateRibbonPositionIfNeeded()},n.prototype.findImagesWithRibbonData=function(){for(var n=[],o=0;o<document.images.length;o++){var r=e.$(document.images[o]);r.data("fo-ribbon-data")&&(r.is(":visible")?n.push(r):t.Logger.info("Image has data but is not visible, filtering it out"))}return n},n.prototype.imageHasRibbonVisual=function(e){return!!e.data("fo-ribbon-visual-state")},n.prototype.calculateRelativeOpacity=function(e){var t,n,o=e.find("#fo-right-ribbon"),r=o[0].getBoundingClientRect();return t=r.top<0?Math.max(0,r.top+r.height):r.bottom>(window.innerHeight||document.documentElement.clientHeight)?Math.max(0,(window.innerHeight||document.documentElement.clientHeight)-r.top):r.height,n=t/r.height},n.prototype.prepareMultiRibbonBinding=function(n,o){var r=o.ribbonHtml,i="fo-right-ribbon fo-deal-offers",a=t.Common.VisualHelper.appendHtmlWithRootClass(r,i)[0],s=o.displayWindowHtml,u=e.$.parseHTML(s)[0];e.$(a).find("#fo-ribbon-container").append(u);try{var l=t.Products.VisualRealEstate[this.realEstate()],c="forb";this.multiRibbonModel=new t.Model.MultiRibbonModel(n,l,c),e.ko.applyBindings(this.multiRibbonModel,a)}catch(d){throw e.$(a).remove(),d}},n.prototype.drawNewRibbon=function(e,n,o,r,i,a){var s=i.data("fo-ribbon-visual-state");if(!s){i.data("fo-ribbon-visual-state","drawing");var u=i[0],l=new t.Model.RibbonCommerceOffersModel(n,o,u,r);this.multiRibbonModel.addRibbon(l),this.currentPrimaryImage=u,this.multiRibbonModel.updatePrimaryRibbon(this.currentPrimaryImage),i.data("fo-ribbon-visual-state","drawn"),t.Logger.Analytics.notify(n,t.Logger.Analytics.IMPRESSION)}},n.prototype.remove=function(e){this.multiRibbonModel.hide()},n}();n.CommerceRightRibbonVisual=o}(n=t.ExternalProducts||(t.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.splitPrice=function(t){"string"!=typeof t&&(t=""+t),t=t.replace(/[\n\t ]/gi,""),t=t.replace(/(<([^>]+)>)/gi,""),t=t.replace(/<.+/g,"");var n,o,r,i,a=/([\$\u00A3\u20AC\u0440\u0192\u00A5\u20B1]|usd|eur|ils|r|rs|rp|){1,2}\.?/gi;t||(n=0,o=0,c="");var s,u,l=t.match(a),c=l?l[0]:"",d=t.replace(a,""),f=d.indexOf("."),p=d.indexOf(",");return-1==f&&-1==p?(n=e.strToNumber(d),o=0):(s=Math.max(f,p),u=d[s]||(f>p?".":","),d=d.replace(/ /g,""),d.length-s<=3?(r=d.split(u),n=e.strToNumber(r[0]),o=e.strToNumber(r[1])):(n=e.strToNumber(d),o=0)),i=parseFloat(n+"."+o),0==n&&0==o?null:{round:n,cents:o,sign:c,fullPrice:i}},e.strToNumber=function(e){if(!e)return 0;var t=/[0-9]/gi,n=e.match(t),o=n?n.join(""):"",r=o.length?parseInt(o):0;return r},e}();e.PriceUtils=t}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(){}return t.getCookie=function(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var r=n[o];" "==r.charAt(0);)r=r.substring(1);if(-1!=r.indexOf(t))return r.substring(t.length,r.length)}return""},t.setCookie=function(e,t,n,o){var r="";n&&(new Date((new Date).getTime()+24*n*60*60*1e3).toUTCString(),r="; expires="+new Date((new Date).getTime()+24*n*60*60*1e3).toUTCString());var i="";o&&(i="; domain="+o),document.cookie=e+"="+t+r+"; path=/"+i},t.setBackendClickCookie=function(t,n){void 0===n&&(n={});try{var o=t.paths().notifyRoot()+"/c/clk/logo.png",r=t.paths().domain();if(o+="?",o=o+"&domain="+encodeURIComponent(r),n)for(var i in n){var a=n[i]+"";o=o+"&"+i+"="+encodeURIComponent(a)}e.Logger.Analytics.notifyGenericUrl(o)}catch(s){}},t}();t.CookieUtils=n}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function o(){}return o.storeImpressionKeywords=function(e,t){o.storeKeywords(e,t,o.RT_IMPRESSIONS_KEY),e.iframe().postRequest("storeImpressionCookie",!1,null,t)},o.storeClickKeywords=function(e,t){var r=o.storeKeywords(e,t,o.RT_CLICKS_KEY);e.iframe().postRequest("storeClickCookie",!1,null,t),n.CookieUtils.setBackendClickCookie(e,{clk:r})},o.storeKeywords=function(e,t,o){var r=localStorage.getItem(o),i=r?JSON3.parse(r):[];return i.push({keywords:t.split(" "),when:(new Date).getTime()}),i=n.Col.of(i).orderBy(function(e){return e.when}).take(10).toArray(),r=JSON3.stringify(i),localStorage.setItem(o,r),r},o.storeClickKeywordsToCookie=function(e,t,n){o.storeKeywordsToCookie(e,t,o.RT_CLICKS_KEY,n)},o.storeImpressionKeywordsToCookie=function(e,t,n){o.storeKeywordsToCookie(e,t,o.RT_IMPRESSIONS_KEY,n)},o.storeKeywordsToCookie=function(e,o,r,i){var a,s=n.CookieUtils.getCookie(r);try{s=s?decodeURIComponent(s):"",a=s?JSON3.parse(s):[]}catch(u){t.Logger.warn("error in Json.Parse on "+s),a=[]}a.push({keywords:o.split(" "),when:(new Date).getTime()}),a=n.Col.of(a).orderBy(function(e){return e.when}).take(10).toArray(),s=JSON3.stringify(a),n.CookieUtils.setCookie(r,s,365,i)},o.getRetargetingKeywordsFromLocalStorage=function(e){var t=o.readRecentKewwordsFromSource(o.RT_IMPRESSIONS_KEY),n=o.readRecentKewwordsFromSource(o.RT_CLICKS_KEY);return o.getRetargetingKeywords(e,t,n)},o.getRetargetingKeywordsFromCookie=function(e){var t=o.readRecentKewwordsFromCookieSource(o.RT_IMPRESSIONS_KEY),n=o.readRecentKewwordsFromCookieSource(o.RT_CLICKS_KEY);return o.getRetargetingKeywords(e,t,n)},o.readRecentKewwordsFromSource=function(e){var t=((new Date).getTime(),localStorage.getItem(e)),o=t?JSON3.parse(t):[];return n.Col.of(o).orderByDesc(function(e){return e.when})},o.readRecentKewwordsFromCookieSource=function(e){var t=((new Date).getTime(),n.CookieUtils.getCookie(e)),o=t?JSON3.parse(t):[];return n.Col.of(o).orderByDesc(function(e){return e.when})},o.getRetargetingKeywords=function(e,t,n){var r=e.overrides().boolValue("retarget.oldalgo",!0);return r?o.getRetargetingKeywords_OldAlgo(e,t,n):o.getRetargetingKeywords_new(e,t,n)},o.getRetargetingKeywords_new=function(t,o,r){var i=t.overrides().floatValue("retarget-weights.type",2),a=t.overrides().floatValue("retarget-weights.age",2),s=t.overrides().floatValue("retarget-weights.page-match",2),u=t.overrides().floatValue("retarget-weights.word-repeat",2),l=o.select(function(e){return{keywords:e.keywords,when:e.when,typeScore:0,ageScore:null,repeatScore:null,matchScore:null,normTypeScore:null,normAgeScore:null,normRepeatScore:null,normMatchScore:null,totalScore:null}}),c=r.select(function(e){return{keywords:e.keywords,when:e.when,typeScore:1,ageScore:null,repeatScore:null,matchScore:null,normTypeScore:null,normAgeScore:null,normRepeatScore:null,normMatchScore:null,totalScore:null}}),d=l.mergeCol(c);if(0==d.length())return[];var f=d.minBy(function(e){return e.when}).when,p={};d.each(function(e){n.Col.of(e.keywords).each(function(e){p[e]=p[e]?p[e]+=1:1})});var m=e.$("body").text(),h=n.Col.aggregate(m.split(/\W+/gi),{},function(e,t){return e.length>0&&(t[e]=e in t?t[e]+1:1),t});d.each(function(e){e.ageScore=(e.when-f)/(1e3*n.DAY_SECONDS),e.repeatScore=n.Col.sum(e.keywords,function(e){return p[e]}),e.matchScore=n.Col.sum(e.keywords,function(e){return e in h?h[e]:0})}),d.normalize(function(e){return e.ageScore},function(e,t){return e.normAgeScore=t}),d.normalize(function(e){return e.typeScore},function(e,t){return e.normTypeScore=t}),d.normalize(function(e){return e.repeatScore},function(e,t){return e.normRepeatScore=t}),d.normalize(function(e){return e.matchScore},function(e,t){return e.normMatchScore=t}),d.each(function(e){e.totalScore=e.normTypeScore*i+e.normAgeScore*a+e.normRepeatScore*u+e.normMatchScore*s});var g=d.orderByDesc(function(e){return e.totalScore}).firstOrValue(null);return g.keywords},o.getRetargetingKeywords_OldAlgo=function(e,t,r){var i={};t.each(function(e){n.Col.of(e.keywords).each(function(e){i[e]=i[e]?i[e]+=1:1})}),r.each(function(e){n.Col.of(e.keywords).each(function(e){i[e]=i[e]?i[e]+=2:2})});var a=t.select(function(e,t){var r=n.Col.sum(e.keywords,function(e){return i[e]}),a=r*(o.POSITION_WEIGHT+t);return{keywords:e.keywords,score:a}}),s=r.select(function(e,t){var r=n.Col.sum(e.keywords,function(e){return i[e]}),a=r*(o.POSITION_WEIGHT+t);return{keywords:e.keywords,score:a}}),u={keywords:[],score:0},l=a.orderByDesc(function(e){return e.score}).firstOrValue(u),c=s.orderByDesc(function(e){return e.score}).firstOrValue(u);return l.score>c.score?l.keywords:c.keywords},o.RT_CLICKS_KEY="fo-rt-clk",o.RT_IMPRESSIONS_KEY="fo-rt-imp",o.POSITION_WEIGHT=8,o}();n.Retargeting=o}(n=t.Common||(t.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(){}return t.pruneQueryData=function(t,n){var o=e.Common.Col.of(t.kwc).where(function(t){return!e.Common.Col.contains(n,t.w)}),r=t.t;e.Common.Col.of(n).each(function(e){return r=r.replace(e,"")});var i=o.orderBy(function(e){return r.indexOf(e.w)});return{kwc:i.toArray(),t:r,clientPrice:t.clientPrice,source:t.source+"-pruned"}},t.pruneTooManyKeywords=function(n,o){void 0===o&&(o=20);var r=e.Common.Col.of(n.kwc).orderByDesc(function(e){return e.c}),i=r.skip(o).select(function(e){return e.w}).toArray();return t.pruneQueryData(n,i)},t.pruneKeywordsToTopHalf=function(n){var o=e.Common.Col.of(n.kwc).orderByDesc(function(e){return e.c}),r=o.length()>0?o.getItem(0).c:0,i=r/2,a=o.where(function(e){return e.c>=i}),s=Math.max(t.MIN_WORDS,a.length()),u=o.skip(s).select(function(e){return e.w}).toArray();return t.pruneQueryData(n,u)},t.pruneKeywordsToOverMedian=function(n){var o=e.Common.Col.of(n.kwc).orderByDesc(function(e){return e.c}),r=Math.max(t.MIN_WORDS,Math.ceil(o.length()/2));if(r<o.length()){var i=o.getItem(r).c,a=o.where(function(e){return e.c<i}).select(function(e){return e.w}).toArray();return t.pruneQueryData(n,a)}return n},t.logQueryData=function(t){var n=e.Common.Col.of(t.kwc).select(function(e){return e.w+" ("+e.c+")"}).stringJoin(" ");e.Logger.info("Requesting offers with\nSource:	"+t.source+"\nPrice:	"+t.clientPrice+"\nKwds:	"+n+"\n")},t.queryApi=function(n,o,r,i){t.logQueryData(i),i=t.pruneTooManyKeywords(i,20);var a=n.overrides().intValue("offersapi.prune",0);a>0&&(1==a&&(i=t.pruneKeywordsToTopHalf(i)),2==a&&(i=t.pruneKeywordsToOverMedian(i)),t.logQueryData(i));var s=n.overrides().boolValue("api.ignore-only-numbers",!0),u=n.overrides().boolValue("api.ignore-less-than-two-words",!0);if(s&&this.queryContainsOnlyNumbers(i))return e.Logger.warn("Query contains only numbers: "+i),e.Common.resolve([]);if(u&&this.queryContainsLessThanTwoKeywords(i))return e.Logger.warn("Query contains less than 2 words: "+i),e.Common.resolve([]);var l=e.Logger.Reporting.resolveReportingProduct(n.logic().flag(),n.visual.flag()),c={rootUrl:n.paths().apiRoot(),base64Data:encodeURIComponent(e.Common.Base64.encode(JSON3.stringify(i))),partnerId:n.params().partnerCode,countryCode:n.countryCode().toLowerCase(),hostName:n.host(),offers:o,apiContext:r,rp:l},d=e.Common.namedStringFormat("{rootUrl}/o/1234/{base64Data}?partid={partnerId}&hn={hostName}&offers={offers}&c={countryCode}&rp={rp}",c);return null!=n.params().subId&&(d=d+"&subid="+n.params().subId),null!=r&&(d=d+"&context="+r),e.Common.jqGetPromise(d).then(function(e){return JSON3.parse(e)})},t.queryContainsOnlyNumbers=function(e){return 0==e.t.replace(/[0-9]/g,"").trim().length},t.queryContainsLessThanTwoKeywords=function(e){return e.kwc.length<2},t.queryFromData=function(t,n){var o=n.wordCounts.select(function(e){return{w:e.key,c:e.value}}).toArray(),r=t.overrides().boolValue("api.fixed-kwc-t",!0);if(r){var i=e.Common.Col.select(o,function(e){return e.w}).join(" "),a={kwc:o,t:i,clientPrice:n.price,source:"api-"+n.source};return a}var s=null,u=e.Common.Col.where(o,function(e){return e.c>1});s=u.length>1?e.Common.Col.select(u,function(e){return e.w}).join(" "):e.Common.Col.select(o,function(e){return e.w}).join(" ");var a={kwc:o,t:s,clientPrice:n.price,source:"api-"+n.source};return a},t.queryFromRetargeting=function(t){var n=e.Common.Retargeting.getRetargetingKeywordsFromLocalStorage(t);if(0==n.length)return null;var o=e.Common.Col.select(n,function(e){return{w:e,c:1}}),r={kwc:o,t:n.join(" "),clientPrice:-1,source:"retargeting"};return r},t.queryFromGenericKeywords=function(t){var n=e.Common.Col.select(t,function(e){return{w:e,c:1}}),o={kwc:n,t:t.join(" "),clientPrice:-1,source:"generic-keywords"};return o},t.dealsFromOffers=function(t,n){var o=t.paths().outerResourcesRoot()+"/empty_merchant.jpg",r=t.overrides().boolValue("deals.default-merchant-image",!1),i=e.Common.Col.of(n).orderByDesc(function(e){return e.rank}).select(function(e,t){var n={title:e.title,price:e.price,thumb:e.largeImage?e.largeImage:e.images,url:-1==e.url.indexOf("?")?e.url+"?safepassage=1":e.url+"&safepassage=1",merchantThumb:e.merchantImage||!r?e.merchantImage:o,merchantText:e.merchant,ribbon:0==t?"Best Deal":"",part:e.part,keywords:e.keywords,freeShipping:e.freeShipping,onClick:e.onClick};return n});return i.toArray()},t.MIN_WORDS=4,t}();t.OffersApi=n}(t=e.Data||(e.Data={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(){}return n.prototype.flag=function(){return"pp"},n.prototype.dataKey=function(){return"CommerceDeals"},n.prototype.supportsStickyClassification=function(){return!0},n.prototype.classify=function(e){return t.Common.namedWaterfall([{name:"schemaorg",value:function(){return t.Vertical.CommerceHelper.classifyBySchemaOrg(e)}},{name:"specialcase",value:function(){return t.Vertical.CommerceHelper.classifyBySpecialCasesAndJunk(e)}},{name:"bwl",value:function(){return t.Vertical.CommerceHelper.classifyByBlackWhiteList(e)}},{name:"dict",value:function(){return t.Vertical.CommerceHelper.classifyByDictionaries(e)}},{name:"ribbon",value:function(){return t.Vertical.CommerceHelper.classifyByProductImage()}}],function(e){return 0!=e}).alwaysThen(function(e,t){return t?{name:t.message,value:0}:e})},n.prototype.scrapeAndObtainData=function(e,n,o){var r=this.queryFromPageOrDedicated(e),i=r.then(function(o){return t.Data.OffersApi.queryApi(e,3*n.totalCount(),null,o)}),a=this.retargetIfEmptyPageResult(e,i,3*n.totalCount()),s=a.then(function(r){var i=e.logic().flag()+"_"+e.visual.flag(),a=o.claimUniques(r.results,function(e){return e.url},i,n.primaryCount),s=o.cliamWithoutMarking(r.results,function(e){return e.url},n.secondaryCount,a),u=a.concat(s),l=t.Data.OffersApi.dealsFromOffers(e,u);return new t.Data.PlainDataResult(r.source,e,l)});return this.postProcessResults(e,s),s},n.prototype.queryFromPageOrDedicated=function(n){var o=this,r=window.location.host,i=t.Common.DedicatedHelper.tryScrpaePageByDedicated(r,n);return i.alwaysThen(function(r,i){var a=new e.NWPLegacy,s=null,u=n.overrides().boolValue("ribbon-find-image-big-or-second",!1);if(u){var l=t.Common.ImageUtils.findValidImagesBySize(0,4,!1);l.length>0&&(s=l[0])}else s=o.getFirstImgElement();var c=o.generateOfferesApiRequestDateFromScrapingOrDedicated(n,a,s,r);return t.Data.OffersApi.queryFromData(n,c)})},n.prototype.generateOfferesApiRequestDateFromScrapingOrDedicated=function(e,n,o,r){var i=e.overrides().boolValue("dedicated-part-of-scrape",!1),a=r&&this.dedicatedLooksValid(r),s={wordCounts:t.Common.Map.emptyMap(),price:0,source:null};if(a&&!i){e.pushNotificationParam("hasDedicated","1"),t.Logger.info("Using dedicated"),s.wordCounts=r.wordCounts,s.source="dedicated";var u=this.dedicatedHasPrice(r)?r.clientPrice:n.PriceUtils.getPrice(o);s.price=u}else t.Logger.info(r?"Using Dedicated as amlifier":"Using generic scrape"),s.wordCounts=this.genericScrape(e,o,r),s.price=n.PriceUtils.getPrice(o),s.source="generic-scrape";return s},n.prototype.getFirstImgElement=function(){var e=t.Common.ImageUtils.getFirstEcommerceImage(!0,!0);return e||(e=t.Common.ImageUtils.getFirstEcommerceImage(!0,!1)),e},n.prototype.retargetIfEmptyPageResult=function(e,n,o){var r=n.then(function(n){var r=null;if(n.length)r=t.Common.resolve({source:"api",results:n});else{var i=t.Data.OffersApi.queryFromRetargeting(e);if(null==i)return t.Common.resolve({source:null,results:[]});r=t.Data.OffersApi.queryApi(e,o,null,i).then(function(e){return{source:"rt",results:e}})}return r});return r},n.prototype.postProcessResults=function(n,o){o.then(function(o){if(o.data.length){var r=o.data[0].keywords;t.Common.Retargeting.storeImpressionKeywords(n,r),t.Common.Col.each(o.data,function(o){o.onClick=function(){t.Common.Retargeting.storeClickKeywords(n,o.keywords),t.Logger.Analytics.notifyGenericUrl("https://secure.adnxs.com/seg?add=2205805&t=2",{},n,!0),e.$("<iframe />",{name:"frame1",id:"frame1",src:n.paths().innerResourcesRoot()+"/Iframes/TestCookieIframe.html"}).appendTo("body")}})}})},n.prototype.dedicatedLooksValid=function(e){var n=e.wordCounts.length()>1;return n||t.Logger.warn("Dedicated result too small. Will ignore: "+JSON3.stringify(e)),n},n.prototype.dedicatedHasPrice=function(e){var n=e.clientPrice&&e.clientPrice!=t.Common.DedicatedHelper.MAX_PRICE;return n||t.Logger.info("Dedicated didn't find a price"),n},n.prototype.genericScrape=function(e,n,o){var r=["search","here","keyword","keywords","product","products","username","email","password","enter"],i=["q","Search","search","searchterm","searchTerm","search_query","query","Keywords","keywords","field-keywords","w","kw","origkw","SearchString","searchString","keys","text","Ntt","qu","Keyword","keyword","SearchTerms","searchTerms","_nkw"],a=e.overrides().intValue("deal-scrape-weights-amplify.ribbon",10),s=e.overrides().intValue("deal-scrape-weights-amplify.search",8),u=e.overrides().intValue("deal-scrape-weights-amplify.importantqs",20),l=e.overrides().intValue("deal-scrape-weights-amplify.text",1),c=e.overrides().intValue("deal-scrape-weights-amplify.h1",6),d=e.overrides().intValue("deal-scrape-weights-amplify.title",6),f=e.overrides().intValue("deal-scrape-weights-amplify.otherqs",1),p=e.overrides().intValue("deal-scrape-weights-amplify.dedicated",6),m=e.scraper(),h=new t.Common.WordCounter,g=[],v=t.Common.ImageUtils.getImageText(n);v&&(g=t.Common.WordUtils.getNonTrivialWords(v));var y=document.querySelectorAll("input[type='search']"),C=t.Common.Col.select(t.Common.Col.numValues(y),function(e){return e.value}).join(" "),b=t.Common.WordUtils.getNonTrivialWords(C),w=t.Common.Col.intersect(b,r).length?[]:b,_=[],S=[];for(var E in m.queryParams()){var R=m.queryParams()[E].split(/[+| ]/);if(t.Common.Col.contains(i,E))for(var O=0;O<R.length;O++)_.push(R[O]);else for(var O=0;O<R.length;O++)S.push(R[O])}if(g.length>0||b.length>0||_.length>0){var F=[];o&&(F=o.wordCounts.selectMany(function(e){return t.Common.Col.repeatString(e.key,e.value)}).toArray());var k=m.getFirstMatchText(["h1"]),x=t.Common.WordUtils.getNonTrivialWords(k),D=t.Common.WordUtils.getNonTrivialWords(document.title),T=document.querySelectorAll("input[type='text']"),A=t.Common.Col.select(t.Common.Col.numValues(T),function(e){return e.value}).join(" "),P=t.Common.WordUtils.getNonTrivialWords(A),I=t.Common.Col.intersect(P,r).length?[]:P,H=[];H.push({keywords:g,weight:a,source:"Product Image"}),H.push({keywords:D,weight:d,source:"Title"}),H.push({keywords:x,weight:c,source:"H1"}),H.push({keywords:S,weight:f,source:"unknown query string"}),H.push({keywords:F,weight:p,source:"Dedicated keywords"}),H.push({keywords:_,weight:u,source:"Recognized query string"}),H.push({keywords:I,weight:l,source:"Text inputs"}),H.push({keywords:w,weight:s,source:"Search inputs"});var M=new t.Common.Col(H),B=M.orderByDesc(function(e){return e.weight}).toArray();t.Common.Col.each(B,function(e){h.pushAndAmplify(e.keywords,e.source,e.weight)})}var N=t.Common.Col.where(h.getWords(),function(e){return!e.match(/^[\s]*$/)}),L=t.Common.WordUtils.countWords(N);return L},n}();n.CommerceDealsLogic=o}(n=t.ExternalProducts||(t.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.setCouponRevealed=function(t){var n=e.getCouponMarker(t);null==n&&(n={code:t,revealTimestamp:null,freshlyRevealed:null}),n.revealTimestamp=(new Date).getTime(),n.freshlyRevealed=!0,e.setCouponMarker(n)},e.setRevealedCouponSeen=function(t){var n=e.getCouponMarker(t);null==n&&(n={code:t,revealTimestamp:(new Date).getTime(),freshlyRevealed:null}),n.freshlyRevealed=!1,e.setCouponMarker(n)},e.createCouponMarker=function(e){var t=(new Date).getTime();return{code:e,revealTimestamp:t,freshlyRevealed:!0}},e.getCouponMarker=function(e){var t=null;try{var n=localStorage.getItem("cpn_rvl_"+e);return t=JSON3.parse(n),t.code?t:null}catch(o){}},e.setCouponMarker=function(e){var t=JSON3.stringify(e);localStorage.setItem("cpn_rvl_"+e.code,t)},e.setCouponRevealedMessage=function(t,n){e.setCouponsMessage("Coupon for "+n+" revealed. Copy / Paste '"+t+"' at checkout")},e.setCouponAppliedMessage=function(t,n){e.setCouponsMessage("Coupon for "+n+" has been applied. Enjoy!")},e.setCouponsMessage=function(e){localStorage.setItem("anounceCoupons",e)},e.pollCouponsMessage=function(){var e=localStorage.getItem("anounceCoupons");return e&&localStorage.removeItem("anounceCoupons"),e},e}();e.CouponsHelper=t}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(){}return t.queryApi=function(n,o,r){var i=n.paths().cachedApiRoot()+"/api/search?v=1&type=coupon&limit="+o+"&q="+encodeURIComponent(r);return e.Common.jqGetPromise(i).then(function(e){var n=JSON3.parse(e);return window.FO_COUPON_TEST?t.testData.coupon:n.coupon})},t.couponsFromCouponOffers=function(t){var n=e.Common.Col.select(t,function(t){var n=t.couponCode?e.Common.CouponsHelper.getCouponMarker(t.couponCode):null,o=(new Date).getTime(),r=n&&o-n.revealTimestamp<2*e.Common.HOUR_SECONDS*1e3,i={url:t.url,title:t.title,description:t.description,merchant:t.merchant,merchantImage:t.merchantImage,code:t.couponCode,revealed:r,isDirect:!t.couponCode,part:"na",partialCode:t.couponCode?t.couponCode.replace(/^../,"XX"):null};return i});return n},t.testData={coupon:[{title:"Extra 15% off Sitewide",merchantDisplayUrl:"http://www.jcpenney.com",merchant:"jcpenney",description:"Save additional 15% on your order when you apply the code at checkout, save up to 74%. Orders over $99 ship free. Excludes Sephora, Gift Cards, Services, Service Plans and other restrictions; see website for details.",score:15294,altTitle:"15% Off",fileName:"FirstOffer_US_Coupons_11102014.xml.gz",image:"http://cdn.savings.com/logo/4215555.png",couponCode:"AFFSHOP1",merchantImage:"http://cdn.savings.com/logo/4215555.png",url:"http://www.savings.com/m/p/22441821/7126168/c?afsrc=1&up=2014-11-10-02-40"},{title:"Extra 20% off All Orders Using Store Credit Card",merchantDisplayUrl:"http://www.jcpenney.com",merchant:"jcpenney",description:"Enter this code at checkout and get additional 20% discount on all orders using store credit card, get up to 40% total savings. Shipping is free on orders $99 or more. Restrictions may apply.",score:14842,altTitle:"20% Off",fileName:"FirstOffer_US_Coupons_11102014.xml.gz",image:"http://cdn.savings.com/logo/4215555.png",couponCode:"VAULT",merchantImage:"http://cdn.savings.com/logo/4215555.png",url:"http://www.savings.com/m/p/22441821/7733390/c?afsrc=1&up=2014-11-10-02-40"},{title:"Free Shipping on All Orders $99 or More",merchantDisplayUrl:"http://www.jcpenney.com",merchant:"jcpenney",description:"Get free shipping anywhere on orders of $99 or more. See website for details.",score:11663,fileName:"FirstOffer_US_Coupons_11102014.xml.gz",image:"http://cdn.savings.com/logo/4215555.png",merchantImage:"http://cdn.savings.com/logo/4215555.png",url:"http://www.savings.com/m/p/22441821/6848063/c?afsrc=1&up=2014-11-10-02-40"},{title:"10-15% off Apparel, Shoes, Accessories, Jewelry & Home",merchantDisplayUrl:"http://www.jcpenney.com",merchant:"jcpenney",description:"Save 15% off apparel, shoes, accessories,fine jewelry & home and 10% off watches, furniture, mattresses, custom blinds and shades. Restrictions apply. Orders over $99 ship free. Limited time offer.",
score:2476,altTitle:"15% Off",fileName:"FirstOffer_US_Coupons_11102014.xml.gz",image:"http://cdn.savings.com/logo/4215555.png",couponCode:"FUNDEAL",merchantImage:"http://cdn.savings.com/logo/4215555.png",url:"http://www.savings.com/m/p/22441821/7121523/c?afsrc=1&up=2014-11-10-02-40"},{title:"Extra 15% off Sitewide",merchantDisplayUrl:"http://www.jcpenney.com",merchant:"jcpenney",description:"Save additional 15% on your order when you apply the code at checkout, save up to 74%. Orders over $99 ship free. Excludes Sephora, Gift Cards, Services, Service Plans and other restrictions; see website for details.",score:15294,altTitle:"15% Off",fileName:"FirstOffer_US_Coupons_11102014.xml.gz",image:"http://cdn.savings.com/logo/4215555.png",couponCode:"AFFSHOP1",merchantImage:"http://cdn.savings.com/logo/4215555.png",url:"http://www.savings.com/m/p/22441821/7126168/c?afsrc=1&up=2014-11-10-02-40"},{title:"Extra 20% off All Orders Using Store Credit Card",merchantDisplayUrl:"http://www.jcpenney.com",merchant:"jcpenney",description:"Enter this code at checkout and get additional 20% discount on all orders using store credit card, get up to 40% total savings. Shipping is free on orders $99 or more. Restrictions may apply.",score:14842,altTitle:"20% Off",fileName:"FirstOffer_US_Coupons_11102014.xml.gz",image:"http://cdn.savings.com/logo/4215555.png",couponCode:"VAULT",merchantImage:"http://cdn.savings.com/logo/4215555.png",url:"http://www.savings.com/m/p/22441821/7733390/c?afsrc=1&up=2014-11-10-02-40"},{title:"Free Shipping on All Orders $99 or More",merchantDisplayUrl:"http://www.jcpenney.com",merchant:"jcpenney",description:"Get free shipping anywhere on orders of $99 or more. See website for details.",score:11663,fileName:"FirstOffer_US_Coupons_11102014.xml.gz",image:"http://cdn.savings.com/logo/4215555.png",merchantImage:"http://cdn.savings.com/logo/4215555.png",url:"http://www.savings.com/m/p/22441821/6848063/c?afsrc=1&up=2014-11-10-02-40"},{title:"10-15% off Apparel, Shoes, Accessories, Jewelry & Home",merchantDisplayUrl:"http://www.jcpenney.com",merchant:"jcpenney",description:"Save 15% off apparel, shoes, accessories,fine jewelry & home and 10% off watches, furniture, mattresses, custom blinds and shades. Restrictions apply. Orders over $99 ship free. Limited time offer.",score:2476,altTitle:"15% Off",fileName:"FirstOffer_US_Coupons_11102014.xml.gz",image:"http://cdn.savings.com/logo/4215555.png",couponCode:"FUNDEAL",merchantImage:"http://cdn.savings.com/logo/4215555.png",url:"http://www.savings.com/m/p/22441821/7121523/c?afsrc=1&up=2014-11-10-02-40"}]},t}();t.CouponsApi=n}(t=e.Data||(e.Data={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(){this.couponUrlMatch=null}return t.prototype.supportsStickyClassification=function(){return!1},t.prototype.dataKey=function(){return"Coupons"},t.prototype.flag=function(){return"cpn"},t.prototype.classify=function(n){var o=this;if(0==document.location.host.indexOf("localhost")||window.FO_COUPON_TEST)return e.Common.toNamedPromise("test",e.Common.resolve(1));var r=n.paths().blackWhiteListRoot()+"/searchcpn/",i=n.paths().dynamicContentRoot()+"/cu/cu",a=t.breakUrlIntoComponents(document.location.protocol+"//"+document.location.host,document.location.pathname),s=e.Common.BlackWhiteListHelper.blackWhiteMatch(a,i,null,r).then(function(e){return o.couponUrlMatch=e.match,e.score}).alwaysThen(function(e,t){return t?-1:e});return e.Common.toNamedPromise("bwl",s)},t.prototype.scrapeAndObtainData=function(t,n,o){var r=this,i=e.Data.CouponsApi.queryApi(t,3*n.totalCount(),this.couponUrlMatch),a=i.then(function(i){var a=o.claimUniques(i,function(e){return e.url},r.flag(),n.totalCount()),s=e.Data.CouponsApi.couponsFromCouponOffers(a),u={rootCouponsUrl:r.couponUrlMatch};return new e.Data.PlainDataResult("api",t,s,u)});return a},t.breakUrlIntoComponents=function(e,t){for(var n=[e],o=t.split("/"),r=o.length;r>0;r--){var i=e+o.slice(0,r).join("/");n.push(i,i+"/")}return n},t}();t.CouponsLogic=n}(t=e.ExternalProducts||(e.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(){}return t.queryApi=function(n,o,r){var i=r.substr(-1);("/"==i||"#"==i)&&(r=r.substring(0,r.length-1));var a=n.paths().cachedApiRoot()+"/cmpn/"+e.Common.Base64.encode(r);return e.Common.jqGetPromise(a).then(function(e){var n="{}"!=e?JSON3.parse(e):{offers:[]};return window.FO_CAMPAIGN_TEST?t.testData.offers:n.offers})},t.campaignsFromCampaignOffers=function(t){var n=e.Common.Col.select(t,function(e){var t={accountTitle:e.accountTitle,campaignTitle:e.campaignTitle,url:e.linkUrl,title:e.title,description:e.description,imageUrl:e.imageUrl,actionBtnTitle:e.actionBtnTitle,part:"na"};return t});return n},t.testData={offers:[{_id:"4k7jNAURSm6DCMy7h2QWcg",accountTitle:"Webfore Japan ",campaignTitle:"Hay Fever",title:"?????????????? ????????????! ??????1000???!! ??????  ",description:" offer1",linkUrl:"http://www.kafunsho.sg/kafunsho/?aff_id=fstofz&chan=kfs1",imageUrl:"http://www.imageurlhost.com/images/celapw466g5za1pjls4.jpg",htmlTemplate:"",htmlScript:null},{_id:"AFlXkGD6QACfwxDvQLc9CA",accountTitle:"Webfore Japan ",campaignTitle:"Hay Fever",title:"?????????????? ????????????! ??????1000???!! ??????  ",description:"offer2",linkUrl:"http://www.kafunsho.sg/kafunsho/?aff_id=fstofz&chan=kfs3",imageUrl:"http://www.imageurlhost.com/images/gmcrq0qr9le3x0vi653f.jpg",htmlTemplate:"",htmlScript:null}]},t}();t.CampaignsApi=n}(t=e.Data||(e.Data={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n;!function(t){var n=function(){function t(){}return t.prototype.supportsStickyClassification=function(){return!1},t.prototype.dataKey=function(){return"Campaigns"},t.prototype.flag=function(){return"cmp"},t.prototype.classify=function(n){var o=this;if(window.FO_CAMPAIGN_TEST)return this.forUrl="localhost",e.Common.toNamedPromise("test",e.Common.resolve(1));var r=n.paths().dynamicContentRoot()+"/cmpn/wl",i=t.breakUrlIntoComponents(document.location.protocol+"//"+document.location.host,document.location.pathname),a=e.Common.BlackWhiteListHelper.blackWhiteMatch(i,r,null,null).then(function(e){return o.forUrl=i[0],e.score}).alwaysThen(function(e,t){return t?-1:e});return e.Common.toNamedPromise("Campaign bwl",a)},t.prototype.scrapeAndObtainData=function(t,n,o){var r=this,i=e.Data.CampaignsApi.queryApi(t,4,this.forUrl),a=i.then(function(n){r.apiResult=n;var o=e.Data.CampaignsApi.campaignsFromCampaignOffers(r.apiResult);return new e.Data.PlainDataResult("api",t,o)});return a},t.breakUrlIntoComponents=function(e,t){var n=e.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);null!=n&&n.length>2&&"string"==typeof n[2]&&n[2].length>0&&(e=n[2]);var o=[e];return o},t}();t.CampaignsLogic=n}(n=t.Logic||(t.Logic={}))}(t=e.Products||(e.Products={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(e){function n(n,o){e.call(this),this.offers=[];var i=t.Common.Col.select(o,function(e){return new r(n,e)});this.offers=i,this.context=n}return __extends(n,e),n}(n.ModelBase);n.CouponsModel=o;var r=function(n){function o(t,o){n.call(this,t,o),this.isRevealed=e.ko.observable(!1),this.isRevealed(o.revealed)}return __extends(o,n),o.prototype.onClick=function(n,o){if(o&&o.preventDefault(),n.clickNotified||(n.clickNotified=!0,t.Logger.Analytics.notify(n.context,t.Logger.Analytics.CLICK,{p:n.offer.part}),n.offer.onClick&&n.offer.onClick()),n.offer.isDirect)n.windowOpen(n.url,"_blank"),t.Common.CouponsHelper.setCouponRevealed(""),t.Common.CouponsHelper.setCouponAppliedMessage(n.offer.code,n.offer.title);else if(!n.offer.revealed){var r=e.$('<iframe width="0" height="0"></iframe>');r.attr("src",n.url),t.Common.VisualHelper.appendToBody(r),t.Common.CouponsHelper.setCouponRevealed(n.offer.code),t.Common.CouponsHelper.setCouponRevealedMessage(n.offer.code,n.offer.title),n.isRevealed(!0)}},o}(n.GenericOfferModel);n.CouponModel=r}(n=t.Model||(t.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(e){function n(n,o){e.call(this),this.offers=[];var i=t.Common.Col.select(o,function(e){return new r(n,e)});this.offers=i,this.context=n}return __extends(n,e),n}(n.ModelBase);n.CampaignsModel=o;var r=function(n){function o(t,o){n.call(this,t,o),this.isRevealed=e.ko.observable(!1),o.actionBtnTitle||(o.actionBtnTitle="Read More")}return __extends(o,n),o.prototype.getOpenTarget=function(){return"_self"},o.prototype.onClick=function(e,n){if(n&&n.preventDefault(),!e.clickNotified){e.clickNotified=!0;var o={};e.offer.accountTitle&&(o.acttl=e.offer.accountTitle),e.offer.campaignTitle&&(o.cmpnttl=e.offer.campaignTitle),e.offer.price&&(o.prc=e.offer.price),e.offer.begrp&&(o.begrp=e.offer.begrp),t.Logger.Analytics.notify(e.context,t.Logger.Analytics.CLICK,o),e.offer.onClick&&e.offer.onClick()}var r=window.open(e.url);r.focus()},o}(n.GenericOfferModel);n.CampaignModel=r}(n=t.Model||(t.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(o){function r(r,i,a,s,u,l,c,d,f,p,m){var h=this;void 0===f&&(f=function(){}),void 0===p&&(p=null),void 0===m&&(m=null),o.call(this,r,l,c,f),this.hasDeals=e.ko.computed(function(){return h.deals&&h.deals.offers.length}),this.hasCoupons=e.ko.computed(function(){return h.coupons&&h.coupons.offers.length}),this.dealScroll=e.ko.computed(function(){return h.deals&&h.deals.offers.length>4}),this.couponScroll=e.ko.computed(function(){return h.coupons&&h.coupons.offers.length>4}),this.selectedTab=e.ko.observable(0),this.dealsDisplayed=!1,this.couponsDisplayed=!1,this.campaignsDisplayed=!1,this.revealedCoupons=e.ko.observable(0),this.couponsMessage=null,this.deals=i?new n.DealsModel(a,i):new n.DealsModel(null,[]),this.coupons=s?new n.CouponsModel(u,s):new n.CouponsModel(null,[]),this.campaigns=p?new n.CampaignsModel(m,p):new n.CampaignsModel(null,[]),this.setPanelVisibilityAndBadges(this.deals,this.coupons,this.campaigns,d),this.setMoreDealsTarget(this.deals),this.setRevealedCoupons(this.coupons),this.setBadgePlacements(this.deals,this.coupons,this.campaigns),this.strings=t.Common.LocaleHelper.getStringMapForCountry(r.countryCode(),t.Locale.sliderStrings)}return __extends(r,o),r.prototype.setBadgePlacements=function(e,t,n){var o=93,r=95;t&&t.offers.length&&(t.cssBadgeTop=o+"px",o+=r),n&&n.offers.length&&(n.cssBadgeTop=o+"px",o+=r),e&&e.offers.length&&(e.cssBadgeTop=o+"px")},r.prototype.setPanelVisibilityAndBadges=function(e,n,o,r){var i=-1;if(n&&n.offers.length){var a=t.Common.CouponsHelper.pollCouponsMessage();(a||r)&&(i=1,this.couponsMessage=a)}if(o&&o.offers.length&&-1==i)i=2;else if(e&&e.offers.length&&-1==i)i=0;else if(n&&n.offers.length&&-1==i)i=1;else if(-1==i)throw new Error("Neither Deals, Coupons or Campaigns provided");this.selectTab(i,!1)},r.prototype.setMoreDealsTarget=function(e){e.offers.length?this.moreDealsUrl="http://bestdealwiz.com/productlist.html?q="+e.offers[0].offer.keywords.split(" ").join("+"):this.moreDealsUrl="http://bestdealwiz.com/index.html"},r.prototype.setRevealedCoupons=function(e){this.revealedCoupons(t.Common.Col.count(e.offers,function(e){return e.offer.revealed}))},r.prototype.selectTab=function(e,n){void 0===n&&(n=!0),this.selectedTab(e),n&&this.collapsed(!1),0!=e||this.dealsDisplayed||(this.dealsDisplayed=!0,t.Logger.Analytics.notify(this.deals.context,t.Logger.Analytics.IMPRESSION,{kwds:this.deals.offers[0].offer.keywords})),1!=e||this.couponsDisplayed||(this.couponsDisplayed=!0,t.Logger.Analytics.notify(this.coupons.context,t.Logger.Analytics.IMPRESSION)),2!=e||this.campaignsDisplayed||(this.campaignsDisplayed=!0,t.Logger.Analytics.notify(this.campaigns.context,t.Logger.Analytics.IMPRESSION))},r}(n.ProductModelBase);n.DualCommerceModel=o}(n=t.Model||(t.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(){this.element=null}return n.prototype.realEstate=function(){throw new Error("Not implemented")},n.prototype.flag=function(){throw new Error("Not implemented")},n.prototype.determineNeededItemCount=function(e){throw new Error("Not implemented")},n.prototype.declareResourcesPromise=function(e){throw new Error("Not implemented")},n.prototype.declareDisplayHandlers=function(e){throw new Error("Not implemented")},n.prototype.getOldSuspensionIdentifer=function(){throw new Error("Not implemented")},n.prototype.getMainCssClass=function(){throw new Error("Not implemented")},n.prototype.getParentElement=function(){return document.documentElement.getElementsByTagName("body")[0]},n.prototype.draw=function(e,n,o){var r=n.CommerceDeals,i=r?r.data:null,a=r?r.context:null,s=n.Coupons,u=s?s.data:null,l=s?s.context:null,c=document.location.protocol+"//"+document.location.host+document.location.pathname,d=s?c==s.extras.rootCouponsUrl||c==s.extras.rootCouponsUrl+"/":!1,f=n.Campaigns,p=f?f.data:null,m=f?f.context:null,h=o.html,g=this.getMainCssClass(),v=this.declareDisplayHandlers(a||l||m),y=function(){return t.Common.Col.of(v).each(function(e){return e.remove&&e.remove()})},C=this.getParentElement(),b=t.Products.VisualRealEstate[this.realEstate()],w=this.getOldSuspensionIdentifer(),_=new t.Model.DualCommerceModel(a||l||m,i,a,u,l,b,w,d,y,p,m);return this.element=t.Common.VisualHelper.createAndBindDisplay(h,g,_,v,C),t.Common.resolve(this.element)},n.prototype.remove=function(t){e.$(this.element).remove()},n}();n.DualSliderVisualBase=o}(n=t.ExternalProducts||(t.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.afterRender=function(e){e.find(".elps").dotdotdot()},e}();e.EllipsisHandler=t}(t=e.DisplayHandlers||(e.DisplayHandlers={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(t){var n=function(){function t(){}return t.prototype.afterRender=function(n){e.$("body").click(function(e){return t.closeSuspendBox(e,n)}),n.click(function(e){return t.closeSuspendBox(e,n)}),n.find(".fo-suspend").click(function(e){return t.openSuspendBox(e,n)})},t.openSuspendBox=function(e,t){t.find(".fo-suspend-tooltip").addClass("shown"),e.stopPropagation()},t.closeSuspendBox=function(t,n){var o=e.$(t.target).closest(".fo-suspend-tooltip").length>0;o||n.find(".fo-suspend-tooltip").removeClass("shown")},t}();t.SuspendBoxHandler=n}(n=t.DisplayHandlers||(t.DisplayHandlers={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(e){this.mouseOverElement=!1,this.cleanup=[];var t=e.overrides().boolValue("rightslider.scroll-sync",!0),n=e.overrides().boolValue("rightslider.scroll-arrows",!0),o=e.overrides().intValue("rightslider.scroll-auto",6e3),r=e.overrides().boolValue("rightslider.scroll-independent",!0),i=e.overrides().boolValue("rightslider.scroll-peekaboo",!1),a=["fo-deals-tab","fo-coupons-tab"];this.tabClasses=a,this.syncToPage=t,this.autoScroll=o,this.scrollIndepandent=r,this.peekaboo=i,this.scrollArrows=n,this.directionalHelper={lengthFn:function(e){return e.height()},positionProperty:"margin-top"}}return n.prototype.afterRender=function(e){var o=this;t.Common.Col.of(o.tabClasses).each(function(t){{var r=e.find("."+t);n.scrollTabToIndex(o,r,0)}}),e.hover(function(){return o.mouseOverElement=!0},function(){return o.mouseOverElement=!1}),this.syncToPage&&this.setupSyncToPage(e),this.scrollArrows&&this.setupScrollArrows(e),this.autoScroll&&this.setupAutoScroll(e),this.scrollIndepandent&&this.setupIndependentScroll(e),this.peekaboo&&this.setupPeekaboo(e)},n.prototype.remove=function(){t.Common.Col.each(this.cleanup,function(e){return e()})},n.prototype.setupSyncToPage=function(t){var o=this;n.syncScrollToPage(o,t);var r=function(){return n.syncScrollToPage(o,t)};e.$(window).scroll(r),o.cleanup.push(function(){return e.$(window).off("scroll",r)})},n.prototype.setupScrollArrows=function(t){var o=this;t.find(".fo-scroll-btn").each(function(t,r){e.$(r).click(function(t){var r=e.$(t.target),i=r.closest(".fo-tab"),a=parseInt(r.attr(" data-scroll-step"));n.scrollTabByStep(o,i,a)})})},n.prototype.setupAutoScroll=function(e){var o=this,r=window.setInterval(function(){o.mouseOverElement||t.Common.Col.of(o.tabClasses).each(function(t){var r=e.find("."+t),i=r.data("fo-current-scroll-index"),a=n.scrollTabToIndex(o,r,i+1,"slow");a||n.scrollTabToIndex(o,r,0,"slow")})},this.autoScroll);o.cleanup.push(function(){return clearInterval(r)})},n.prototype.setupIndependentScroll=function(o){var r=this,i=function(e){if(r.mouseOverElement){e.preventDefault(),e.cancelBubble=!0,e.stopPropagation();var i=e.originalEvent.wheelDeltaY<0?1:-1;t.Common.Col.of(r.tabClasses).each(function(e){var t=o.find("."+e),a=t.data("fo-current-scroll-index");n.scrollTabToIndex(r,t,a+i,"fast")})}};e.$(window).on("mousewheel",i),r.cleanup.push(function(){return e.$(window).off("mousewheel",i)})},n.prototype.setupPeekaboo=function(e){var o=this;t.Common.Col.of(o.tabClasses).each(function(t){var r=e.find("."+t);n.scrollTabToIndex(o,r,1,"slow"),window.setTimeout(function(){return n.scrollTabToIndex(o,r,0,"slow")},1500)})},n.syncScrollToPage=function(e,o){t.Common.Col.of(e.tabClasses).each(function(t){var r=o.find("."+t);n.syncTabScrollToPage(e,r)})},n.syncTabScrollToPage=function(t,o){var r=e.$(document).height(),i=e.$(window).scrollTop(),a=i/r,s=o.find(".fo-list li"),u=Math.round(s.length*a);n.scrollTabToIndex(t,o,u)},n.scrollTabToIndex=function(e,t,n,o){void 0===o&&(o="fast");var r=t.find(".fo-list"),i=r.find("li"),a=e.directionalHelper.lengthFn(r),s=(a+8)/i.length,u=e.directionalHelper.lengthFn(t.find(".fo-list-wrapper")),l=Math.round(u/s);if(n>=0&&n<=i.length-l){var c=t.data("fo-current-scroll-index");if(n!=c){var d=n*s,f={};return f[e.directionalHelper.positionProperty]="-"+d+"px",r.stop(),r.animate(f,o),t.data("fo-current-scroll-index",n),t.find(".fo-scroll-up").toggleClass("fo-active",n>0),t.find(".fo-scroll-down").toggleClass("fo-active",n<i.length-l),!0}}return!1},n.scrollTabByStep=function(e,t,o){var r=t.data("fo-current-scroll-index");n.scrollTabToIndex(e,t,r+o)},n}();n.ScrollHandler=o}(n=t.DisplayHandlers||(t.DisplayHandlers={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.afterRender=function(t){var n=t.find(".fo-code-slide-text");n.click(function(t){e.selectText(t.target)})},e.selectText=function(e){var t=document.body;if(window.getSelection){var n=window.getSelection(),o=document.createRange();o.selectNodeContents(e),n.removeAllRanges(),n.addRange(o)}else if(t.createTextRange){var r=t.createTextRange();r.moveToElementText(e),r.select()}},e}();e.CouponTextSelectHandler=t}(t=e.DisplayHandlers||(e.DisplayHandlers={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.realEstate=function(){return 1},n.prototype.flag=function(){return"rs-dual"},n.prototype.getOldSuspensionIdentifer=function(){return"foss"},n.prototype.getMainCssClass=function(){return"fo-right-slider"},n.prototype.determineNeededItemCount=function(t){var n=t.overrides().boolValue("rightslider.use-scroller",!0),o=n?8:0;return new e.Products.ItemCounts(4,o)},n.prototype.declareResourcesPromise=function(t){return{reset2_css:e.Common.Res.injectCss2(t.paths().innerResourcesRoot()+"/Visual/reset.css"),panel_css:e.Common.Res.injectCss2(t.paths().innerResourcesRoot()+"/Visual/New/rightSlider.css"),html:e.Common.Res.bring(t.paths().innerResourcesRoot()+"/Visual/New/panel.html")}},n.prototype.declareDisplayHandlers=function(t){return[new e.DisplayHandlers.EllipsisHandler,new e.DisplayHandlers.SuspendBoxHandler,new e.DisplayHandlers.CouponTextSelectHandler,new e.DisplayHandlers.ScrollHandler(t)]},n}(t.DualSliderVisualBase);t.DualRightSliderVisual=n}(t=e.ExternalProducts||(e.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.realEstate=function(){return 3},n.prototype.flag=function(){return"bs-dual"},n.prototype.getOldSuspensionIdentifer=function(){return"fobs"},n.prototype.getMainCssClass=function(){return"fo-bottom-slider dual-slider"},n.prototype.determineNeededItemCount=function(t){return new e.Products.ItemCounts(4,0)},n.prototype.declareResourcesPromise=function(t){return{reset2_css:e.Common.Res.injectCss2(t.paths().innerResourcesRoot()+"/Visual/reset.css"),icons_css:e.Common.Res.injectCss2(t.paths().innerResourcesRoot()+"/Visual/foicons.css"),panel_css:e.Common.Res.injectCss2(t.paths().innerResourcesRoot()+"/Visual/dualBottomSlider.css"),fa_css:e.Common.Res.injectCss2("//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"),html:e.Common.Res.bring(t.paths().innerResourcesRoot()+"/Visual/dualBottomSlider.html")}},n.prototype.declareDisplayHandlers=function(t){return[new e.DisplayHandlers.EllipsisHandler,new e.DisplayHandlers.SuspendBoxHandler]},n}(t.DualSliderVisualBase);t.DualBottomSliderVisual=n}(t=e.ExternalProducts||(e.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(){}return t.classifyByBlackWhiteList=function(t){var n=e.Common.BlackWhiteListHelper.breakdownHost();return e.Common.BlackWhiteListHelper.blackWhiteMatch(n,t.paths().innerResourcesRoot()+"/TravelWhiteList.json",null,null).then(function(e){return{name:"travelBlackWhite",value:e.score}})},t}();t.TravelHelper=n}(t=e.Vertical||(e.Vertical={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(){}return t.prototype.supportsStickyClassification=function(){return!1},t.prototype.dataKey=function(){return"ETBOffers"},t.prototype.flag=function(){return"etb"},t.prototype.classify=function(t){var n="etb_"+this.flag(),o=t.params().partnerCode+(t.params().subId?"_"+t.params().subId:""),r=e.Common.generateUUID();t.pushNotificationParam("strandid",r);var i=e.Logger.Analytics.resolveUrl(t,"generic",{subtype:"landing"}),a="//cond01.etbxml.com/api/web/hotels.php?mamId="+o+"&userId=2222&appId=3333&ui=1&ns="+n+"&partner=firstoffer&sp=false&sh=false&apps=Targeted&amu=280828404&showWidget=true&post_div=fo&rsi="+encodeURIComponent(i);return e.Vertical.TravelHelper.classifyByBlackWhiteList(t).then(function(t){return t.value>0?e.Common.Res.injectScript(a).then(function(){if(window[n]&&window[n].appsList){if(0==window[n].appsList().length)return e.Common.resolve({name:"etb-no-apps",value:-1});var t=e.Common.Col.contains(window[n].appsList(),"Targeted");return t?e.Common.waitFor(function(){return window[n+"_Targeted"]},5e3,100).alwaysThen(function(e,t){return e&&e.length?-1==e[0].price?{name:"etb-minus-price",value:-1}:{name:"etb-targeted-found",value:1}:{name:"etb-targeted-missing",value:-1}}):e.Common.resolve({name:"etb-targeted-missing",value:-1})}return e.Logger.warn("ETB apps function not in place. Cancelling ETB load"),e.Common.resolve({name:"etb-missing-applist",value:-1})}):e.Common.resolve({name:"etb-no-apps",value:-1})})},t.prototype.scrapeAndObtainData=function(t,n,o){var r=new e.Data.StubDataResult("etb",t);return e.Common.resolve(r)},t}();t.ETBButtonLogic=n}(t=e.ExternalProducts||(e.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(n){function o(e,o,r){n.call(this,e,o,r),this.strings=t.Common.LocaleHelper.getStringMapForCountry(e.countryCode(),t.Locale.sliderStrings)}return __extends(o,n),o.prototype.blockPropagation=function(e,t){return!0},o.prototype.hide=function(){e.$(".w_t_close").click(),this.hidden(!0),t.Common.RealEstateHelper.releaseRealestate(this.suspendIdentifier)},o}(n.ProductModelBase);n.ComplianceOnlyModel=o}(n=t.Model||(t.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(){this.element=null}return n.prototype.realEstate=function(){return 4},n.prototype.flag=function(){return"etbbutton"},n.prototype.determineNeededItemCount=function(e){return new t.Products.ItemCounts(0,0)},n.prototype.declareResourcesPromise=function(e){return{html:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Visual/complianceOnly.html"),panel_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/complianceOnly.css"),fa_css:t.Common.Res.injectCss2("//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css")}},n.prototype.draw=function(n,o,r){var i=t.Products.VisualRealEstate[this.realEstate()],a=o.ETBOffers.context,s=new t.Model.ComplianceOnlyModel(a,i,"mtbl");return t.Common.waitFor(function(){return e.$(".fo_wrapper").length?e.$(".fo_wrapper"):null},1e4).then(function(n){t.Logger.log("ETB widget found");var o=r.html,i="fo-compliance-only dual-slider",u=e.$(o).addClass(i);n.append(u);var l=n.find("a");l.click(function(){t.Logger.Analytics.notify(a,t.Logger.Analytics.CLICK)});try{e.ko.setTemplateEngine(new e.ko.nativeTemplateEngine),e.ko.applyBindings(s,u[0]),t.Logger.Analytics.notify(a,t.Logger.Analytics.IMPRESSION)}catch(c){throw e.$(u).remove(),c}}).fail(function(e){return t.Logger.error("Failed finding ETB widget: "+e.message)})},n.prototype.remove=function(e){t.Logger.error("ETB BUTTON REMOVE NOT IMPLEMENTED")},n}();n.ETBButtonVisual=o}(n=t.ExternalProducts||(t.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(){}return t.classifyByBlackWhiteList=function(t){var n=t.paths().blackWhiteListRoot()+"/searchma/",o=e.Common.BlackWhiteListHelper.breakdownHost();return e.Common.BlackWhiteListHelper.blackWhiteMatch(o,t.paths().dynamicContentRoot()+"/bwl/wlm",null,n).then(function(e){return e.score})},t.blackRegex=/tube|lazada|shopzilla.|beso.|kelkoo.|orange.|clickjogos|gameforge|pole-emploi|infojobs|snap.do|(stockinvestingbasics|allmyvideos|laposte|megafilmeshd|vidspot).net|(collectivites|sweet|jeux|voila|bilansgratuits|habbol|vente).fr|(abril|terra|ig|blogspot|hotelurbano|uol).com.br|www.easymobility.co.uk|gov.br|wikipedia.org|(pricegrabber|spardeingeld|snapdo|speedbit|loopnet|stackoverflow|stackexchange|hulu|bloomberg|blogger|dartybox|alexa|baidu|cj|cnn|facebook|flickr|history|hotmail|imdb|imvu|linkedin|microsoft|msn|myspace|netflix|nytimes|politico|picasa|pinterest|rue89|salon|searchenginewatch|delta-search|sfgate|shutterfly|techcrunch|verizon|venturebeat|wired|yankodesign|yahoo|youtube|bing|vk|live|tumblr|ask|apple|roblox|411answers|tagged|nickjr|opposingviews|truste|adobe|breakfastdailynews|.avg|espn.go|.aol|pogo|pornhub|youporn|pron|youjizz|xnxx|marca|elpais|juegos|surveysresearchgroup|dofus|adopteunmec|unique|22find|nationzoom|sncf|privee|awesomehp|updateflashplayer|stocktradingcenters|empowernetwork|regionalhealthreview|diyfood|websurveycentral|\.att|news788|411source|pandora|hsselite|verizonwireless|internetautoguide|symantec|\.pch|mobile|nortonpro|pchealthboost|voipo|contenko|seaworldparks|entrepreneur|ratezip|game321|boostmobile|cabelas|specialk|globo|yepi|jogatina|4shared|globo|ojogos|tudogostoso|netcartas|disney|voeazul|cartoonnetwork|\.tam|viajanet|vagalume|jogosdemeninas|^as|\.as|atrapalo|elconfidencial|lavanguardia|forocoches|peliculasyonkis|logitravel|freakshare|elperiodico|iberia|filmaffinity|chaturbate|expansion|todotest|antena3|cincodias).com|(elmundo|rtve|lavozdegalicia|sport|publico|game|online|eldiariomontanes|elcomercio|\.hoy|\.abc|telepizza|europapress).es|paypal|cam4|888poker|filmesonlinegratis|google|.gov|qvo6|cam4|surveyservers|ask.fm|games.la|jeu.info/i,t}();t.MatureHelper=n}(t=e.Vertical||(e.Vertical={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(){}return t.prototype.flag=function(){return"ppm"},t.prototype.dataKey=function(){return"MatureDeals"},t.prototype.supportsStickyClassification=function(){return!1},t.prototype.classify=function(t){return e.Common.namedWaterfall([{name:"mwl",value:function(){return e.Vertical.MatureHelper.classifyByBlackWhiteList(t)}}],function(e){return 0!=e}).alwaysThen(function(e,t){return t?{name:t.message,value:0}:e})},t.prototype.scrapeAndObtainData=function(t,n,o){var r=this.queryFromPageOrDedicated(t),i=r.then(function(o){return e.Data.OffersApi.queryApi(t,n.totalCount(),"mature",o)});return i.then(function(n){var o=e.Data.OffersApi.dealsFromOffers(t,n);return new e.Data.PlainDataResult("mature-api",t,o)})},t.prototype.queryFromPageOrDedicated=function(t){var n=this,o=window.location.host,r=e.Common.DedicatedHelper.tryScrpaePageByDedicated(o,t);return r.alwaysThen(function(o,r){var i={wordCounts:e.Common.Map.emptyMap(),price:0,source:null};if(o&&n.dedicatedLooksValid(o))e.Logger.info("Using dedicated"),i.wordCounts=o.wordCounts,i.price=o.clientPrice,i.source="dedicated";else{var a=t.overrides().boolValue("scrapping.use",!1);a?(i.wordCounts=n.genericScrape(t),i.price=0,i.source="generic-scrape"):(i.wordCounts=e.Common.Map.ofHash({ktjsg8fsdhfs:1}),i.price=0,i.source="fallback-query")}return e.Data.OffersApi.queryFromData(t,i)})},t.prototype.dedicatedLooksValid=function(t){var n=t.wordCounts.length()>1;return n||e.Logger.warn("Dedicated result too small. Will ignore: "+JSON3.stringify(t)),n},t.prototype.genericScrape=function(t){var n=new e.Common.WordCounter,o=e.Common.ImageUtils.getLargestImageText();if(o){var r=e.Common.WordUtils.getNonTrivialWords(o);n.push(r,"Product Image",10)}var i=["search","here","keyword","keywords","product","products","username","email","password","enter"],a=["q","Search","search","searchterm","searchTerm","search_query","query","Keywords","keywords","field-keywords","w","kw","origkw","SearchString","searchString","keys","text","Ntt","qu","Keyword","keyword","SearchTerms","searchTerms"],s=document.querySelectorAll("input[type='search']"),u=e.Common.Col.select(e.Common.Col.numValues(s),function(e){return e.value}).join(" "),l=e.Common.WordUtils.getNonTrivialWords(u);0==e.Common.Col.intersect(l,i).length&&n.push(l,"Search inputs",8);var c=t.scraper().getFirstMatchText(["h1"]),d=e.Common.WordUtils.getNonTrivialWords(c);n.push(d,"H1",6);var f=e.Common.WordUtils.getNonTrivialWords(document.title);n.push(f,"Title",6);var p=document.querySelectorAll("input[type='text']"),m=e.Common.Col.select(e.Common.Col.numValues(p),function(e){return e.value}).join(" "),h=e.Common.WordUtils.getNonTrivialWords(m);0==e.Common.Col.intersect(h,i).length&&n.push(h,"Text inputs",1);var g=[],v=[];for(var y in t.scraper().queryParams())e.Common.Col.contains(a,y)?g.push(t.scraper().queryParams()[y]):v.push(t.scraper().queryParams()[y]);n.push(g,"Recognized query string",20),n.push(v,"Unknown query string",1);var C=t.overrides().boolValue("deals-logic.filter-empty-words",!0),b=e.Common.Col.where(n.getWords(),function(e){return C?!e.match(/^[\s]*$/):!e.match(/^[\W_]*$/)}),w=e.Common.WordUtils.countWords(b);return w},t}();t.MatureDealsLogic=n}(t=e.ExternalProducts||(e.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(n){function o(o,r,i,a){n.call(this,o,i,a),this.strings=e.Common.LocaleHelper.getStringMapForCountry(o.countryCode(),e.Locale.sliderStrings),
this.deals=new t.DealsModel(o,r),"rightcoupon"==o.params().providerName.toLowerCase()&&(this.providerName="PinkLady",this.providerLink="http://kellystoys.com")}return __extends(o,n),o}(t.ProductModelBase);t.MatureDealsModel=n}(t=e.Model||(e.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(){this.element=null}return n.prototype.realEstate=function(){return 1},n.prototype.flag=function(){return"rs-mature"},n.prototype.determineNeededItemCount=function(e){return new t.Products.ItemCounts(4,0)},n.prototype.declareResourcesPromise=function(e){return{reset2_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/reset.css"),icons_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/foicons.css"),panel_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/matureRightSlider.css"),fa_css:t.Common.Res.injectCss2("//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"),html:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Visual/matureRightSlider.html")}},n.prototype.draw=function(n,o,r){var i=o.MatureDeals,a=i?i.data:null,s=i?i.context:null,u=r.html,l="fo-right-slider mature-slider",c=e.$(u).addClass(l);t.Common.CollisionHelper.treatForCollisions(c),t.Common.VisualHelper.appendToBody(c),this.element=c[0];var d=t.Products.VisualRealEstate[this.realEstate()],f=this.getOldSuspensionIdentifer(),p=new t.Model.MatureDealsModel(s,a,d,f);try{e.ko.setTemplateEngine(new e.ko.nativeTemplateEngine),e.ko.applyBindings(p,this.element),t.Logger.Analytics.notify(s,t.Logger.Analytics.IMPRESSION,{kwds:a[0].keywords})}catch(m){throw e.$(this.element).remove(),m}return t.Common.resolve(null)},n.prototype.getOldSuspensionIdentifer=function(){return"foss"},n.prototype.remove=function(t){e.$(this.element).remove()},n}();n.MatureRightSliderVisual=o}(n=t.ExternalProducts||(t.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(e){this.cssUrl=e}return n.prototype.afterRender=function(e){t.Common.Res.injectCss2(this.cssUrl)},n.prototype.remove=function(){e.$("link[rel='stylesheet'][href='"+this.cssUrl+"']").prop("disabled",!0)},n}();n.TransiantCSSHandler=o}(n=t.DisplayHandlers||(t.DisplayHandlers={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(n){function o(){n.apply(this,arguments)}return __extends(o,n),o.prototype.realEstate=function(){return 2},o.prototype.flag=function(){return"tb-dual"},o.prototype.getOldSuspensionIdentifer=function(){return"fotb"},o.prototype.getMainCssClass=function(){return"fo-top-bar"},o.prototype.determineNeededItemCount=function(e){return new t.Products.ItemCounts(7,0)},o.prototype.declareResourcesPromise=function(e){return{reset2_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/reset.css"),panel_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/New/topBar.css"),push_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/New/topBarPushBody.css"),html:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Visual/New/panel.html")}},o.prototype.declareDisplayHandlers=function(e){var n=e.paths().innerResourcesRoot()+"/Visual/New/topBarPushBody.css";return[new t.DisplayHandlers.EllipsisHandler,new t.DisplayHandlers.SuspendBoxHandler,new t.DisplayHandlers.CouponTextSelectHandler,new t.DisplayHandlers.TransiantCSSHandler(n)]},o.prototype.remove=function(t){n.prototype.remove.call(this,t);var o=t.paths().innerResourcesRoot()+"/Visual/New/topBarPushBody.css";e.$("link[rel='stylesheet'][href='"+o+"']").prop("disabled",!0)},o}(n.DualSliderVisualBase);n.OldTopBarVisual=o}(n=t.ExternalProducts||(t.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.realEstate=function(){return 2},n.prototype.flag=function(){return"tb-dual"},n.prototype.getOldSuspensionIdentifer=function(){return"fotb"},n.prototype.getMainCssClass=function(){return"fo-top-bar"},n.prototype.determineNeededItemCount=function(t){return new e.Products.ItemCounts(7,0)},n.prototype.declareResourcesPromise=function(t){return{reset2_css:e.Common.Res.injectCss2(t.paths().innerResourcesRoot()+"/Visual/reset.css"),panel_css:e.Common.Res.injectCss2(t.paths().innerResourcesRoot()+"/Visual/New/topSlider.css"),html:e.Common.Res.bring(t.paths().innerResourcesRoot()+"/Visual/New/panel.html")}},n.prototype.declareDisplayHandlers=function(t){return[new e.DisplayHandlers.EllipsisHandler,new e.DisplayHandlers.SuspendBoxHandler,new e.DisplayHandlers.CouponTextSelectHandler]},n}(t.DualSliderVisualBase);t.OldTopSliderVisual=n}(t=e.ExternalProducts||(e.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function n(){}return n.matchToLocation=function(t){var o=n.searchEngineConfigs.first(function(e){return e.validateLocation(t)});return null==o&&e.Logger.log("Didnt match any search engine!"),o},n.googleConfig={name:"Google",validateLocation:function(e){var t=0==e.host.indexOf("www.google."),n=""==e.pathname||"/"==e.pathname||"/search"==e.pathname||"/webhp"==e.pathname;return t&&n},queryKey:"q",getParentElement:function(){return document.getElementById("rcnt")||document.getElementById("appbar")},cssName:"googleSearchBar"},n.bingConfig={name:"Bing",validateLocation:function(e){var t=0==e.host.indexOf("www.bing."),n=e.pathname.indexOf("/search")==e.pathname.length-6-1;return t&&n},queryKey:"q",getParentElement:function(){return document.getElementById("vm_res")||document.getElementById("b_content")||document.getElementsByClassName("Content").length&&document.getElementsByClassName("Content")[0]},cssName:"bingSearchBar"},n.yahooConfig={name:"Yahoo",validateLocation:function(e){var t=e.host.indexOf("search.yahoo.")>=0,n=0==e.pathname.indexOf("/search");return t&&n},queryKey:"p",getParentElement:function(){var e=document.getElementById("results"),t=document.getElementById("bd");return e&&"section"==e.tagName.toLowerCase()?e:t&&"document"==t.getAttribute("role")?t:null},cssName:"yahooSearchBar"},n.askConfig={name:"Ask",validateLocation:function(e){var n="www.ask.com"==e.hostname,o=t.Col.contains(["/web","/pictures","/news","/youtube","/shopping"],e.pathname);return n&&o},queryKey:"q",getParentElement:function(){return document.getElementById("mrRSM")||document.getElementById("csaTop")},cssName:"askSearchBar"},n.aolConfig={name:"AOL",validateLocation:function(e){return 0==e.hostname.indexOf("search.aol.")},queryKey:"q",getParentElement:function(){return document.getElementById("c")},cssName:"aolSearchBar"},n.searchEngineConfigs=t.Col.of([n.askConfig]),n}();t.SearchEngines=n}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=e.Common.Map,o=function(){function t(){}return t.prototype.flag=function(){return"sk"},t.prototype.dataKey=function(){return"CommerceDeals"},t.prototype.supportsStickyClassification=function(){return!1},t.extractQuery=function(e){var t=document.location.hash.length>0?document.location.hash.substr(1):"",o=document.location.search.length>0?document.location.search.substr(1):"",r=n.ofUrlString(t),i=n.ofUrlString(o),a=r.get(e),s=i.get(e),u=a||s;return u?u.split(/[ +]/):[]},t.prototype.classify=function(t){var n=e.Common.SearchEngines.matchToLocation(document.location),o=null;return o=n?n.getParentElement()?e.Common.toNamed("wl",2):e.Common.toNamed("missing_element",-1):e.Common.toNamed("no_sec",-1),e.Common.resolve(o)},t.prototype.scrapeAndObtainData=function(n,o,r){var i=e.Common.SearchEngines.matchToLocation(document.location),a=i?t.extractQuery(i.queryKey):[];if(a&&a.length){var s=e.Data.OffersApi.queryFromGenericKeywords(a),u=e.Data.OffersApi.queryApi(n,o.totalCount(),t.SEARCH_CONTEXT_ADDITION,s),l=u.then(function(t){var o=e.Data.OffersApi.dealsFromOffers(n,t);return new e.Data.PlainDataResult("api",n,o)});return l}var c=new e.Data.PlainDataResult("noquery",n,[]);return e.Common.resolve(c)},t.SEARCH_CONTEXT_ADDITION="search",t}();t.SearchKeywordsLogic=o}(t=e.ExternalProducts||(e.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.realEstate=function(){return 10},n.prototype.flag=function(){return"sb-dual"},n.prototype.getOldSuspensionIdentifer=function(){return"fosb"},n.prototype.getMainCssClass=function(){return"fo-search-bar"},n.prototype.getParentElement=function(){var t=e.Common.SearchEngines.matchToLocation(document.location);return t&&t.getParentElement()},n.prototype.determineNeededItemCount=function(t){return new e.Products.ItemCounts(4,3)},n.prototype.declareResourcesPromise=function(t){var n=e.Common.SearchEngines.matchToLocation(document.location),o=t.overrides().boolValue("searchbar.limited",!0),r={reset2_css:e.Common.Res.injectCss2(t.paths().innerResourcesRoot()+"/Visual/reset.css"),html:e.Common.Res.bring(t.paths().innerResourcesRoot()+"/Visual/New/panel.html")};return n&&n.cssName&&(r.panel_css=e.Common.Res.injectCss2(t.paths().innerResourcesRoot()+"/Visual/New/"+n.cssName+".css")),o&&(r.limit_css=e.Common.Res.injectCss2(t.paths().innerResourcesRoot()+"/Visual/New/limitedSearchBar.css")),r},n.prototype.declareDisplayHandlers=function(t){return[new e.DisplayHandlers.EllipsisHandler,new e.DisplayHandlers.SuspendBoxHandler,new e.DisplayHandlers.CouponTextSelectHandler]},n}(t.DualSliderVisualBase);t.OldSearchBarVisual=n}(t=e.ExternalProducts||(e.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(){this.element=null}return n.prototype.realEstate=function(){return 1},n.prototype.flag=function(){return"rsif"},n.prototype.determineNeededItemCount=function(e){var n=e.overrides().boolValue("rightslider.use-scroller",!0),o=n?8:0;return new t.Products.ItemCounts(4,o)},n.prototype.declareResourcesPromise=function(e){return{reset2_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/reset.css"),panel_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/New/iframeRightSlider.css"),html:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Visual/New/panel.html"),container:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Visual/New/container.html")}},n.prototype.getOldSuspensionIdentifer=function(){return"foss"},n.prototype.getMainCssClass=function(){return"fo-iframe-right-slider"},n.prototype.getParentElement=function(){return document.documentElement.getElementsByTagName("body")[0]},n.prototype.draw=function(n,o,r){var i=this,a=o.CommerceDeals,s=a?a.data:null,u=a?a.context:null,l=o.Coupons,c=l?l.data:null,d=l?l.context:null,f=document.location.protocol+"//"+document.location.host+document.location.pathname,p=l?f==l.extras.rootCouponsUrl||f==l.extras.rootCouponsUrl+"/":!1,m=u||d,h=r.container,g=e.$(h);g.addClass("fo-right-container-frame");var v=g[0];return t.Common.CollisionHelper.treatForCollisions(g),t.Common.VisualHelper.appendToBody(g),t.Common.wait(100).then(function(){var n=e.$('<link rel="stylesheet" href="'+m.paths().innerResourcesRoot()+'/Visual/New/iframeRightSlider.css">');e.$(v.contentDocument.head).append(n);var o=r.html,a=i.getMainCssClass(),l=[new t.DisplayHandlers.EllipsisHandler,new t.DisplayHandlers.SuspendBoxHandler,new t.DisplayHandlers.CouponTextSelectHandler,new t.DisplayHandlers.ScrollHandler(m),{afterRender:function(e){window.setTimeout(function(){return g.height(e.outerHeight()+5)},10)},remove:function(){g.remove()}}],f=function(){return t.Common.Col.of(l).each(function(e){return e.remove&&e.remove()})},h=t.Products.VisualRealEstate[i.realEstate()],y=i.getOldSuspensionIdentifer(),C=new t.Model.DualCommerceModel(u||d,s,u,c,d,h,y,p,f),b=e.$(o).addClass(a);t.Common.CollisionHelper.treatForCollisions(b),C.selectedTab.subscribe(function(){t.Common.wait(100).then(function(){g.height(b.outerHeight()+5)})});var w=b[0];v.contentDocument.body.appendChild(w),C.postRenderHandler=function(){return t.Common.Col.of(l).each(function(e){return e.afterRender(b,w)})};try{e.ko.applyBindings(C,w),e.ko.applyBindings(C,v)}catch(_){throw t.Common.Col.of(l).each(function(e){return e.remove&&e.remove()}),b.remove(),_}return window.setInterval(function(){try{g.height(b.outerHeight()+5)}catch(e){}},100),i.element=w,w})},n.prototype.remove=function(t){e.$(this.element).remove()},n}();n.IFrameRightSlider=o}(n=t.ExternalProducts||(t.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(){this.element=null}return n.prototype.realEstate=function(){return 3},n.prototype.flag=function(){return"bsif"},n.prototype.determineNeededItemCount=function(e){return new t.Products.ItemCounts(4,0)},n.prototype.declareResourcesPromise=function(e){return{reset2_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/reset.css"),panel_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/New/iframeBottomSlider.css"),html:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Visual/New/panel.html"),container:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Visual/New/container.html")}},n.prototype.getOldSuspensionIdentifer=function(){return"fobs"},n.prototype.getMainCssClass=function(){return"fo-iframe-bottom-slider"},n.prototype.getParentElement=function(){return document.documentElement.getElementsByTagName("body")[0]},n.prototype.draw=function(n,o,r){var i=this,a=o.CommerceDeals,s=a?a.data:null,u=a?a.context:null,l=o.Coupons,c=l?l.data:null,d=l?l.context:null,f=document.location.protocol+"//"+document.location.host+document.location.pathname,p=l?f==l.extras.rootCouponsUrl||f==l.extras.rootCouponsUrl+"/":!1,m=u||d,h=r.container,g=e.$(h).addClass("fo-bottom-container-frame"),v=g[0];return t.Common.CollisionHelper.treatForCollisions(g),t.Common.VisualHelper.appendToBody(g),t.Common.wait(100).then(function(){var n=e.$('<link rel="stylesheet" href="'+m.paths().innerResourcesRoot()+'/Visual/New/iframeBottomSlider.css">');e.$(v.contentDocument.head).append(n);var o=r.html,a=i.getMainCssClass(),l=[new t.DisplayHandlers.EllipsisHandler,new t.DisplayHandlers.SuspendBoxHandler,new t.DisplayHandlers.CouponTextSelectHandler,{afterRender:function(e){},remove:function(){g.remove()}}],f=function(){return t.Common.Col.of(l).each(function(e){return e.remove&&e.remove()})},h=t.Products.VisualRealEstate[i.realEstate()],y=i.getOldSuspensionIdentifer(),C=new t.Model.DualCommerceModel(u||d,s,u,c,d,h,y,p,f),b=e.$(o).addClass(a);t.Common.CollisionHelper.treatForCollisions(b),C.selectedTab.subscribe(function(){t.Common.wait(100).then(function(){})});var w=b[0];v.contentDocument.body.appendChild(w),C.postRenderHandler=function(){return t.Common.Col.of(l).each(function(e){return e.afterRender(b,w)})};try{e.ko.applyBindings(C,w),e.ko.applyBindings(C,v)}catch(_){throw t.Common.Col.of(l).each(function(e){return e.remove&&e.remove()}),b.remove(),_}return i.element=w,w})},n.prototype.remove=function(t){e.$(this.element).remove()},n}();n.IFrameBottomSlider=o}(n=t.ExternalProducts||(t.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(o){function r(n,r,i,a){var s=this;o.call(this,n,r,i,a),this.ribbonCssPath=n.paths().innerResourcesRoot()+"/Visual/iframeDealsRightRibbon.css",this.displayWindowCssPath=n.paths().innerResourcesRoot()+"/Visual/iframeDisplayWindow.css",this.cssImagesPath=n.paths().innerResourcesRoot()+"/Visual/cssImages.css",this.strings=t.Common.LocaleHelper.getStringMapForCountry(n.countryCode(),t.Locale.sliderStrings),this.ribbonDimensions=e.ko.observable({width:0,height:0}),this.ribbonFrameDimensions=e.ko.observable({width:0,height:0}),this.ribbonModels=e.ko.observableArray(),this.ribbonsVisible=e.ko.observable(!0),this.zoomIntoOffer=function(e,t){var n=s;e.zoomIntoOffer(e,t),n.ribbonFrameDimensions({height:n.ribbonFrameDimensions().height,width:n.ribbonFrameDimensions().width+160})},this.zoomOutOfOffer=function(e,t){var n=s;e.zoomOutOfOffer(e,t),n.ribbonFrameDimensions({height:n.ribbonFrameDimensions().height,width:n.ribbonFrameDimensions().width-160})},this.setupDisplayWindow()}return __extends(r,o),r.prototype.setupDisplayWindow=function(){var t=this,n=this;this.displayWindowOffers=e.ko.observableArray([]),this.displayWindowOffersModels=e.ko.observable([]),this.showDisplayWindow=function(){n.displayWindowVisible(!0)},this.hideDisplayWindow=function(){var e=t;e.displayWindowVisible(!1)},this.displayWindowVisible=e.ko.observable(!1),this.displayWindowPosition=e.ko.observable({top:0,left:0}),this.displayWindowFramePosition=e.ko.observable(this.calculateDisplayWindowFramePosition(this.displayWindowPosition()));var o=80,r=515,i=205,a=2;this.displayWindowDimensions=e.ko.observable({width:r,height:o+i*a})},r.prototype.addRibbon=function(e){this.ribbonModels.push(e)},r.prototype.updatePrimaryRibbon=function(e){var o=this;this.hideDisplayWindow(),t.Common.Col.of(o.ribbonModels()).each(function(r){if(r.ribbonVisible(r.imageToDrawOn==e),r.imageToDrawOn==e){o.displayWindowPosition({top:r.imageRect.top,left:r.imageRect.right+r.ribbonDimensions.width+10}),o.imageRect=r.imageRect,o.ribbonDimensions(r.ribbonDimensions),o.ribbonFrameDimensions(r.ribbonFrameDimensions),o.displayWindowOffers(r.displayWindowOffers()),o.displayWindowOffersModels(t.Common.Col.select(r.displayWindowOffers(),function(e){return new n.RibbonOfferModel(o.context,e)}));var i=o.chooseBestPosition(o.displayWindowDimensions(),r.ribbonFramePosition);o.displayWindowPosition(i),o.displayWindowFramePosition(o.calculateDisplayWindowFramePosition(i))}})},r.prototype.calculateDisplayWindowFramePosition=function(e){return{top:e.top+20,left:e.left+20}},r.prototype.chooseBestPosition=function(e,n){var o=515,r={left:n.left+this.ribbonDimensions().width+10,top:this.imageRect.top,height:e.height,width:e.width};return t.Logger.info("Image rect:"+this.imageRect),t.Logger.info("Display Window rect:"+r),r.left+r.width>window.innerWidth?this.imageRect.top+this.imageRect.height+r.height+10>window.innerHeight+window.pageYOffset&&this.imageRect.top-r.height-10-window.pageYOffset<0?this.imageRect.left-r.width-10<0?r.left>window.innerWidth-o-10&&(r.left=window.innerWidth-o-10):r.left=this.imageRect.left-r.width-10:(this.imageRect.left+this.imageRect.width/2-r.width/2+r.width<window.innerWidth?r.left=this.imageRect.left+this.imageRect.width/2-r.width/2:r.left=window.innerWidth-(10+r.width),this.imageRect.top+this.imageRect.height+r.height+10>window.innerHeight+window.pageYOffset?r.top=this.imageRect.top-r.height-10:r.top=this.imageRect.top+this.imageRect.height+10):this.imageRect.top+r.height+10>window.innerHeight+window.pageYOffset&&(r.top=window.pageYOffset+window.innerHeight-(10+r.height)),r},r}(n.ProductModelBase);n.IFrameMultiRibbonModel=o}(n=t.Model||(t.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(){this.multiRibbonModel=null,this.lastViewportPosition=-999999,this.currentPrimaryImage=null}return n.prototype.realEstate=function(){return 6},n.prototype.flag=function(){return"rrb"},n.prototype.determineNeededItemCount=function(e){return new t.Products.ItemCounts(4,8)},n.prototype.declareResourcesPromise=function(e){return{reset2_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/reset.css"),icons_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/foicons.css"),ribbon_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/iframeDealsRightRibbon.css"),displayWindowcss:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/iframeDisplayWindow.css"),displayWindowBgcss:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/cssImages.css"),fa_css:t.Common.Res.injectCss2("//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"),ribbonHtml:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Visual/iframeDealsRightRibbon.html"),displayWindowHtml:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Visual/iframeDisplayWindow.html"),container:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Visual/New/container.html")}},n.prototype.draw=function(e,n,o){var r=this,i=n.CommerceRibbon.context;return this.prepareMultiRibbonBinding(i,o),window.setInterval(function(){return r.drawRibbonsWhereNeeded(e,i,o)},1e3),t.Common.resolve(null)},n.prototype.drawRibbonsWhereNeeded=function(e,n,o){var r=this.findImagesWithRibbonData();if(0==r.length)return void t.Logger.info("No images found with ribbon data. Doing nothing");var i=t.Common.Col.of(r).orderByDesc(function(e){return e.data("fo-ribbon-primary")?e.data("fo-ribbon-primary"):-1}),a=i.getItem(0);if(null==this.currentPrimaryImage||this.currentPrimaryImage!==a[0])if(this.currentPrimaryImage=a[0],this.imageHasRibbonVisual(a)){t.Logger.info("Primary Image has a ribbon visual, updating primary ribbon");var s=this.currentPrimaryImage;this.multiRibbonModel.updatePrimaryRibbon(s)}else{t.Logger.info("Primary Image DOESN'T have ribbon visual, drawing new one");var u=a.data("fo-ribbon-data"),l=a.data("fo-ribbon-size");this.drawNewRibbon(e,n,u,l,a,o)}},n.prototype.findImagesWithRibbonData=function(){for(var n=[],o=0;o<document.images.length;o++){var r=e.$(document.images[o]);r.data("fo-ribbon-data")&&(r.is(":visible")?n.push(r):t.Logger.info("Image has data but is not visible, filtering it out"))}return n},n.prototype.imageHasRibbonVisual=function(e){return!!e.data("fo-ribbon-visual-state")},n.prototype.calculateRelativeOpacity=function(e){var t,n,o=e.find("#fo-right-ribbon"),r=o[0].getBoundingClientRect();return t=r.top<0?Math.max(0,r.top+r.height):r.bottom>(window.innerHeight||document.documentElement.clientHeight)?Math.max(0,(window.innerHeight||document.documentElement.clientHeight)-r.top):r.height,n=t/r.height},n.prototype.prepareMultiRibbonBinding=function(n,o){var r=o.ribbonHtml,i="fo-right-ribbon fo-deal-offers",a=t.Common.VisualHelper.appendHtmlWithRootClass(r,i)[0],s=o.displayWindowHtml,u=t.Common.VisualHelper.parseAndAppendHtmlToElement(s,a);try{var l=[new t.DisplayHandlers.EllipsisHandler,new t.DisplayHandlers.SuspendBoxHandler],c=function(){return t.Common.Col.of(l).each(function(e){return e.remove&&e.remove()})},d=t.Products.VisualRealEstate[this.realEstate()],f="forb";this.multiRibbonModel=new t.Model.IFrameMultiRibbonModel(n,d,f,c),this.multiRibbonModel.postRenderHandler=function(e,n){t.Common.Col.of(l).each(function(t){return t.afterRender(e,n)})},e.ko.applyBindings(this.multiRibbonModel,u[0])}catch(p){throw e.$(a).remove(),t.Common.Col.of(l).each(function(e){return e.remove&&e.remove()}),p}},n.prototype.drawNewRibbon=function(e,n,o,r,i,a){var s=i.data("fo-ribbon-visual-state");if(!s){i.data("fo-ribbon-visual-state","drawing");var u=i[0],l=new t.Model.IFrameRibbonCommerceOffersModel(n,o,u,r);this.multiRibbonModel.addRibbon(l),this.currentPrimaryImage=u,this.multiRibbonModel.updatePrimaryRibbon(this.currentPrimaryImage),i.data("fo-ribbon-visual-state","drawn"),t.Logger.Analytics.notify(n,t.Logger.Analytics.IMPRESSION)}},n.prototype.remove=function(e){this.multiRibbonModel.hide()},n}();n.IFrameRightRibbonVisual=o}(n=t.ExternalProducts||(t.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n;!function(t){var n=function(){function t(){}return t.prototype.supportsStickyClassification=function(){return!0},t.prototype.dataKey=function(){return"Deals"},t.prototype.flag=function(){return"imgdeals"},t.prototype.classify=function(t){return e.Common.namedWaterfall([{name:"schemaorg",value:function(){return e.Vertical.CommerceHelper.classifyBySchemaOrg(t)}},{name:"specialcase",value:function(){return e.Vertical.CommerceHelper.classifyBySpecialCasesAndJunk(t)}},{name:"bwl",value:function(){return e.Vertical.CommerceHelper.classifyByBlackWhiteList(t)}},{name:"dict",value:function(){return e.Vertical.CommerceHelper.classifyByDictionaries(t)}},{name:"ribbon",value:function(){return e.Vertical.CommerceHelper.classifyByProductImage()}}],function(e){return 0!=e}).alwaysThen(function(e,t){return t?{name:t.message,value:0}:e})},t.prototype.scrapeAndObtainData=function(t,n,o){var r=new e.Data.ImageDealGenerator("api",t);return e.Common.resolve(r)},t}();t.ImageDealsLogic=n}(n=t.Logic||(t.Logic={}))}(t=e.Products||(e.Products={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(n){function o(t,o){n.call(this,t,o),this.validImages=e.Common.ImageUtils.findValidImagesBySize(0,999,!1)||[]}return __extends(o,n),o.prototype.generateData=function(n,o,r){var i=e.Common.ScrapingLogics.imageScrapeLogicWithSupporting(this.context,n,this.validImages),a={wordCounts:i,price:-1,source:"api"},s=t.OffersApi.queryFromData(o,a);return t.OffersApi.queryApi(o,r.totalCount(),null,s).then(function(e){return t.OffersApi.dealsFromOffers(o,e)})},o.prototype.hasData=function(){return this.validImages.length>0},o}(t.StubDataResult);t.ImageDealGenerator=n}(t=e.Data||(e.Data={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(o){function i(i,a,s,u,l){var c=this;void 0===l&&(l=function(){}),o.call(this,i.context,a,s,l),this.buttons=e.ko.observableArray(),this.deals=e.ko.observable(),this.selectedTab=e.ko.observable(0),this.hasDeals=e.ko.computed(function(){return c.deals()&&c.deals().offers.length>0}),this.dealScroll=e.ko.observable(!1),this.hasCoupons=e.ko.observable(!1),this.hasCampaigns=e.ko.observable(!1),this.couponsMessage=e.ko.observable(""),this.moreDealsUrl=e.ko.observable(""),this.modalTarget=e.ko.observable(),this.isWindowOpen=e.ko.computed(function(){return null!=c.deals()}),this.visibleRows=e.ko.observable(0);var d=this;this.strings=t.Common.LocaleHelper.getStringMapForCountry(i.context.countryCode(),t.Locale.sliderStrings),this.bodyRect=e.ko.observable(null);var f=function(){var n=c.context.scraper().getElementPosWithOffsets(e.$("body")[0]);d.bodyRect()&&t.Common.isEquivalent(n,d.bodyRect())||d.bodyRect(n)};window.setInterval(f,1e3),f();var p=t.Common.Col.of(i.validImages),m=p.select(function(e){var o=c,a=function(){return i.generateData(e,i.context,new t.Products.ItemCounts(0,10))},s=function(e){var t=new n.DealsModel(o.context,e.data());o.modalTarget(e.target()),o.deals(t)};return new r(e,a,s,o.bodyRect)});this.buttons(m.toArray()),this.suspendTarget.closeFn=this.onClose,this.isWindowOpen.subscribe(function(e){return e&&t.Logger.Analytics.notify(d.context,t.Logger.Analytics.IMPRESSION)}),this.setModalMaxHeight(i.context,u)}return __extends(i,o),i.prototype.setModalMaxHeight=function(t,n){this.visibleRows(t.overrides().intValue("modal.visible.rows",n));var o=8*(this.visibleRows()-1),r=this.visibleRows()*this.rowHeight();this.maxHeight=e.ko.computed(function(){return r+o})},i.prototype.onWindowOpenChange=function(e){e&&t.Logger.Analytics.notify(this.context,t.Logger.Analytics.IMPRESSION)},i.prototype.hide=function(){this.dismissWindow()},i.prototype.dismissWindow=function(){this.deals(null)},i.prototype.rowHeight=function(){return 125},i}(n.ProductModelBase);n.GenericButtonModel=o;var r=function(){function n(o,r,i,a){var s=this;this.displayDelay=e.ko.observable(1e3),this.selfHoverStart=0,this.target=e.ko.observable(),this.isLoading=e.ko.observable(!1),this.data=e.ko.observable(null),this.hasNoResults=e.ko.computed(function(){return s.data()&&0==s.data().length}),this.buttonText=e.ko.computed(function(){return s.hasNoResults()?"No deals":s.data()||!s.isLoading()?"Compare":"Loading..."}),this.isTargetHovered=e.ko.observable(!1),this.isSelfHovered=e.ko.observable(!1),this.isVisible=e.ko.computed(function(){return window.FO_ALWAYSON||s.isTargetHovered()||s.isSelfHovered()}),this.generator=null;var u=this;this.target(e.$(o)),this.generator=r,this.bodyRect=a,this.displayWidnowFn=function(e){u.isTargetHovered(!1),u.isSelfHovered(!1),i(e)},this.attachHandlers(o),this.buttonPosition=e.ko.computed(function(){return u.isTargetHovered(),u.bodyRect(),n.calcButtonPosition(u.target()[0])}),this.targetRect=e.ko.computed(function(){return u.isTargetHovered(),u.bodyRect(),t.Common.VisualHelper.getElementPosWithOffsets(u.target()[0])}),this.isSelfHovered.subscribe(function(e){if(e)u.selfHoverStart=(new Date).getTime();else{var t=(new Date).getTime()-u.selfHoverStart;t<u.displayDelay()&&u.delayedHoverTimeoutId&&clearTimeout(u.delayedHoverTimeoutId)}})}return n.prototype.attachHandlers=function(n){var o=this;e.$(n).mouseenter(function(e){o.isTargetHovered(!0)}),e.$(document.body).mouseover(function(e){o.isTargetHovered()&&(t.Common.VisualHelper.isContained(e.pageX,e.pageY,o.targetRect())||o.isTargetHovered(!1))})},n.prototype.displayAfterDelay=function(){var e=this;this.hasNoResults()||window.FO_DONT_OPEN||(this.data()||this.isLoading()||(this.isLoading(!0),this.loadData()),this.delayedHoverTimeoutId=setTimeout(function(){e.display()},this.displayDelay()))},n.prototype.display=function(){var e=this;this.hasNoResults()||window.FO_DONT_OPEN||(this.data()?this.displayWidnowFn(this):this.isLoading()||(this.isLoading(!0),this.loadData().then(function(){return e.displayWidnowFn(e)})))},n.prototype.loadData=function(){var e=this;return this.generator().then(function(n){t.Logger.log("Generator returned "+n.length),e.isLoading(!1),e.data(n)})},n.calcButtonPosition=function(e){var n=t.Common.VisualHelper.getElementPosWithOffsets(e);if(n){var o=n.left+n.width/2,r=n.top+40;return{x:o,y:r}}return{x:0,y:0}},n}();n.CompareButtonModel=r}(n=t.Model||(t.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o;!function(o){var r=function(){function o(){this.element=null}return o.prototype.realEstate=function(){return 7},o.prototype.flag=function(){return"gbx"},o.prototype.determineNeededItemCount=function(e){return new n.ItemCounts(0,10)},o.prototype.declareResourcesPromise=function(e){return{panel_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Resources/multiButton.css"),templates:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Resources/templates.html")}},o.prototype.getOldSuspensionIdentifer=function(){return"forb"},o.prototype.getMainCssClass=function(){return"fo-iframe-right-slider"},o.prototype.getParentElement=function(){return document.documentElement.getElementsByTagName("body")[0]},o.prototype.draw=function(o,r,i){var a=this,s=r.Deals,u=t.Common.Col.of([new t.DisplayHandlers.EllipsisHandler,new t.DisplayHandlers.SuspendBoxHandler]),l=i.templates,c=e.$(l);t.Common.VisualHelper.appendToBody(c);var d=e.$("<div data-bind='template: \"multibutton-template\"'></div>"),f=d[0];this.element=f,t.Common.VisualHelper.appendToBody(d);var p=function(){u.each(function(e){return e.remove&&e.remove()}),e.$(a.element).remove()},m=n.VisualRealEstate[this.realEstate()],h=this.getOldSuspensionIdentifer(),g=new t.Model.GenericButtonModel(s,m,h,3,p);return g.cssUrl=s.context.paths().innerResourcesRoot()+"/Resources/multiButton.css",g.cssName="fo-multibutton",g.postRenderHandler=function(e,t){u.each(function(n){return n.afterRender(e,t)})},e.ko.applyBindings(g,f),t.Common.resolve(null)},o.prototype.remove=function(t){e.$(this.element).remove()},o}();o.GenericButtonVisual=r}(o=n.Visual||(n.Visual={}))}(n=t.Products||(t.Products={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}));

}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(){}return t.prototype.setItem=function(n,o,r){if("userSettings"==o){var i=JSON.parse(r),a=n.getItem("fouhid");if("uuid"in i){var s=i.uuid;if(a&&s!=a)throw Error("UUID and legacy UUID mismatch");n.setItem("fouhid",s)}if("suspend"in i)for(var u=0;u<t.suspendIds.length;u++){var l=t.suspendIds[u].nwp,c=t.suspendIds[u].old;if(l in i.suspend){var d=i.suspend[l],f=n.getItem(a+"_"+c)?JSON.parse(n.getItem(a+"_"+c)):null;f||(f={}),"autoAppear"in d&&(f.autoAppear=d.autoAppear),"timestamp"in d&&(f.timestamp=d.timestamp),e.Logger.log("Replacing legacy "+JSON.stringify(f)+" with "+JSON.stringify(d)),n.setItem(a+"_"+c,JSON.stringify(f))}}}},t.prototype.getItem=function(n,o){if("userSettings"==o){var r=n.getItem("userSettings")?JSON.parse(n.getItem("userSettings")):{},i=n.getItem("fouhid");i&&(r.uuid=i);for(var a=0;a<t.suspendIds.length;a++){var s=t.suspendIds[a].nwp,u=t.suspendIds[a].old,l=n.getItem(i+"_"+u)?JSON.parse(n.getItem(i+"_"+u)):null,c=l&&"timestamp"in l?l.timestamp:null;c&&(r.suspend||(r.suspend={}),r.suspend[s]||(r.suspend[s]={}),r.suspend[s].timestamp=c);var d=l&&"autoAppear"in l?0==l.autoAppear:null;d&&(r.suspend||(r.suspend={}),r.suspend[s]||(r.suspend[s]={}),r.suspend[s].autoAppear=!d)}var f=!0;for(var p in r){f=!1;break}return f?null:(e.Logger.log("Returning "+JSON.stringify(r)+" for legacy considerations"),r)}return null},t.suspendIds=[{nwp:"RIGHT_PANEL",old:"foss"},{nwp:"BOTTOM_PANEL",old:"fobs"},{nwp:"MAIN_TABLE",old:"fomt"},{nwp:"IMAGE_RIGHT",old:"forb"},{nwp:"IMAGE_INNER",old:"fogb"}],t}();t.LegacyTranslationTable=n}(t=e.Extras||(e.Extras={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(o){function r(r,i,a,s,u,l,c,d,f,p,m){var h=this;o.call(this,r,l,c),this.deals=e.ko.observable(),this.coupons=e.ko.observable(),this.campaigns=e.ko.observable(),this.hasDeals=e.ko.computed(function(){return h.deals()&&h.deals().offers.length>0}),this.hasCoupons=e.ko.computed(function(){return h.coupons()&&h.coupons().offers.length>0}),this.hasCampaigns=e.ko.computed(function(){return h.campaigns()&&h.campaigns().offers.length>0}),this.selectedTab=e.ko.observable(0),this.dealsDisplayed=!1,this.couponsDisplayed=!1,this.campaignsDisplayed=!1,this.revealedCoupons=e.ko.observable(0),this.moreDealsUrl=e.ko.observable(),this.couponsMessage=e.ko.observable(),this.visibleItems=e.ko.observable(0),this.dealScroll=e.ko.computed(function(){return h.deals()&&h.deals().offers.length>h.visibleItems()}),this.couponScroll=e.ko.computed(function(){return h.coupons()&&h.coupons().offers.length>h.visibleItems()}),i=this.pushTenticaJumper(r,i);var g=i?new n.DealsModel(a,i):new n.DealsModel(null,[]),v=s?new n.CouponsModel(u,s):new n.CouponsModel(null,[]),y=f?new n.CampaignsModel(p,f):new n.CampaignsModel(null,[]);this.deals(g),this.coupons(v),this.campaigns(y),this.setPanelMaxHeight(r,m),this.setPanelVisibilityAndBadges(g,v,y,d),this.setMoreDealsTarget(g),this.setRevealedCoupons(v),this.setBadgePlacements(this.deals(),this.coupons(),this.campaigns()),this.strings=t.Common.LocaleHelper.getStringMapForCountry(r.countryCode(),t.Locale.sliderStrings)}return __extends(r,o),r.prototype.setPanelMaxHeight=function(t,n){this.visibleItems(t.overrides().intValue("panel.visible.items",n));var o=8*(this.visibleItems()-1),r=this.visibleItems()*this.itemHeight();this.maxHeight=e.ko.computed(function(){return r+o})},r.prototype.pushTenticaJumper=function(e,n){var o=e.overrides().floatValue("deals.tenticajumper",0),r=Math.random()<o;if(r){var i={thumb:"",ribbon:"",title:"Get the total shopper app for your android smartphone",price:"FREE",merchantThumb:"",merchantText:"*With this invitation only",part:"tentica",keywords:"",url:"//play.google.com/store/apps/details?id=com.mobile.coupons&rdid=com.mobile.coupons&referrer=foffer",className:"tenticaOffer",onClick:function(){return t.Logger.Analytics.notify(e,t.Logger.Analytics.GENERIC,{subtype:"tnt_click"})}};t.Logger.Analytics.notify(e,t.Logger.Analytics.GENERIC,{subtype:"tnt_impression"}),n?n.unshift(i):n=[i]}return n},r.prototype.setBadgePlacements=function(e,t,n){var o=93,r=95;t&&t.offers.length&&(t.cssBadgeTop=o+"px",o+=r),n&&n.offers.length&&(n.cssBadgeTop=o+"px",o+=r),e&&e.offers.length&&(e.cssBadgeTop=o+"px")},r.prototype.setPanelVisibilityAndBadges=function(e,n,o,r){var i=-1;if(n&&n.offers.length){var a=t.Common.CouponsHelper.pollCouponsMessage();(a||r)&&(i=1,this.couponsMessage(a))}if(e&&e.offers.length&&-1==i)i=0;else if(n&&n.offers.length&&-1==i)i=1;else if(o&&o.offers.length&&-1==i)i=2;else if(-1==i)throw new Error("Neither Deals, Coupons or Campaigns provided");this.selectTab(i,!1)},r.prototype.setMoreDealsTarget=function(e){this.moreDealsUrl(e.offers.length?"http://bestdealwiz.com/productlist.html?q="+e.offers[0].offer.keywords.split(" ").join("+"):"http://bestdealwiz.com/index.html")},r.prototype.setRevealedCoupons=function(e){this.revealedCoupons(t.Common.Col.count(e.offers,function(e){return e.offer.revealed}))},r.prototype.selectTab=function(e,n){void 0===n&&(n=!0),this.selectedTab(e),n&&this.collapsed(!1),0!=e||this.dealsDisplayed||(this.dealsDisplayed=!0,t.Logger.Analytics.notify(this.deals().context,t.Logger.Analytics.IMPRESSION,{kwds:this.deals().offers[0].offer.keywords})),1!=e||this.couponsDisplayed||(this.couponsDisplayed=!0,t.Logger.Analytics.notify(this.coupons().context,t.Logger.Analytics.IMPRESSION)),2!=e||this.campaignsDisplayed||(this.campaignsDisplayed=!0,t.Logger.Analytics.notify(this.campaigns().context,t.Logger.Analytics.IMPRESSION))},r.prototype.itemHeight=function(){return 125},r}(n.ProductModelBase);n.PanelModel=o}(n=t.Model||(t.Model={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(){}return n.prototype.config=function(){throw new Error("Config Not implemented")},n.prototype.realEstate=function(){return this.config().realEstate},n.prototype.flag=function(){return this.config().flag},n.prototype.cssUrl=function(e){return e.paths().innerResourcesRoot()+"/Resources/"+this.config().rootCssFile},n.prototype.determineNeededItemCount=function(e){var n=this.config().primaryItemCount,o=this.config().secondaryItemCount;if(n||o)return new t.Products.ItemCounts(n||0,o||0);throw new Error("Item counts not implemented")},n.prototype.getParentElement=function(){return document.documentElement.getElementsByTagName("body")[0]},n.prototype.declareResourcesPromise=function(e){return{css:t.Common.Res.injectCss2(this.cssUrl(e)),templates:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Resources/templates.html"),reset_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/reset.css")}},n.prototype.declareDisplayHandlers=function(e){return[new t.DisplayHandlers.EllipsisHandler,new t.DisplayHandlers.SuspendBoxHandler,new t.DisplayHandlers.CouponTextSelectHandler]},n.prototype.getLegacySuspension=function(e){var n=t.Common.Col.of(t.Extras.LegacyTranslationTable.suspendIds).first(function(t){return t.nwp==e}),o=n?n.old:"suspend_"+e;return o},n.prototype.draw=function(n,o,r){var i=this,a=o.CommerceDeals,s=a?a.data:null,u=a?a.context:null,l=o.Coupons,c=l?l.data:null,d=l?l.context:null,f=document.location.protocol+"//"+document.location.host+document.location.pathname,p=l?f==l.extras.rootCouponsUrl||f==l.extras.rootCouponsUrl+"/":!1,m=o.Campaigns,h=m?m.data:null,g=m?m.context:null,v=u||d||g,y=t.Common.Col.of(this.declareDisplayHandlers(v)),C=r.templates,b=e.$(C);t.Common.VisualHelper.appendToBody(b);var w=e.$("<div data-bind='template: \""+this.config().rootTemplate+"\"'></div>"),_=w[0];this.element=w;var S=this.getParentElement();if(!S)return t.Logger.warn("No parent element found"),t.Common.reject({message:"No parent element found"});t.Common.VisualHelper.safeAppend(S,w,!0);var E=t.Products.VisualRealEstate[this.realEstate()],R=this.getLegacySuspension(E),O=new t.Model.PanelModel(u||d,s,u,c,d,E,R,p,h,g,9999);return O.cssUrl=this.cssUrl(v),O.cssName=this.config().rootCssClass,O.postRenderHandler=function(e,t){y.each(function(n){return n.afterRender(e,t)})},O.onClose=function(){y.each(function(e){return e.remove&&e.remove()}),e.$(i.element).remove()},e.ko.applyBindings(O,_),t.Logger.Analytics.notify(v,t.Logger.Analytics.GENERIC,{subtype:"postwo"},.01),t.Common.resolve(null)},n.prototype.remove=function(t){e.$(this.element).remove()},n}();n.PanelVisualBase=o}(n=t.ExternalProducts||(t.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.declareDisplayHandlers=function(n){var o=t.prototype.declareDisplayHandlers.call(this,n),r=new e.DisplayHandlers.ScrollHandler(n);return o.push(r),o},n.prototype.config=function(){return{realEstate:1,flag:"rsx",rootTemplate:"right-slider-template",rootCssFile:"rightSlider.css",rootCssClass:"fo-right-sliderx",primaryItemCount:4,secondaryItemCount:8}},n}(t.PanelVisualBase);t.RightSliderVisual=n}(t=e.ExternalProducts||(e.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.config=function(){return{realEstate:3,flag:"bsx",rootTemplate:"generic-horizontal-template",rootCssFile:"bottomSlider.css",rootCssClass:"fo-bottom-sliderx",primaryItemCount:4,secondaryItemCount:0}},t}(e.PanelVisualBase);e.BottomSliderVisual=t}(t=e.ExternalProducts||(e.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.config=function(){return{realEstate:2,flag:"tsx",rootTemplate:"generic-horizontal-template",rootCssFile:"topSlider.css",rootCssClass:"fo-top-sliderx",primaryItemCount:4,secondaryItemCount:0}},t}(e.PanelVisualBase);e.TopSliderVisual=t}(t=e.ExternalProducts||(e.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.config=function(){return{realEstate:2,flag:"tsx",rootTemplate:"generic-horizontal-template",rootCssFile:"topBar.css",rootCssClass:"fo-top-barx",primaryItemCount:4,secondaryItemCount:4}},n.prototype.declareDisplayHandlers=function(n){var o=n.paths().innerResourcesRoot()+"/Resources/topBarPushBody.css",r=new e.DisplayHandlers.TransiantCSSHandler(o),i=t.prototype.declareDisplayHandlers.call(this,n);return i.push(r),i},n}(t.PanelVisualBase);t.TopBarVisual=n}(t=e.ExternalProducts||(e.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.config=function(){var t=e.Common.SearchEngines.matchToLocation(document.location);return{realEstate:10,flag:"sbx",rootTemplate:"generic-horizontal-template",rootCssFile:t&&t.cssName+".css",rootCssClass:"fo-search-barx",primaryItemCount:4,secondaryItemCount:8}},n.prototype.getParentElement=function(){var t=e.Common.SearchEngines.matchToLocation(document.location);return t&&t.getParentElement()},n}(t.PanelVisualBase);t.SearchBarVisual=n}(t=e.ExternalProducts||(e.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(){this.element=null}return n.prototype.config=function(){return{realEstate:1,flag:"rsinc",rootTemplate:"right-slider-template",rootCssFile:"rightSlider.css",rootCssClass:"fo-right-sliderx",primaryItemCount:4,secondaryItemCount:8}},n.prototype.realEstate=function(){return this.config().realEstate},n.prototype.flag=function(){return this.config().flag},n.prototype.determineNeededItemCount=function(e){var n=this.config().primaryItemCount,o=this.config().secondaryItemCount;if(n||o)return new t.Products.ItemCounts(n||0,o||0);throw new Error("Item counts not implemented")},n.prototype.getParentElement=function(){return document.documentElement.getElementsByTagName("body")[0]},n.prototype.declareResourcesPromise=function(e){return{templates:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Resources/templates.html"),css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Resources/rightSlider.css")}},n.prototype.cssUrl=function(e){return e.paths().innerResourcesRoot()+"/Resources/"+this.config().rootCssFile},n.prototype.getLegacySuspension=function(e){var n=t.Common.Col.of(t.Extras.LegacyTranslationTable.suspendIds).first(function(t){return t.nwp==e}),o=n?n.old:"suspend_"+e;return o},n.prototype.draw=function(n,o,r){var i=this,a=o.CommerceDeals,s=a?a.data:null,u=a?a.context:null,l=o.Coupons,c=l?l.data:null,d=l?l.context:null,f=document.location.protocol+"//"+document.location.host+document.location.pathname,p=l?f==l.extras.rootCouponsUrl||f==l.extras.rootCouponsUrl+"/":!1,m=o.Campaigns,h=m?m.data:null,g=m?m.context:null,v=u||d||g,y=r.templates,C=e.$(y);t.Common.VisualHelper.appendToBody(C);var b=e.$('<iframe class="fo-right-container-framex" data-bind="css: {\'fo-closed\': collapsed, \'fo-hidden\': hidden}" scrolling="no"></iframe>'),w=b[0];return t.Common.CollisionHelper.treatForCollisions(b),t.Common.VisualHelper.appendToBody(b),t.Common.wait(100).then(function(){var n=e.$('<link rel="stylesheet" href="'+v.paths().innerResourcesRoot()+'/Resources/rightSlider.css">');e.$(w.contentDocument.head).append(n);var o=[new t.DisplayHandlers.EllipsisHandler,new t.DisplayHandlers.SuspendBoxHandler,new t.DisplayHandlers.CouponTextSelectHandler,new t.DisplayHandlers.ScrollHandler(v)],r=t.Products.VisualRealEstate[i.realEstate()],a=i.getLegacySuspension(r),l=new t.Model.PanelModel(u||d,s,u,c,d,r,a,p,h,g,9999);l.cssUrl=i.cssUrl(v),l.cssName=i.config().rootCssClass;var f=e.$("<div data-bind=\"template: 'panel-template'\"></div>"),m=f[0];w.contentDocument.body.appendChild(m),l.postRenderHandler=function(e,n){t.Common.Col.of(o).each(function(t){return t.afterRender(e,n)})},l.onClose=function(){t.Common.Col.of(o).each(function(e){return e.remove&&e.remove()}),e.$(i.element).remove()};try{e.ko.applyBindings(l,m),e.ko.applyBindings(l,w),t.Logger.Analytics.notify(v,t.Logger.Analytics.GENERIC,{subtype:"postwo"},.01)}catch(y){throw t.Common.Col.of(o).each(function(e){return e.remove&&e.remove()}),f.remove(),y}return window.setInterval(function(){try{f.children().length>0&&b.height(e.$(f.children()[0]).outerHeight()+5)}catch(t){}},50),i.element=m,m})},n.prototype.remove=function(t){e.$(this.element).remove()},n}();n.IncrementalRightSlider=o}(n=t.ExternalProducts||(t.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(){this.element=null}return n.prototype.config=function(){return{realEstate:1,flag:"rsinc2",rootTemplate:"right-slider-template2",rootCssFile:"rightSlider.css",rootCssClass:"fo-right-sliderx",primaryItemCount:4,secondaryItemCount:8}},n.prototype.realEstate=function(){return this.config().realEstate},n.prototype.flag=function(){return this.config().flag},n.prototype.determineNeededItemCount=function(e){var n=this.config().primaryItemCount,o=this.config().secondaryItemCount;if(n||o)return new t.Products.ItemCounts(n||0,o||0);throw new Error("Item counts not implemented")},n.prototype.getParentElement=function(){return document.documentElement.getElementsByTagName("body")[0]},n.prototype.declareResourcesPromise=function(e){return{templates:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Resources/templates.html"),css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Resources/rightSlider.css")}},n.prototype.cssUrl=function(e){return e.paths().innerResourcesRoot()+"/Resources/"+this.config().rootCssFile},n.prototype.getLegacySuspension=function(e){var n=t.Common.Col.of(t.Extras.LegacyTranslationTable.suspendIds).first(function(t){return t.nwp==e}),o=n?n.old:"suspend_"+e;return o},n.prototype.draw=function(n,o,r){var i=this,a=o.CommerceDeals,s=a?a.data:null,u=a?a.context:null,l=o.Coupons,c=l?l.data:null,d=l?l.context:null,f=document.location.protocol+"//"+document.location.host+document.location.pathname,p=l?f==l.extras.rootCouponsUrl||f==l.extras.rootCouponsUrl+"/":!1,m=o.Campaigns,h=m?m.data:null,g=m?m.context:null,v=u||d||g,y=r.templates,C=e.$(y);t.Common.VisualHelper.appendToBody(C);var b=[new t.DisplayHandlers.EllipsisHandler,new t.DisplayHandlers.SuspendBoxHandler,new t.DisplayHandlers.CouponTextSelectHandler,new t.DisplayHandlers.ScrollHandler(v)],w=t.Products.VisualRealEstate[this.realEstate()],_=this.getLegacySuspension(w),S=new t.Model.PanelModel(u||d,s,u,c,d,w,_,p,h,g,9999);S.cssUrl=this.cssUrl(v),S.cssName=this.config().rootCssClass;var E=e.$("<div data-bind=\"template: 'right-slider-template2'\"></div>"),R=E[0];t.Common.VisualHelper.appendToBody(E),S.postRenderHandler=function(e,n){t.Common.Col.of(b).each(function(t){return t.afterRender(e,n)})},S.onClose=function(){t.Common.Col.of(b).each(function(e){return e.remove&&e.remove()}),e.$(i.element).remove()};try{e.ko.applyBindings(S,R),t.Logger.Analytics.notify(v,t.Logger.Analytics.GENERIC,{subtype:"postwo"},.01)}catch(O){throw t.Common.Col.of(b).each(function(e){return e.remove&&e.remove()}),E.remove(),O}return this.element=R,t.Common.resolve(R)},n.prototype.remove=function(t){e.$(this.element).remove()},n}();n.IncrementalRightSlider2=o}(n=t.ExternalProducts||(t.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(){this.element=null}return n.prototype.config=function(){return{realEstate:1,flag:"rsinc3",rootTemplate:"right-slider-template3",rootCssFile:"rightSlider.css",rootCssClass:"fo-right-sliderx",primaryItemCount:4,secondaryItemCount:8}},n.prototype.realEstate=function(){return this.config().realEstate},n.prototype.flag=function(){return this.config().flag},n.prototype.determineNeededItemCount=function(e){var n=this.config().primaryItemCount,o=this.config().secondaryItemCount;if(n||o)return new t.Products.ItemCounts(n||0,o||0);throw new Error("Item counts not implemented")},n.prototype.getParentElement=function(){return document.documentElement.getElementsByTagName("body")[0]},n.prototype.declareResourcesPromise=function(e){return{templates:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Resources/templates.html"),css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Resources/rightSlider.css")}},n.prototype.cssUrl=function(e){return e.paths().innerResourcesRoot()+"/Resources/"+this.config().rootCssFile},n.prototype.getLegacySuspension=function(e){var n=t.Common.Col.of(t.Extras.LegacyTranslationTable.suspendIds).first(function(t){return t.nwp==e}),o=n?n.old:"suspend_"+e;return o},n.prototype.draw=function(n,o,r){var i=this,a=o.CommerceDeals,s=a?a.data:null,u=a?a.context:null,l=o.Coupons,c=l?l.data:null,d=l?l.context:null,f=document.location.protocol+"//"+document.location.host+document.location.pathname,p=l?f==l.extras.rootCouponsUrl||f==l.extras.rootCouponsUrl+"/":!1,m=o.Campaigns,h=m?m.data:null,g=m?m.context:null,v=u||d||g,y=r.templates,C=e.$(y);t.Common.VisualHelper.appendToBody(C);var b=[new t.DisplayHandlers.EllipsisHandler,new t.DisplayHandlers.SuspendBoxHandler,new t.DisplayHandlers.CouponTextSelectHandler,new t.DisplayHandlers.ScrollHandler(v)],w=t.Products.VisualRealEstate[this.realEstate()],_=this.getLegacySuspension(w),S=new t.Model.PanelModel(u||d,s,u,c,d,w,_,p,h,g,9999);S.cssUrl=this.cssUrl(v),S.cssName=this.config().rootCssClass;var E=e.$("<div data-bind=\"template: 'right-slider-template2'\"></div>"),R=E[0];t.Common.VisualHelper.appendToBody(E);var O=e.$('<div id="right-slider-content" data-bind="template: \'panel-template\'"></div>');t.Common.VisualHelper.appendToBody(O),S.postRenderHandler=function(e,n){t.Common.Col.of(b).each(function(t){return t.afterRender(e,n)})},S.onClose=function(){t.Common.Col.of(b).each(function(e){return e.remove&&e.remove()}),e.$(i.element).remove()};try{e.ko.applyBindings(S,R),t.Logger.Analytics.notify(v,t.Logger.Analytics.GENERIC,{subtype:"postwo"},.01)}catch(F){throw t.Common.Col.of(b).each(function(e){return e.remove&&e.remove()}),E.remove(),F}return this.element=R,t.Common.resolve(R)},n.prototype.remove=function(t){e.$(this.element).remove()},n}();n.IncrementalRightSlider3=o}(n=t.ExternalProducts||(t.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(){this.element=null}return n.prototype.config=function(){return{realEstate:1,flag:"rsalt",rootTemplate:"right-slider-template2",rootCssFile:"rightSlider.css",rootCssClass:"fo-right-sliderx",primaryItemCount:4,secondaryItemCount:8}},n.prototype.realEstate=function(){return this.config().realEstate},n.prototype.flag=function(){return this.config().flag},n.prototype.determineNeededItemCount=function(e){var n=this.config().primaryItemCount,o=this.config().secondaryItemCount;if(n||o)return new t.Products.ItemCounts(n||0,o||0);throw new Error("Item counts not implemented")},n.prototype.getParentElement=function(){return document.documentElement.getElementsByTagName("body")[0]},n.prototype.declareResourcesPromise=function(e){return{templates:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Resources/templates.html"),css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Resources/rightSlider.css")}},n.prototype.cssUrl=function(e){return e.paths().innerResourcesRoot()+"/Resources/"+this.config().rootCssFile},n.prototype.getLegacySuspension=function(e){var n=t.Common.Col.of(t.Extras.LegacyTranslationTable.suspendIds).first(function(t){return t.nwp==e}),o=n?n.old:"suspend_"+e;return o},n.prototype.draw=function(n,o,r){var i=this,a=o.CommerceDeals,s=a?a.data:null,u=a?a.context:null,l=o.Coupons,c=l?l.data:null,d=l?l.context:null,f=document.location.protocol+"//"+document.location.host+document.location.pathname,p=l?f==l.extras.rootCouponsUrl||f==l.extras.rootCouponsUrl+"/":!1,m=o.Campaigns,h=m?m.data:null,g=m?m.context:null,v=u||d||g,y=r.templates,C=e.$(y);t.Common.VisualHelper.appendToBody(C);var b=[new t.DisplayHandlers.EllipsisHandler,new t.DisplayHandlers.SuspendBoxHandler,new t.DisplayHandlers.CouponTextSelectHandler,new t.DisplayHandlers.ScrollHandler(v)],w=t.Products.VisualRealEstate[this.realEstate()],_=this.getLegacySuspension(w),S=new t.Model.PanelModel(u||d,s,u,c,d,w,_,p,h,g,9999);S.cssUrl=this.cssUrl(v),S.cssName=this.config().rootCssClass;var E=e.$("<div data-bind=\"template: 'right-slider-template2'\"></div>"),R=E[0];t.Common.VisualHelper.appendToBody(E),S.postRenderHandler=function(e,n){t.Common.Col.of(b).each(function(t){return t.afterRender(e,n)})},S.onClose=function(){t.Common.Col.of(b).each(function(e){return e.remove&&e.remove()}),e.$(i.element).remove()};try{e.ko.applyBindings(S,R),t.Logger.Analytics.notify(v,t.Logger.Analytics.GENERIC,{subtype:"postwo"},.01)}catch(O){throw t.Common.Col.of(b).each(function(e){return e.remove&&e.remove()}),E.remove(),O}return this.element=R,t.Common.resolve(R)},n.prototype.remove=function(t){e.$(this.element).remove()},n}();n.AltRightSlider=o}(n=t.ExternalProducts||(t.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o=function(){function n(){this.element=null}return n.prototype.realEstate=function(){return 1},n.prototype.flag=function(){return"rstri"},n.prototype.determineNeededItemCount=function(e){var n=e.overrides().boolValue("rightslider.use-scroller",!0),o=n?8:0;return new t.Products.ItemCounts(4,o)},n.prototype.declareResourcesPromise=function(e){return{reset2_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/reset.css"),panel_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Visual/New/iframeRightSlider.css"),html:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Visual/New/panel.html"),container:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Visual/New/container.html")}},n.prototype.getOldSuspensionIdentifer=function(){return"foss"},n.prototype.getMainCssClass=function(){return"fo-iframe-right-slider"},n.prototype.getParentElement=function(){return document.documentElement.getElementsByTagName("body")[0]},n.prototype.draw=function(n,o,r){var i=this,a=o.CommerceDeals,s=a?a.data:null,u=a?a.context:null,l=o.Coupons,c=l?l.data:null,d=l?l.context:null,f=document.location.protocol+"//"+document.location.host+document.location.pathname,p=l?f==l.extras.rootCouponsUrl||f==l.extras.rootCouponsUrl+"/":!1,m=o.Campaigns,h=m?m.data:null,g=m?m.context:null,v=u||d||g,y=r.container,C=e.$(y);C.addClass("fo-right-container-frame");var b=C[0];return t.Common.CollisionHelper.treatForCollisions(C),t.Common.VisualHelper.appendToBody(C),t.Common.wait(100).then(function(){var n=e.$('<link rel="stylesheet" href="'+v.paths().innerResourcesRoot()+'/Visual/New/iframeRightSlider.css">');e.$(b.contentDocument.head).append(n);var o=r.html,a=i.getMainCssClass(),l=[new t.DisplayHandlers.EllipsisHandler,new t.DisplayHandlers.SuspendBoxHandler,new t.DisplayHandlers.CouponTextSelectHandler,new t.DisplayHandlers.ScrollHandler(v),{afterRender:function(e){window.setTimeout(function(){return C.height(e.outerHeight()+5)},10)},remove:function(){C.remove()}}],f=function(){return t.Common.Col.of(l).each(function(e){return e.remove&&e.remove()})},m=t.Products.VisualRealEstate[i.realEstate()],y=i.getOldSuspensionIdentifer(),w=new t.Model.DualCommerceModel(u||d||g,s,u,c,d,m,y,p,f,h,g),_=e.$(o).addClass(a);t.Common.CollisionHelper.treatForCollisions(_),w.selectedTab.subscribe(function(){t.Common.wait(100).then(function(){C.height(_.outerHeight()+5)})});var S=_[0];b.contentDocument.body.appendChild(S),w.postRenderHandler=function(){return t.Common.Col.of(l).each(function(e){return e.afterRender(_,S)})};try{e.ko.applyBindings(w,S),e.ko.applyBindings(w,b)}catch(E){throw t.Common.Col.of(l).each(function(e){return e.remove&&e.remove()}),_.remove(),E}return window.setInterval(function(){try{C.height(_.outerHeight()+5)}catch(e){}},100),i.element=S,S})},n.prototype.remove=function(t){e.$(this.element).remove()},n}();n.TripleRightSlider=o}(n=t.ExternalProducts||(t.ExternalProducts={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o;!function(o){var r=function(){function o(){this.element=null,this.model=null}return o.prototype.config=function(){throw new Error("Config Not implemented")},o.prototype.realEstate=function(){return this.config().realEstate},o.prototype.flag=function(){return this.config().flag},o.prototype.determineNeededItemCount=function(e){var t=this.config().primaryItemCount,o=this.config().secondaryItemCount;if(t||o)return new n.ItemCounts(t||0,o||0);throw new Error("Item counts not implemented")},o.prototype.getParentElement=function(){return document.documentElement.getElementsByTagName("body")[0]},o.prototype.declareResourcesPromise=function(e){return{templates:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Resources/templates.html"),css:t.Common.Res.injectCss2(this.cssUrl(e))}},o.prototype.declareDisplayHandlers=function(e){return[new t.DisplayHandlers.EllipsisHandler,new t.DisplayHandlers.SuspendBoxHandler,new t.DisplayHandlers.CouponTextSelectHandler]},o.prototype.cssUrl=function(e){return e.paths().innerResourcesRoot()+"/Resources/"+this.config().rootCssFile},o.prototype.getLegacySuspension=function(e){var n=t.Common.Col.of(t.Extras.LegacyTranslationTable.suspendIds).first(function(t){return t.nwp==e}),o=n?n.old:"suspend_"+e;return o},o.prototype.draw=function(o,r,i){var a=this,s=r.CommerceDeals,u=s?s.data:null,l=s?s.context:null,c=r.Coupons,d=c?c.data:null,f=c?c.context:null,p=document.location.protocol+"//"+document.location.host+document.location.pathname,m=c?p==c.extras.rootCouponsUrl||p==c.extras.rootCouponsUrl+"/":!1,h=r.Campaigns,g=h?h.data:null,v=h?h.context:null,y=l||f||v,C=i.templates,b=e.$(C);t.Common.VisualHelper.appendToBody(b);var w=this.declareDisplayHandlers(y),_=n.VisualRealEstate[this.realEstate()],S=this.getLegacySuspension(_),E=new t.Model.PanelModel(l||f||v,u,l,d,f,_,S,m,g,v,this.visibleItems());E.cssUrl=this.cssUrl(y),E.cssName=this.config().rootCssClass;var R=e.$("<div data-bind=\"template: '"+this.config().rootTemplate+"'\"></div>"),O=R[0],F=this.getParentElement();t.Common.VisualHelper.safeAppend(F,R,!0),E.postRenderHandler=function(e,n){t.Common.Col.of(w).each(function(t){return t.afterRender(e,n)})},E.onClose=function(){t.Common.Col.of(w).each(function(e){return e.remove&&e.remove()}),e.$(a.element).remove()};try{e.ko.applyBindings(E,O),t.Logger.Analytics.notify(y,t.Logger.Analytics.GENERIC,{subtype:"postwo"},.01)}catch(k){throw t.Common.Col.of(w).each(function(e){return e.remove&&e.remove()}),R.remove(),k}return this.element=O,this.model=E,t.Common.resolve(O)},o.prototype.remove=function(e){this.model.onClose()},o.prototype.visibleItems=function(){return 9999},o}();o.GenericPanelVisual=r}(o=n.Visual||(n.Visual={}))}(n=t.Products||(t.Products={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n;!function(t){var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.declareDisplayHandlers=function(n){var o=t.prototype.declareDisplayHandlers.call(this,n),r=new e.DisplayHandlers.ScrollHandler(n);return o.push(r),o},n.prototype.config=function(){return{realEstate:1,flag:"rsy",rootTemplate:"right-slider-template2",rootCssFile:"rightSlider.css",rootCssClass:"fo-right-sliderx",primaryItemCount:4,secondaryItemCount:8}},n.prototype.visibleItems=function(){return 4},n}(t.GenericPanelVisual);t.RightSliderY=n}(n=t.Visual||(t.Visual={}))}(t=e.Products||(e.Products={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n;!function(t){var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.config=function(){return{realEstate:2,flag:"tby",rootTemplate:"generic-horizontal-template2",rootCssFile:"topBar.css",rootCssClass:"fo-top-barx",primaryItemCount:4,secondaryItemCount:4}},n.prototype.declareDisplayHandlers=function(n){var o=n.paths().innerResourcesRoot()+"/Resources/topBarPushBody.css",r=new e.DisplayHandlers.TransiantCSSHandler(o),i=t.prototype.declareDisplayHandlers.call(this,n);return i.push(r),i},n}(t.GenericPanelVisual);t.TopBarY=n}(n=t.Visual||(t.Visual={}))}(t=e.Products||(e.Products={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var n;!function(t){var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.config=function(){var t=e.Common.SearchEngines.matchToLocation(document.location);return{realEstate:10,flag:"sby",rootTemplate:"generic-horizontal-template2",rootCssFile:t&&t.cssName+".css",rootCssClass:"fo-search-barx",primaryItemCount:4,secondaryItemCount:8}},n.prototype.getParentElement=function(){var t=e.Common.SearchEngines.matchToLocation(document.location);return t&&t.getParentElement()},n}(t.GenericPanelVisual);t.SearchBarY=n}(n=t.Visual||(t.Visual={}))}(t=e.Products||(e.Products={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.config=function(){return{realEstate:2,flag:"tsy",rootTemplate:"generic-horizontal-template2",
rootCssFile:"topSlider.css",rootCssClass:"fo-top-sliderx",primaryItemCount:4,secondaryItemCount:0}},t}(e.GenericPanelVisual);e.TopSliderY=t}(t=e.Visual||(e.Visual={}))}(t=e.Products||(e.Products={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.config=function(){return{realEstate:3,flag:"bsy",rootTemplate:"bottom-slider-template",rootCssFile:"bottomSlider.css",rootCssClass:"fo-bottom-sliderx",primaryItemCount:4,secondaryItemCount:0}},t}(e.GenericPanelVisual);e.BottomSliderY=t}(t=e.Visual||(e.Visual={}))}(t=e.Products||(e.Products={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var n;!function(n){var o;!function(o){var r=function(){function o(){this.element=null}return o.prototype.realEstate=function(){return 7},o.prototype.flag=function(){return"gby"},o.prototype.determineNeededItemCount=function(e){return new n.ItemCounts(0,10)},o.prototype.declareResourcesPromise=function(e){return{panel_css:t.Common.Res.injectCss2(e.paths().innerResourcesRoot()+"/Resources/multiButton.css"),templates:t.Common.Res.bring(e.paths().innerResourcesRoot()+"/Resources/templates.html")}},o.prototype.getOldSuspensionIdentifer=function(){return"forb"},o.prototype.getMainCssClass=function(){return"fo-iframe-right-slider"},o.prototype.getParentElement=function(){return document.documentElement.getElementsByTagName("body")[0]},o.prototype.draw=function(o,r,i){var a=this,s=r.Deals,u=t.Common.Col.of([new t.DisplayHandlers.EllipsisHandler,new t.DisplayHandlers.SuspendBoxHandler]),l=i.templates,c=e.$(l);t.Common.VisualHelper.appendToBody(c);var d=e.$("<div data-bind='template: \"multibutton-template\"'></div>"),f=d[0];this.element=f,t.Common.VisualHelper.appendToBody(d);var p=function(){u.each(function(e){return e.remove&&e.remove()}),e.$(a.element).remove()},m=n.VisualRealEstate[this.realEstate()],h=this.getOldSuspensionIdentifer(),g=new t.Model.GenericButtonModel(s,m,h,this.visibleRows(),p);return g.cssUrl=s.context.paths().innerResourcesRoot()+"/Resources/multiButton.css",g.cssName="fo-multibutton",g.postRenderHandler=function(e,t){u.each(function(n){return n.afterRender(e,t)})},e.ko.applyBindings(g,f),t.Common.resolve(null)},o.prototype.remove=function(t){e.$(this.element).remove()},o.prototype.visibleRows=function(){return 3},o}();o.GenericButtonY=r}(o=n.Visual||(n.Visual={}))}(n=t.Products||(t.Products={}))}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t=function(){function t(){this.selectedProducts=[]}return t.prototype.init=function(t,n){var o=this;for(var r in t.products)t.products.hasOwnProperty(r)&&window["FO_SKIP_"+r]&&(e.Logger.info("Skip flag was set for product: ["+r+"]. It will be removed from the list of products."),delete t.products[r]);if(0==e.Common.Col.getKeys(t.products).length)return void e.Logger.info("No products exist. Possibly they were all skipped due to FO_SKIP flag.");var i=new e.Context.Paths(n),a=new e.Context.BootstrapContext(i,t,{}),s=a.paths().outerResourcesRoot()+"/";e.Logger.intialize(a),e.Logger.Analytics.notify(a,e.Logger.Analytics.INIT,{},0),e.Logger.log("Started app init. Version: 0_0_516. PartId: "+t.partnerCode+". SubId: "+t.subId+". Domain: "+n),e.Logger.time("FO end to end"),e.Logger.log("Overrides:\n"+a.overrides().describe()),e.Logger.time("FO LoadTime");var u=e.Common.Res.injectScript(s+"json3.js").then(function(){return window.JSON3=JSON3.noConflict()}),l=e.Common.Res.injectScript(s+"NWPLegacy_v2.js"),c=e.Common.Res.injectScript(s+"bloomfilter.js"),d=e.Common.ExternalResources.getKnockout(s).then(function(){e.Common.KoBindings.registerCustomBindings(a)}),f=e.Common.ExternalResources.getJQuery(s).then(function(){return e.Common.when(e.Common.Res.injectScript(s+"jquery.xdr.js"),e.Common.Res.injectScript(s+"jquery.dotdotdot.js"))}),p=[u,l,c,d,f];e.Common.typedWhen(p).done(function(){return o.continueWithLibraries(a)}).fail(function(t){return e.Logger.error("Shared: Library load failed: "+t.message)})},t.prototype.continueWithLibraries=function(t){var n=this;e.Logger.log("Libraries loaded. Loading application context");var o=Math.random(),r=new e.Common.RandomProviderDelegate(function(){return o}),i=new e.Common.IFrameStore(t.paths(),t.isDebugMode()),a=e.Common.generateUUID(),s=e.Common.LooseUserSettings.fromAsyncStorePromise(i,a),u=s.then(function(t){return new e.Common.DefaultSuspender(t)}),l=e.Context.ApplicationContext.initializePromise(t,s,u,i,null),c={};c.CTX=l;for(var d in t.params().products){var f=t.params().products[d],p=f[0];if(p.visual.indexOf(",")>0){var m=p.visual.split(","),h=r.itemByWeights1(m,function(){return 1});e.Logger.log("Selected visual for "+d+" is "+h),p.visual=h}var g=e.Common.Res.loadProduct(t.paths(),d,p.logic,p.visual);c["PRODUCT_"+d]=g}e.Common.namedWhen2(c).done(function(e){n.continueWithContextAndProducts(e,a)}).fail(function(t){e.Logger.error("Shared: preload failed: "+t.message)})},t.prototype.continueWithContextAndProducts=function(t,n){e.Logger.log("Continuing with Context and Products");var o=t.CTX,r=new Date,i=r.getFullYear()+""+r.getMonth()+r.getDate(),a=o.userSettings().uuid()==n?"generated":"active";e.Logger.Analytics.notify(o,e.Logger.Analytics.USER,{t:i,usertype:a,hid:o.userSettings().uuid(),partid:o.params().partnerCode,subid:o.params().subId},1,!1);var s=[];for(var u in t)0==u.indexOf("PRODUCT")&&s.push(t[u]);this.selectProductsAndAddReloadChecks(o,s)},t.prototype.selectProductsAndAddReloadChecks=function(t,n){var o=this;this.selectProducts(t,n);var r=window.location.href,i=null;window.setInterval(function(){window.location.href!=r&&(r=window.location.href,i&&window.clearTimeout(i),e.Logger.info("Reloading products - URL has changed"),o.removeProducts(t,o.selectedProducts,!0),o.selectedProducts=[],i=window.setTimeout(function(){o.selectProducts(t,n)},1500))},1e3)},t.prototype.selectProducts=function(t,n){var o=this,r=e.Common.Col.select(n,function(e){return e.name}).join(",");e.Logger.log("loaded product code for "+r);for(var i={},a=0;a<n.length;a++){var s=n[a],u=new e.Context.VisualContext(t,s.name,s.visual),l=e.Products.VisualRealEstate[s.visual.realEstate()],c=t.suspender().isSuspended(l);if(c)e.Logger.info("Realestate "+l+" Is suspended. Product "+s.name+" will not be displayed"),e.Logger.Analytics.notify(u,e.Logger.Analytics.NO_SHOW,{reason:"suspended"},0);else for(var d=0;d<s.logics.length;d++){var f=s.logics[d],p=f.supportsStickyClassification()&&e.Common.ElephantClassifier.getHistoricalClassification(f);if(p){e.Logger.log("Approving for historical classification for logic "+f.flag());var m={name:"historical",value:p};i[f.flag()]=e.Common.resolve(m)}else{var h=new e.Context.LVContext(t,s.name,f,s.visual);i[f.flag()]=f.classify(h).logPassthrough("Logic classification score for "+f.flag())}}}var g=e.Common.namedWhen2(i).fail(function(t){e.Logger.error("Failed classification: "+t.message)}),v=g.then(function(o){for(var r=[],i=0;i<n.length;i++){var a=n[i],s=new e.Context.VisualContext(t,a.name,a.visual),u=e.Products.VisualRealEstate[a.visual.realEstate()],l=t.suspender().isSuspended(u);if(!l){for(var c=null,d=0,f=null,p=[],m=0;m<a.logics.length;m++){var h=a.logics[m],g=o[h.flag()];if(g){var v=g.value,y=g.name;v>0&&(p.push(h),h.supportsStickyClassification()&&e.Common.ElephantClassifier.setHistoricalClassification(h)),(null==f||v>d)&&(d=v,c=h,f=y)}else e.Logger.log("Skipping logic "+h.flag()+". Did not reach classification")}if(0>=d){e.Logger.log("Skipping product "+a.name+". Top logic classification returned "+d+" with reason "+f);var C=0==d?"Classification zero":"Negative classification: "+f;e.Logger.Analytics.notify(s,e.Logger.Analytics.NO_SHOW,{reason:C},0)}else a.logics=p,r.push({product:a,score:d})}}return r}),y=v.then(function(n){return e.Common.RealEstateHelper.resolveProductsByRealEstate(t,n)}).fail(function(t){e.Logger.error("Failed realestate resolution: "+t.message)});y.then(function(n){o.selectedProducts=n,0==n.length?e.Logger.info("FO complete: no products selected."):o.loadProducts(t,n)}).fail(function(t){e.Logger.error("Failed selected product initialization: "+t.message)})},t.prototype.loadProducts=function(t,n){var o=this,r=e.Common.Col.select(n,function(e){return e.name}).join();e.Logger.info("initializing products "+r);var i=new e.Common.DataSynchronizer,a=e.Common.Col.select(n,function(n){var r=new e.Context.VisualContext(t,n.name,n.visual),a=o.obtainProductData(t,n,i).fail(function(t){e.Logger.error("Failed retrieving data for product "+n.name+": "+t.message)}),s=e.Common.namedWhen2(n.visual.declareResourcesPromise(r)).fail(function(t){e.Logger.error("Failed retrieving visual resources for product "+n.name+": "+t.message)});return e.Common.namedWhen2({data:a,visres:s}).then(function(e){return o.displayProduct(r,n,e.data,e.visres)}).done(function(){e.Logger.log("Product "+n.name+" displayed")})});e.Common.typedWhen(a).always(function(){e.Logger.info("FO complete: "+r),e.Logger.timeEnd("FO end to end")})},t.prototype.obtainProductData=function(t,n,o){for(var r={},i=0;i<n.logics.length;i++){var a=n.logics[i],s=new e.Context.LVContext(t,n.name,a,n.visual),u=n.visual.determineNeededItemCount(s),l=a.scrapeAndObtainData(s,u,o).then(function(e){return e.context.pushNotificationParam("datasrc",e.source),e});r[a.dataKey()]=l}return e.Common.namedWhen3(r)},t.prototype.displayProduct=function(t,n,o,r){var i=e.Common.Col.hashSum(o,function(e,t){return t.hasData()?1:0})>0,a=null;if(i){e.Logger.log("Initializing visual for product "+n.name);try{a=n.visual.draw(n,o,r)}catch(s){e.Logger.error("Failed drawing "+n.name+": "+s.message),a=e.Common.reject(new Error("Draw Failure: "+(s&&s.message)))}}else{e.Logger.log(n.name+" will halt. no results returned"),e.Logger.Analytics.notify(t,e.Logger.Analytics.NO_SHOW,{reason:"zero_results"},0);var u=e.Products.VisualRealEstate[n.visual.realEstate()];e.Common.RealEstateHelper.releaseRealestate(u),a=e.Common.resolve(null)}return a.fail(function(o){e.Logger.error("Failed drawing "+t.productName+": "+o.message),e.Logger.Analytics.notify(t,e.Logger.Analytics.NO_SHOW,{reason:"Failed drawing: "+o.message},0);var r=e.Products.VisualRealEstate[n.visual.realEstate()];e.Common.RealEstateHelper.releaseRealestate(r)}),a},t.prototype.removeProducts=function(t,n,o){var r=e.Common.Col.select(n,function(e){return e.name}).join(",");e.Logger.info("Removing products "+r);for(var i=0;i<n.length;i++)this.removeProduct(t,n[i],o)},t.prototype.removeProduct=function(t,n,o){try{if(n.visual.remove(t),o){var r=e.Products.VisualRealEstate[n.visual.realEstate()];e.Common.RealEstateHelper.releaseRealestate(r)}}catch(i){e.Logger.warn("Error while removing product "+n.name+": "+i)}},t}();e.SharedApp=t}(t=e.Shared_0_0_516||(e.Shared_0_0_516={}))}(FO||(FO={}));